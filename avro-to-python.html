<!DOCTYPE html>
<html>
<head>
    
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Sharing Avro Schema to Python</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    </script>
<meta name="description" content="Data Engineering" />
    <link rel="shortcut icon" href="https://gyuhoonk.github.io/assets/built/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://gyuhoonk.github.io/avro-to-python" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Gyuhoon Kim" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Sharing Avro Schema to Python" />
    <meta property="og:description" content="DataHub에서 avro schema 파일(avsc)을 사용하는 방법 DataHub CLI 패키지 DataHub는 DataHub API를 python 패키지로 제공하고 있습니다. acryl-datahub $ pip install 'acryl-datahub[datahub-rest]' $ datahub ingest -c ./examples/recipes/mssql_to_datahub.dhub.yml acryl-datahub[datahub-rest]를 설치하면, python 코드 내에서 datahub 패키지를 사용할 수 있습니다. datahub 패키지 내에는 DataHub에서 사용하는 메타데이터의 스키마를 정의해놓은 schema_classes도 있습니다. from datahub.metadata.schema_classes import DatasetSnapshotClass" />
    <meta property="og:url" content="https://gyuhoonk.github.io/avro-to-python" />
    <meta property="og:image" content="https://gyuhoonk.github.io/assets/built/images/python/avro-to-python.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2023-05-07T22:30:00+09:00" />
    <meta property="article:modified_time" content="2023-05-07T22:30:00+09:00" />
    <meta property="article:tag" content="Python" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Sharing Avro Schema to Python" />
    <meta name="twitter:description" content="DataHub에서 avro schema 파일(avsc)을 사용하는 방법 DataHub CLI 패키지 DataHub는 DataHub API를 python 패키지로 제공하고 있습니다. acryl-datahub $ pip install 'acryl-datahub[datahub-rest]' $ datahub ingest -c ./examples/recipes/mssql_to_datahub.dhub.yml acryl-datahub[datahub-rest]를 설치하면, python 코드 내에서 datahub 패키지를 사용할 수 있습니다. datahub 패키지 내에는 DataHub에서 사용하는 메타데이터의 스키마를 정의해놓은 schema_classes도 있습니다. from datahub.metadata.schema_classes import DatasetSnapshotClass" />
    <meta name="twitter:url" content="https://gyuhoonk.github.io/" />
    <meta name="twitter:image" content="https://gyuhoonk.github.io/assets/built/images/python/avro-to-python.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Gyuhoon Kim" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Python" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Gyuhoon Kim",
        "logo": "https://gyuhoonk.github.io/"
    },
    "url": "https://gyuhoonk.github.io/avro-to-python",
    "image": {
        "@type": "ImageObject",
        "url": "https://gyuhoonk.github.io/assets/built/images/python/avro-to-python.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://gyuhoonk.github.io/avro-to-python"
    },
    "description": "DataHub에서 avro schema 파일(avsc)을 사용하는 방법 DataHub CLI 패키지 DataHub는 DataHub API를 python 패키지로 제공하고 있습니다. acryl-datahub $ pip install 'acryl-datahub[datahub-rest]' $ datahub ingest -c ./examples/recipes/mssql_to_datahub.dhub.yml acryl-datahub[datahub-rest]를 설치하면, python 코드 내에서 datahub 패키지를 사용할 수 있습니다. datahub 패키지 내에는 DataHub에서 사용하는 메타데이터의 스키마를 정의해놓은 schema_classes도 있습니다. from datahub.metadata.schema_classes import DatasetSnapshotClass"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Sharing Avro Schema to Python" href="/feed.xml" />

    
</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://gyuhoonk.github.io/">Gyuhoon Kim</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem">
        <a href="/about/">About</a>
    </li>
    <li class="nav-python" role="menuitem">
        <a href="/tag/python/">python</a>
    </li>
    <li class="nav-scala" role="menuitem">
        <a href="/tag/scala/">scala</a>
    </li>
    <li class="nav-hadoop" role="menuitem">
        <a href="/tag/hadoop/">hadoop</a>
    </li>
    <li class="nav-database" role="menuitem">
        <a href="/tag/database/">database</a>
    </li>
    <li class="nav-database" role="menuitem">
        <a href="/tag/kubernetes/">kubernetes</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag</a>
    </li>
</ul>
        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Subscribe</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-python post tag-python ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 7 May 2023"> 7 May 2023</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/python/'>PYTHON</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Sharing Avro Schema to Python</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/built/images/python/avro-to-python.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>DataHub에서 avro schema 파일(avsc)을 사용하는 방법</p>

<h3 id="datahub-cli-패키지">DataHub CLI 패키지</h3>
<p>DataHub는 DataHub API를 python 패키지로 제공하고 있습니다. <a href="https://pypi.org/project/acryl-datahub/">acryl-datahub</a></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip <span class="nb">install</span> <span class="s1">'acryl-datahub[datahub-rest]'</span>
<span class="nv">$ </span>datahub ingest <span class="nt">-c</span> ./examples/recipes/mssql_to_datahub.dhub.yml
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">acryl-datahub[datahub-rest]</code>를 설치하면, python 코드 내에서 datahub 패키지를 사용할 수 있습니다. datahub 패키지 내에는 DataHub에서 사용하는 메타데이터의 스키마를 정의해놓은 <code class="language-plaintext highlighter-rouge">schema_classes</code>도 있습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">datahub.metadata.schema_classes</span> <span class="kn">import</span> <span class="n">DatasetSnapshotClass</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">schema_classes</code>는 DataHub의 서브 프로젝트 중 <code class="language-plaintext highlighter-rouge">metadata</code> 모듈이 속해 있는 <code class="language-plaintext highlighter-rouge">metadata-ingestion</code>에서 관리됩니다.</p>

<h3 id="metadataschema_classes는-어디에-있는거지">metadata.schema_classes는 어디에 있는거지?</h3>

<p>DataHub에서 메타데이터의 스키마를 어떻게 정의하고 있는지 확인하고 싶어서, git repo에서 배포되고 있는 소스코드를 찾아보았습니다(<a href="https://github.com/acryldata/datahub/tree/master/metadata-ingestion/src/datahub">metadata-ingestion/src/datahub</a>).
그런데 <code class="language-plaintext highlighter-rouge">metadata-ingestion</code>의 소스코드(<code class="language-plaintext highlighter-rouge">datahub/metadata-ingestion/src/datahub</code>)에서는 <code class="language-plaintext highlighter-rouge">meatadata</code> 모듈을 찾을 수 없었습니다.</p>

<p><img src="../../assets/built/images/python/datahub-src.png" alt="image" /></p>

<p><code class="language-plaintext highlighter-rouge">meatadata</code> 모듈을 미리 작성해놓지 않고, 빌드에 의해 생성되는 것으로 추측했습니다. 빌드 파일(<code class="language-plaintext highlighter-rouge">datahub/metadata-ingestion/build.gradle</code>)에서 <code class="language-plaintext highlighter-rouge">metadata</code> 모듈에 해당하는 소스코드를 생성하는 task를 확인할 수 있었습니다.</p>

<p><code class="language-plaintext highlighter-rouge">build.gradle</code>에 정의된 codegen task에서 <code class="language-plaintext highlighter-rouge">metadata</code> 모듈을 생성합니다.</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">task</span> <span class="nf">codegen</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Exec</span><span class="o">,</span> <span class="nl">dependsOn:</span> <span class="o">[</span><span class="n">environmentSetup</span><span class="o">,</span> <span class="n">installPackage</span><span class="o">,</span> <span class="s1">':metadata-events:mxe-schemas:build'</span><span class="o">])</span> <span class="o">{</span>
  <span class="n">inputs</span><span class="o">.</span><span class="na">files</span><span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="s2">"../metadata-events/mxe-schemas/src/"</span><span class="o">,</span> <span class="nl">include:</span> <span class="s2">"**/*.avsc"</span><span class="o">))</span>
  <span class="n">outputs</span><span class="o">.</span><span class="na">dir</span><span class="o">(</span><span class="s1">'src/datahub/metadata'</span><span class="o">)</span>
  <span class="n">commandLine</span> <span class="s1">'bash'</span><span class="o">,</span> <span class="s1">'-c'</span><span class="o">,</span> <span class="s2">"source ${venv_name}/bin/activate &amp;&amp; ./scripts/codegen.sh"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위 task는 아래처럼 간단하게 3가지 단계로 요약할 수 있습니다.</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">metadata-events</code> 내부의 avro schema 파일(avsc)을 읽는다</li>
  <li><code class="language-plaintext highlighter-rouge">codegen.sh</code>를 실행하여 1에서 읽은 파일을 python 파일로 변환한다</li>
  <li>변환한 파일은 <code class="language-plaintext highlighter-rouge">src/datahub/metadata</code>에 저장한다</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">codegen.sh</code>는 <code class="language-plaintext highlighter-rouge">avro_codegen.py</code> 스크립트를 실행합니다. avsc에서 읽은 정보를 재조합하여 python 파일(<code class="language-plaintext highlighter-rouge">metadata</code> 모듈)을 생성할 수 있는 로직을 담고 있습니다.</p>

<p>그렇다면 <code class="language-plaintext highlighter-rouge">metadata-events</code>에 avsc 파일이 존재할 것이라고 예측하고 해당 서브 프로젝트를 살펴보았습니다.</p>

<h3 id="metadata-events-avro-schemaavsc-생성하기">metadata-events: Avro Schema(avsc) 생성하기</h3>

<p><code class="language-plaintext highlighter-rouge">metadata-ingestion</code>에서 python 패키지 빌드하기 위해 사용하는 avsc 파일도 <code class="language-plaintext highlighter-rouge">metadata-events</code>를 빌드하여 생성해야했습니다. 즉, DataHub 프로젝트는 서브 프로젝트들 간에 의존성(dependency)을 갖습니다. 
avsc 파일을 생성하기 위해서는 <code class="language-plaintext highlighter-rouge">metadata-events</code> 중 <code class="language-plaintext highlighter-rouge">mxe-schemas</code>를 빌드해야합니다. <code class="language-plaintext highlighter-rouge">metadata-events/mxe-schemas/build.gradle</code>은 아래와 같습니다.</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// `datahub/metadata-events/mxe-schemas/build.gradle`</span>
<span class="n">task</span> <span class="nf">copyMetadataModels</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Copy</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">from</span><span class="o">(</span><span class="s2">"../../metadata-models/src/main/pegasus/"</span><span class="o">)</span>
  <span class="n">into</span> <span class="nf">file</span><span class="o">(</span><span class="s2">"src/main/pegasus"</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">generateAvroSchema</span><span class="o">.</span><span class="na">dependsOn</span> <span class="n">copyMetadataModels</span>
<span class="n">pegasus</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">generationModes</span> <span class="o">=</span> <span class="o">[</span><span class="n">PegasusGenerationMode</span><span class="o">.</span><span class="na">PEGASUS</span><span class="o">,</span> <span class="n">PegasusGenerationMode</span><span class="o">.</span><span class="na">AVRO</span><span class="o">]</span>

<span class="n">task</span> <span class="nf">copyOriginalAvsc</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Copy</span><span class="o">,</span> <span class="nl">dependsOn:</span> <span class="n">generateAvroSchema</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">from</span><span class="o">(</span><span class="s2">"src/mainGeneratedAvroSchema/avro"</span><span class="o">)</span>
  <span class="n">into</span> <span class="nf">file</span><span class="o">(</span><span class="s2">"src/renamed/avro"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위 빌드를 간단하게 텍스트로 요약해보면 아래 3단계를 거칩니다.</p>

<ol>
  <li>서브 프로젝트 <code class="language-plaintext highlighter-rouge">metadata-models</code>의 소스 파일을 복사해온다(<code class="language-plaintext highlighter-rouge">copyMetadataModels</code>)</li>
  <li>복사해온 소스 파일을 이용하여 PEAGASUS, AVRO 포맷의 파일을 생성한다(<code class="language-plaintext highlighter-rouge">egasus.main.generationModes</code>)</li>
  <li>생성된 AVSC 파일은 <code class="language-plaintext highlighter-rouge">src/renamed/avro</code> 경로에 복사한다(<code class="language-plaintext highlighter-rouge">copyOriginalAvsc</code>)</li>
</ol>

<p>서브프로젝트 <code class="language-plaintext highlighter-rouge">metadata-ingestion</code>에서 참조하고 있는 avsc 파일 경로는 <code class="language-plaintext highlighter-rouge">"**/*.avsc"</code>이기 때문에 3번 과정에서 생성된 avsc 파일(<code class="language-plaintext highlighter-rouge">src/renamed/avro</code> 하위에 있는 avsc 파일들)을 참조합니다.</p>

<h3 id="avro_codegenpy는-어떻게-모듈을-생성하지"><code class="language-plaintext highlighter-rouge">avro_codegen.py</code>는 어떻게 모듈을 생성하지?</h3>

<p>다시 <code class="language-plaintext highlighter-rouge">metadata-ingestion</code> 서브 프로젝트로 돌아와서 생성된 ascv 파일을 읽고 <code class="language-plaintext highlighter-rouge">meatadata</code> 모듈을 생성하는 지 확인해보았습니다.</p>

<p><code class="language-plaintext highlighter-rouge">avrogen.write_schema_files</code>를 실행하여 소스코드를 생성합니다.</p>

<p><code class="language-plaintext highlighter-rouge">write_schema_files</code>는 <code class="language-plaintext highlighter-rouge">avro.schema.make_avsc_object</code>를 통해 생성된 avro schema 객체를 입력받아 <code class="language-plaintext highlighter-rouge">schema_classes.py</code>를 작성합니다.</p>

<p>입력받는 avro schema 객체는 <code class="language-plaintext highlighter-rouge">avro.schema.make_avsc_object</code>로 생성됩니다. json파일을 읽어서 avro schema 객체를 생성하는 역할입니다.</p>

<p>따라서 <code class="language-plaintext highlighter-rouge">avro_codegen.py</code>를 간소화하면 아래와 같은 과정을 수행합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">avrogen</span> <span class="kn">import</span> <span class="n">write_schema_files</span>

<span class="c1"># 생성된 avsc 파일들을 json 형태로 읽어들입니다
</span><span class="k">for</span> <span class="n">schema_file</span> <span class="ow">in</span> <span class="n">schema_files</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">load_schema_file</span><span class="p">(</span><span class="n">schema_file</span><span class="p">)</span>
        <span class="n">schemas</span><span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">schema_file</span><span class="p">).</span><span class="n">stem</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span>

<span class="c1"># 생성된 avro schema 객체를 하나의 객체로 합칩니다
</span><span class="n">merged_schema</span> <span class="o">=</span> <span class="n">merge_schemas</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">schemas</span><span class="p">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1"># 하나의 객체로 합친 결과를 `schema_classes.py`로 작성합니다
</span><span class="n">write_schema_files</span><span class="p">(</span><span class="n">merged_schema</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="왜-이런-구조를-사용하는걸까">왜 이런 구조를 사용하는걸까?</h3>

<p>애초에 왜 이렇게 복잡한 구조를 사용하는걸까요? 아래와 같은 의문이 생기지 않을 수 없었습니다.</p>

<ul>
  <li>처음부터 <code class="language-plaintext highlighter-rouge">schema_classes.py</code> 파일도 작성하면 되는거 아닌가? avsc 파일 생성할 때는 클래스 별로 잘 생성하던데 왜 여기는 모든 클래스를 뭉뚱그려서 넣어놨지..?</li>
  <li>avsc 파일은 왜 생성되도록 만들어놓은거야? 모든 프로젝트에서 참조하는 스키마라면 그냥 하드코딩되있어도 괜찮은 것 아닌가?</li>
  <li>이런 구조가 다른 오픈소스들에서도 자주 사용되는 구조인건가? avro 패키지에 코드 생성 함수가 있는 걸 보면 그런 것 같기도 하고…</li>
</ul>

<p>이런 의문들은 위 과정들을 다시 한번 살펴보면서 어느 정도 해소되었습니다.</p>

<h4 id="datahub는-restli-kafka-python-에서-동일한-스키마를-사용해야한다">DataHub는 Rest.li, kafka, python 에서 동일한 스키마를 사용해야한다</h4>

<p>DataHub는 크게 3가지 기술을 이용하여 구성되어 있습니다.</p>
<ul>
  <li>Rest.li Framework: <code class="language-plaintext highlighter-rouge">meatadata-service</code>에서 API를 구현하기 위해 사용됩니다.</li>
  <li>Kafka: 정확히는 kafka-registry에서 해당 topic이 지정한 schema 형태를 갖추었는지 확인합니다.</li>
  <li>Python: CLI를 구현하기위해 사용합니다.</li>
</ul>

<p>그런데 이 3가지 기술 스택이 각각 사용하는 스키마 형태(포맷)이 다릅니다.</p>
<ul>
  <li>Rest.li Framework: PDL Schema(Pegasus)를 이용합니다 (<a href="https://linkedin.github.io/rest.li/pdl_schema">PDL Schema</a>)</li>
  <li>Kafka-registry: avro(avsc)를 이용하여 스키마를 등록합니다.</li>
  <li>Python: 클래스를 선언하여 해당 포맷을 관리합니다.</li>
</ul>

<p>따라서 Avro만으로 스키마를 작성한다면, Rest.li에서는 이를 사용할 수 없고, PDL을 따로 작성해야합니다. 
이런 문제를 해결하기 위해 DataHub 개발자들은 Pegasus로만 스키마(PDL)를 작성했습니다. 이후에 avro 스키마가 필요할 때마다, 스키마를 생성하는 task(<code class="language-plaintext highlighter-rouge">pegasus.main.generationModes</code>)를 이용해서 Avro Schema 파일(avsc)를 생성합니다.</p>

<p>이런 구조를 가지게 되면, 결과적으로 프로젝트의 전체 구조를 볼 때, PDL 한가지만 수정하면 Kafka에서 사용하는 avsc 파일과 Python에서 사용하는 <code class="language-plaintext highlighter-rouge">schema_classes.py</code>는 자동으로 생성하는 아키텍쳐를 갖습니다. 관리 포인트가 한가지로만 줄어드는 것입니다.</p>

<p><img src="../../assets/built/images/python/meta-schema-flow.png" alt="flow-chart" /></p>

<h4 id="스키마-공유sharing-schema">스키마 공유(Sharing Schema)</h4>

<p>이런 사례가 있는지 StackOverflow에 검색을 해봤습니다.</p>

<ul>
  <li><a href="https://stackoverflow.com/questions/69919046/how-to-share-avro-schema-between-different-microservices">How to share avro schema between different microservices?</a></li>
</ul>

<p>위 포스트의 질문은 다음과 같습니다.</p>

<blockquote>
  <p>avro 스키마(avsc)를 사용하고 있는데, 다른 기술 스택(kotlin)을 사용하는 팀에게 이걸 공유할 수 있는 좋은 방법이 있을까요?</p>
</blockquote>

<p>위 질문은 kotlin과 공유하기 위한 방법을 묻고 있기 때문에 답변들은 maven build를 이용할 것을 권장합니다. 즉, 수동으로(manually) 스키마 파일을 하나하나 클래스로 옮기는 것은 절대 해서는 안되고 DataHub처럼 자동으로 빌드할 수 있는 방법을 마련해야한다는 것입니다.</p>

<p>DataHub는 gradle을 통해 이를 자동화하였고, maven을 통해 avsc로부터 클래스를 자동으로 생성하는 방법은 <a href="https://github.com/zolyfarkas/avro-schema-examples">avro-schema-examples</a>에서 확인할 수 있습니다.</p>

<h3 id="정리">정리</h3>

<ul>
  <li>avro schema를 python 클래스로 사용하기 위해서는 <code class="language-plaintext highlighter-rouge">avro, avrogen</code> 패키지를 이용한다.</li>
  <li>마이크로서비스 개발 시에 서로 다른 기술 스택에서 공통 스키마를 공유하는 아키텍쳐는 (당연히) 존재한다.</li>
  <li>avro schema를 공유하기 위한 방법은 gradle, maven과 같은 빌드 툴을 통해 반드시 자동화되어야 한다.</li>
</ul>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Gyuhoon Kim</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/GyuhoonK.jpg" alt="GyuhoonK" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/GyuhoonK">GyuhoonK</a></h4>
                                
                                    <p>Read <a href="/author/GyuhoonK">more posts</a> by this author.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/GyuhoonK">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            <!--  -->
            <!-- utteranc setting -->
            <script src="https://utteranc.es/client.js"
                    repo="GyuhoonK/blog-comments"
                    issue-term="pathname"
                    theme="github-light"
                    crossorigin="anonymous"
                    async>
            </script>

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/spain-blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Gyuhoon Kim &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/python/">Python</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/jaydebeapi_class_not_found">jaydebeapi - Class not found Error</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/decorator">변수를 전달하는 decorator</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/threading-in-python">Threading in Python</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/python/">
                                
                                    See all 4 posts  →
                                
                            </a>
                        </footer>
                    </article>
                <script type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
                </script>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/non-deterministic-udf">
                <div class="post-card-image" style="background-image: url(/assets/built/images/hadoop/determinstic-vs-non-deterministic.webp)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/non-deterministic-udf">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Hadoop</span>
                            
                        
                    

                    <h2 class="post-card-title">non-deterministic UDF</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>non-determinitic UDF 구현하기

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/GyuhoonK.jpg" alt="GyuhoonK" />
                        
                        <span class="post-card-author">
                            <a href="/author/GyuhoonK/">GyuhoonK</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      3 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/jaydebeapi_class_not_found">
                <div class="post-card-image" style="background-image: url(/assets/built/images/python/jpype.webp)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/jaydebeapi_class_not_found">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Python</span>
                            
                        
                    

                    <h2 class="post-card-title">jaydebeapi - Class not found Error</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>jaydebeapi로 DB 연결 시 TypeError: Class not found 원인 파악

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/GyuhoonK.jpg" alt="GyuhoonK" />
                        
                        <span class="post-card-author">
                            <a href="/author/GyuhoonK/">GyuhoonK</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      3 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://gyuhoonk.github.io/">
            
            <span>Gyuhoon Kim</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Sharing Avro Schema to Python</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Sharing+Avro+Schema+to+Python&amp;url=https://gyuhoonk.github.ioavro-to-python"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://gyuhoonk.github.ioavro-to-python"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://gyuhoonk.github.io/">Gyuhoon Kim</a> &copy; 2024</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Subscribe to Gyuhoon Kim</h1>
                <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
                <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
<script type="text/javascript" async
	src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
	extensions: ["tex2jax.js"],
	jax: ["input/TeX", "output/HTML-CSS"],
	tex2jax: {
		inlineMath: [ ['$','$'], ["\\(","\\)"] ],
		displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
		processEscapes: true
	},
	"HTML-CSS": { availableFonts: ["TeX"] }
});
</script>
    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->
    <!-- math LaTex-->
    
</body>
</html>
