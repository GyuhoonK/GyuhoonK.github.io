<!DOCTYPE html>
<html>
<head>
    
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Learning Apache Spark 3 with Scala (Section7)</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    </script>
<meta name="description" content="Data Engineering" />
    <link rel="shortcut icon" href="https://gyuhoonk.github.io/assets/built/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://gyuhoonk.github.io/sparkscala7" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Gyuhoon Kim" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Learning Apache Spark 3 with Scala (Section7)" />
    <meta property="og:description" content="Learning Apache Spark 3 with Scala (Section7 - Machine Learning Library) machine learning in Spark why to use machine learning in Spark 머신러닝 알고리즘을 적용해야할 데이터의 양이 1대의 PC가 처리할 수 있는 사이즈보다 큰 경우, Spark를 이용하여 머신러닝 알고리즘을 수행할 수 있습니다. spark에서 머신러닝 알고리즘을 실행하면, 각 클러스터의 데이터에 해당" />
    <meta property="og:url" content="https://gyuhoonk.github.io/sparkscala7" />
    <meta property="og:image" content="https://gyuhoonk.github.io/assets/built/images/scala-banner-post.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2022-06-24T22:30:00+09:00" />
    <meta property="article:modified_time" content="2022-06-24T22:30:00+09:00" />
    <meta property="article:tag" content="Scala" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Learning Apache Spark 3 with Scala (Section7)" />
    <meta name="twitter:description" content="Learning Apache Spark 3 with Scala (Section7 - Machine Learning Library) machine learning in Spark why to use machine learning in Spark 머신러닝 알고리즘을 적용해야할 데이터의 양이 1대의 PC가 처리할 수 있는 사이즈보다 큰 경우, Spark를 이용하여 머신러닝 알고리즘을 수행할 수 있습니다. spark에서 머신러닝 알고리즘을 실행하면, 각 클러스터의 데이터에 해당" />
    <meta name="twitter:url" content="https://gyuhoonk.github.io/" />
    <meta name="twitter:image" content="https://gyuhoonk.github.io/assets/built/images/scala-banner-post.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Gyuhoon Kim" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Scala" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Gyuhoon Kim",
        "logo": "https://gyuhoonk.github.io/"
    },
    "url": "https://gyuhoonk.github.io/sparkscala7",
    "image": {
        "@type": "ImageObject",
        "url": "https://gyuhoonk.github.io/assets/built/images/scala-banner-post.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://gyuhoonk.github.io/sparkscala7"
    },
    "description": "Learning Apache Spark 3 with Scala (Section7 - Machine Learning Library) machine learning in Spark why to use machine learning in Spark 머신러닝 알고리즘을 적용해야할 데이터의 양이 1대의 PC가 처리할 수 있는 사이즈보다 큰 경우, Spark를 이용하여 머신러닝 알고리즘을 수행할 수 있습니다. spark에서 머신러닝 알고리즘을 실행하면, 각 클러스터의 데이터에 해당"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Learning Apache Spark 3 with Scala (Section7)" href="/feed.xml" />

    
</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://gyuhoonk.github.io/">Gyuhoon Kim</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem">
        <a href="/about/">About</a>
    </li>
    <li class="nav-python" role="menuitem">
        <a href="/tag/python/">python</a>
    </li>
    <li class="nav-scala" role="menuitem">
        <a href="/tag/scala/">scala</a>
    </li>
    <li class="nav-hadoop" role="menuitem">
        <a href="/tag/hadoop/">hadoop</a>
    </li>
    <li class="nav-database" role="menuitem">
        <a href="/tag/database/">database</a>
    </li>
    <li class="nav-database" role="menuitem">
        <a href="/tag/kubernetes/">kubernetes</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag</a>
    </li>
</ul>
        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Subscribe</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-scala post tag-scala ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="24 June 2022">24 June 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/scala/'>SCALA</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Learning Apache Spark 3 with Scala (Section7)</h1>
            </header>

            <!-- 
            <figure class="post-full-image" style="background-image: url(/assets/built/images/scala-banner-post.png)">
            </figure>
             -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>Learning Apache Spark 3 with Scala (Section7 - Machine Learning Library)</p>

<h1 id="machine-learning-in-spark">machine learning in Spark</h1>

<h2 id="why-to-use-machine-learning-in-spark">why to use machine learning in Spark</h2>

<p>머신러닝 알고리즘을 적용해야할 데이터의 양이 1대의 PC가 처리할 수 있는 사이즈보다 큰 경우, Spark를 이용하여 머신러닝 알고리즘을 수행할 수 있습니다. spark에서 머신러닝 알고리즘을 실행하면, 각 클러스터의 데이터에 해당 머신러닝 알고리즘을 적용합니다. 이는 1대의 노트북이나 데스크탑에서 수행할 수 없는 대량의 데이터에 대한 머신러닝 작업을 가능하게 합니다.</p>

<p>대부분의 머신러닝 알고리즘은 많은 GPU와 메모리를 지닌 단일 머신을 작동해야하는 방식(monolithic)이었습니다. Spark는 이와는 반대로 데이터를 여러대의 머신에 수평으로 전개하여 머신러닝 알고리즘을 적용합니다.</p>

<h3 id="gpu-in-spark">GPU in Spark?</h3>

<p>클러스터의 CPU만으로 처리할 수 없는 대용량의 데이터가 존재할 수 있습니다. 이런 경우에는 각 클러스터의 GPU까지 동원하며 클러스터 내부에서도 병렬 작업을 실행할 수 있도록 해야합니다. spark 3.x부터 GPU 가속을 사용할 수 있습니다(<a href="https://www.nvidia.com/ko-kr/ai-data-science/spark-ebook/gpu-accelerated-spark-3/">데이터 사이언스 가이드</a>).</p>

<h2 id="machine-learning-packages-in-spark">machine learning packages in Spark</h2>

<ul>
  <li>Feature Extraction
    <ul>
      <li>TF/IDF</li>
    </ul>
  </li>
  <li>Basic statistics
    <ul>
      <li>Chi-Squared Test, Peason or Speaman corr, min, max, mean, var</li>
    </ul>
  </li>
  <li>Linear Regression, Logistic Regression</li>
  <li>Support Vector Machine</li>
  <li>Naive Bayses Classifier</li>
  <li>Decision Trees</li>
  <li>K-means Clustering</li>
  <li>Principal Component Analysis, Singular Value Decomposition</li>
  <li>Recommendations using Alternating Least Squares(ALS)</li>
</ul>

<h1 id="spark12-vs-spark3">Spark1,2 vs Spark3</h1>

<p>spark 버전에 따라 머신러닝 라이브러리에 변화가 있습니다. Spark1, 2 버전은 	<code class="language-plaintext highlighter-rouge">spark.mllib</code>을 기본으로 사용하고 있고, Spark3 버전은  <code class="language-plaintext highlighter-rouge">spark.ml</code>을 기본으로 사용합니다. <code class="language-plaintext highlighter-rouge">spark.mllib</code>은 spark3에서도 지원하기는 하지만, 개발이 중단되었고, 일부 기능도 작동하지 않습니다(<strong>The MLlib RDD-based API is now in maintenance mode.</strong>).</p>

<h2 id="sparkmllib-in-spark12"><code class="language-plaintext highlighter-rouge">spark.mllib</code> in Spark1,2</h2>

<p>현재 관점에서 <code class="language-plaintext highlighter-rouge">spark.mllib</code>은 구형 API입니다. 해당 API는 RDD를 사용합니다. 또한 특정 데이터 구조를 이용해 머신러닝 알고리즘을 수행했습니다.</p>

<h3 id="특정-데이터-구조">특정 데이터 구조?</h3>

<p>특정 데이터 구조는 <code class="language-plaintext highlighter-rouge">Vector</code>, <code class="language-plaintext highlighter-rouge">Point</code>, <code class="language-plaintext highlighter-rouge">Matrix</code>를 의미합니다. 아래와 같이 분류됩니다(<a href="https://spark.apache.org/docs/latest/mllib-data-types.html">mllib-data-types</a>).</p>

<ul>
  <li><a href="https://spark.apache.org/docs/latest/mllib-data-types.html#local-vector">Local vector</a></li>
  <li><a href="https://spark.apache.org/docs/latest/mllib-data-types.html#labeled-point">Labeled point</a></li>
  <li><a href="https://spark.apache.org/docs/latest/mllib-data-types.html#local-matrix">Local matrix</a></li>
  <li>Distributed matrix
    <ul>
      <li><a href="https://spark.apache.org/docs/latest/mllib-data-types.html#rowmatrix">RowMatrix</a></li>
      <li><a href="https://spark.apache.org/docs/latest/mllib-data-types.html#indexedrowmatrix">IndexedRowMatrix</a></li>
      <li><a href="https://spark.apache.org/docs/latest/mllib-data-types.html#coordinatematrix">CoordinateMatrix</a></li>
      <li><a href="https://spark.apache.org/docs/latest/mllib-data-types.html#blockmatrix">BlockMatrix</a></li>
    </ul>
  </li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark.mllib.clustering.</span><span class="o">{</span><span class="nc">KMeans</span><span class="o">,</span> <span class="nc">KMeansModel</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.mllib.linalg.Vectors</span>

<span class="c1">// Load and parse the data</span>
<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">sc</span><span class="o">.</span><span class="py">textFile</span><span class="o">(</span><span class="s">"data/mllib/kmeans_data.txt"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">parsedData</span> <span class="k">=</span> <span class="nv">data</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">s</span> <span class="k">=&gt;</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="nv">s</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="sc">' '</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">toDouble</span><span class="o">))).</span><span class="py">cache</span><span class="o">()</span>

<span class="c1">// Cluster the data into two classes using KMeans</span>
<span class="k">val</span> <span class="nv">numClusters</span> <span class="k">=</span> <span class="mi">2</span>
<span class="k">val</span> <span class="nv">numIterations</span> <span class="k">=</span> <span class="mi">20</span>
<span class="k">val</span> <span class="nv">clusters</span> <span class="k">=</span> <span class="nv">KMeans</span><span class="o">.</span><span class="py">train</span><span class="o">(</span><span class="n">parsedData</span><span class="o">,</span> <span class="n">numClusters</span><span class="o">,</span> <span class="n">numIterations</span><span class="o">)</span>
</code></pre></div></div>

<p>RDD를 데이터를 <code class="language-plaintext highlighter-rouge">Vector</code>로 변경하여(parse) 클러스터링을 적용하였습니다.</p>

<h2 id="newer-libsparkml-in-spark3">newer Lib(<code class="language-plaintext highlighter-rouge">spark.ml</code>) in Spark3</h2>

<p><code class="language-plaintext highlighter-rouge">spark.ml</code>의 가장 큰 특징은 RDD가 아니라 <code class="language-plaintext highlighter-rouge">DataFrame</code>, <code class="language-plaintext highlighter-rouge">Dataset</code>을 사용한다는 점입니다. 이를 통해 spark의 다른 컴포넌트(ex. <code class="language-plaintext highlighter-rouge">sparkSQL</code>)와 데이터를 주고 받을 수 있습니다.   즉 <strong>상호운영성</strong>을 확보할 수 있습니다. 예를 들어, SparkSQL로부터 학습 데이터를 추출하여 SparkML의 머신러닝 알고리즘을 실행하고, 실행 결과를 다시 SparkSQL로 처리할 수 있습니다. 이러한 동작이 가능한 이유는 모든 컴포넌트가 <code class="language-plaintext highlighter-rouge">DataFrame</code>, <code class="language-plaintext highlighter-rouge">Dataset</code>을 기본으로 채택하고 있기 때문입니다.</p>

<h1 id="examples">Examples</h1>

<p>아래 예시들은 <a href="https://www.udemy.com/course/best-scala-apache-spark/">Learning Apache Spark 3 with Scala</a> 강좌에서 제공되는 예제 코드들을 옮겨놓았습니다.</p>

<h2 id="recommendation">Recommendation</h2>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.recommendation._</span>

<span class="k">val</span> <span class="nv">als</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ALS</span><span class="o">()</span>
      <span class="o">.</span><span class="py">setMaxIter</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
      <span class="o">.</span><span class="py">setRegParam</span><span class="o">(</span><span class="mf">0.01</span><span class="o">)</span>
      <span class="o">.</span><span class="py">setUserCol</span><span class="o">(</span><span class="s">"userID"</span><span class="o">)</span>
      <span class="o">.</span><span class="py">setItemCol</span><span class="o">(</span><span class="s">"movieID"</span><span class="o">)</span>
      <span class="o">.</span><span class="py">setRatingCol</span><span class="o">(</span><span class="s">"rating"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">als</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">ratings</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">userID</span><span class="k">:</span><span class="kt">Int</span> <span class="o">=</span> <span class="nf">args</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="py">toInt</span>
<span class="k">val</span> <span class="nv">users</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="n">userID</span><span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"userID"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">recommendations</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">recommendForUserSubset</span><span class="o">(</span><span class="n">users</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="linear-regression">Linear regression</h2>

<p><code class="language-plaintext highlighter-rouge">vectorAssembler</code>를 이용하여 데이터를 가공한 뒤 알고리즘을 적용합니다.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark._</span>
<span class="k">import</span> 
<span class="nn">org.apache.spark.ml.feature.VectorAssembler</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.LinearRegression</span>

<span class="c1">// Load Data</span>
<span class="k">val</span> <span class="nv">regressionSchema</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">()</span>
      <span class="o">.</span><span class="py">add</span><span class="o">(</span><span class="s">"label"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="n">nullable</span> <span class="k">=</span> <span class="kc">true</span><span class="o">)</span>
      <span class="o">.</span><span class="py">add</span><span class="o">(</span><span class="s">"features_raw"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="n">nullable</span> <span class="k">=</span> <span class="kc">true</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">dsRaw</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
      <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"sep"</span><span class="o">,</span> <span class="s">","</span><span class="o">)</span>
      <span class="o">.</span><span class="py">schema</span><span class="o">(</span><span class="n">regressionSchema</span><span class="o">)</span>
      <span class="o">.</span><span class="py">csv</span><span class="o">(</span><span class="s">"data/regression.txt"</span><span class="o">)</span>
      <span class="o">.</span><span class="py">as</span><span class="o">[</span><span class="kt">RegressionSchema</span><span class="o">]</span>

<span class="c1">// Transform</span>
<span class="k">val</span> <span class="nv">assembler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">().</span>
      <span class="nf">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"features_raw"</span><span class="o">)).</span>
      <span class="nf">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">assembler</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dsRaw</span><span class="o">)</span>
        <span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"label"</span><span class="o">,</span><span class="s">"features"</span><span class="o">)</span>

<span class="c1">// Split</span>
<span class="k">val</span> <span class="nv">trainTest</span> <span class="k">=</span> <span class="nv">df</span><span class="o">.</span><span class="py">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.5</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">))</span>
    <span class="k">val</span> <span class="nv">trainingDF</span> <span class="k">=</span> <span class="nf">trainTest</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="k">val</span> <span class="nv">testDF</span> <span class="k">=</span> <span class="nf">trainTest</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    
<span class="c1">// Now create our linear regression model</span>
<span class="k">val</span> <span class="nv">lir</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LinearRegression</span><span class="o">()</span>
      <span class="o">.</span><span class="py">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span> <span class="c1">// regularization </span>
      <span class="o">.</span><span class="py">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">)</span> <span class="c1">// elastic net mixing</span>
      <span class="o">.</span><span class="py">setMaxIter</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span> <span class="c1">// max iterations</span>
      <span class="o">.</span><span class="py">setTol</span><span class="o">(</span><span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">6</span><span class="o">)</span> <span class="c1">// convergence tolerance</span>
    
<span class="c1">// Train the model using our training data</span>
<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">lir</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">trainingDF</span><span class="o">)</span>
    
<span class="c1">// Now see if we can predict values in our test data.</span>
<span class="c1">// Generate predictions using our linear regression model for all features in our </span>
<span class="c1">// test dataframe:</span>
<span class="k">val</span> <span class="nv">fullPredictions</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">testDF</span><span class="o">).</span><span class="py">cache</span><span class="o">()</span>
    
<span class="c1">// This basically adds a "prediction" column to our testDF dataframe.</span>
    
<span class="c1">// Extract the predictions and the "known" correct labels.</span>
<span class="k">val</span> <span class="nv">predictionAndLabel</span> <span class="k">=</span> <span class="nv">fullPredictions</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"prediction"</span><span class="o">,</span> <span class="s">"label"</span><span class="o">).</span><span class="py">collect</span><span class="o">()</span>
</code></pre></div></div>

<h2 id="decision-tree">Decision Tree</h2>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VectorAssembler</span>

<span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.DecisionTreeRegressor</span>

<span class="c1">// skip load data //</span>

<span class="k">val</span> <span class="nv">assembler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">()</span>
   <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"HouseAge"</span><span class="o">,</span> <span class="s">"DistanceToMRT"</span><span class="o">,</span> <span class="s">"NumberConvenienceStroes"</span><span class="o">))</span>
   <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">assembler</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dsRaw</span><span class="o">)</span>
   <span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"PriceOfUnitArea"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">trainTest</span> <span class="k">=</span> <span class="nv">df</span><span class="o">.</span><span class="py">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.5</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">traningDF</span> <span class="k">=</span> <span class="nf">trainTest</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">testDF</span> <span class="k">=</span> <span class="nf">trainTest</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">lir</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DecisionTreeRegressor</span><span class="o">()</span>
<span class="o">.</span><span class="py">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
<span class="o">.</span><span class="py">setLabelCol</span><span class="o">(</span><span class="s">"PriceOfUnitArea"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">lir</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">traingDF</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">fullPredictions</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">testDF</span><span class="o">).</span><span class="py">cache</span><span class="o">()</span>

<span class="k">val</span> <span class="nv">predictionAndLabel</span> <span class="k">=</span> <span class="nv">fullPredictions</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"prediction"</span><span class="o">,</span> <span class="s">"PriceOfUnitArea"</span><span class="o">)</span>
</code></pre></div></div>

<p>예시로 제공된 3개 모두 모델에 대한 평가를 하지 않고 있는데, <code class="language-plaintext highlighter-rouge">org.apache.spark.ml.evaluation</code>  내에 클래스를 통해 학습에 대한 평가를 확인할 수 있습니다.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span>

<span class="k">val</span> <span class="nv">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RegressionEvaluator</span><span class="o">()</span>
      <span class="o">.</span><span class="py">setMetricName</span><span class="o">(</span><span class="s">"rmse"</span><span class="o">)</span>
      <span class="o">.</span><span class="py">setLabelCol</span><span class="o">(</span><span class="s">"PriceOfUnitArea"</span><span class="o">)</span>
      <span class="o">.</span><span class="py">setPredictionCol</span><span class="o">(</span><span class="s">"prediction"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">rmse</span> <span class="k">=</span> <span class="nv">evaluator</span><span class="o">.</span><span class="py">evaluate</span><span class="o">(</span><span class="n">fullPredictions</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"RMSE error = $rmse"</span><span class="o">)</span>
</code></pre></div></div>

<p>[참고]</p>

<p><a href="https://www.udemy.com/course/best-scala-apache-spark/">Learning Apache Spark 3 with Scala</a></p>

<p><a href="https://spark.apache.org/docs/latest/ml-guide.html">Spark ML lib Gruide</a></p>

<p><a href="https://www.nvidia.com/ko-kr/ai-data-science/spark-ebook/gpu-accelerated-spark-3/">데이터 사이언스 가이드</a></p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to Gyuhoon Kim</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

                </section>
             -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/GyuhoonK.jpg" alt="GyuhoonK" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/GyuhoonK">GyuhoonK</a></h4>
                                
                                    <p>Read <a href="/author/GyuhoonK">more posts</a> by this author.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/GyuhoonK">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            var this_page_url = 'https://gyuhoonk.github.io/sparkscala7';
                            var this_page_identifier = '/sparkscala7';
                            var this_page_title = 'Learning Apache Spark 3 with Scala (Section7)';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://xxxxxxxx.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/spain-blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Gyuhoon Kim &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/scala/">Scala</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/sparkscala8">Learning Apache Spark 3 with Scala (Section8)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/sparkscala6">Learning Apache Spark 3 with Scala (Section6)</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/sparkscala5">Learning Apache Spark 3 with Scala (Section5)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/scala/">
                                
                                    See all 7 posts  →
                                
                            </a>
                        </footer>
                    </article>
                <script type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
                </script>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/sparkscala8">
                <div class="post-card-image" style="background-image: url(/assets/built/images/scala-banner-post.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/sparkscala8">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Scala</span>
                            
                        
                    

                    <h2 class="post-card-title">Learning Apache Spark 3 with Scala (Section8)</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>Learning Apache Spark 3 with Scala (Section8 -Spark Streaming)

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/GyuhoonK.jpg" alt="GyuhoonK" />
                        
                        <span class="post-card-author">
                            <a href="/author/GyuhoonK/">GyuhoonK</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      2 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/enableHiveSupport">
                <div class="post-card-image" style="background-image: url(/assets/built/images/hadoop/sparkhive.jpeg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/enableHiveSupport">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Hadoop</span>
                            
                        
                    

                    <h2 class="post-card-title">enableHiveSupport</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>Spark enableHiveSupport(Hive metaStore)

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/GyuhoonK.jpg" alt="GyuhoonK" />
                        
                        <span class="post-card-author">
                            <a href="/author/GyuhoonK/">GyuhoonK</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      2 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://gyuhoonk.github.io/">
            
            <span>Gyuhoon Kim</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Learning Apache Spark 3 with Scala (Section7)</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Learning+Apache+Spark+3+with+Scala+%28Section7%29&amp;url=https://gyuhoonk.github.iosparkscala7"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://gyuhoonk.github.iosparkscala7"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://gyuhoonk.github.io/">Gyuhoon Kim</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Subscribe to Gyuhoon Kim</h1>
                <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
                <form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>

            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
<script type="text/javascript" async
	src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
	extensions: ["tex2jax.js"],
	jax: ["input/TeX", "output/HTML-CSS"],
	tex2jax: {
		inlineMath: [ ['$','$'], ["\\(","\\)"] ],
		displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
		processEscapes: true
	},
	"HTML-CSS": { availableFonts: ["TeX"] }
});
</script>
    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->
    <!-- math LaTex-->
    
</body>
</html>
