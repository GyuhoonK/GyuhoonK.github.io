<?xml version="1.0" encoding="utf-8"?>

<feed xmlns="http://www.w3.org/2005/Atom" >
  <generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator>
  <link href="https://gyuhoonk.github.io/tag/hadoop/feed.xml" rel="self" type="application/atom+xml" />
  <link href="https://gyuhoonk.github.io/" rel="alternate" type="text/html" />
  <updated>2026-02-24T16:31:53+09:00</updated>
  <id>https://gyuhoonk.github.io/tag/hadoop/feed.xml</id>

  
  
  

  
    <title type="html">Gyuhoon Kim | </title>
  

  
    <subtitle>Data Engineering</subtitle>
  

  

  
    
      
    
  

  
  

  
    <entry>
      <title type="html">HDFSì™€ S3 ë¹„êµí•˜ê¸°</title>
      <link href="https://gyuhoonk.github.io/hdfs-s3" rel="alternate" type="text/html" title="HDFSì™€ S3 ë¹„êµí•˜ê¸°" />
      <published>2026-02-21T22:30:00+09:00</published>
      <updated>2026-02-21T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/hdfs-s3</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/hdfs-s3">&lt;p&gt;ìŠ¤í† ë¦¬ì§€ì˜ ì–‘ëŒ€ ì‚°ë§¥: HDFSì™€ S3ë¥¼ ë¹„êµí•´ë´…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ê³¼ê±° On-premise í™˜ê²½ì—ì„œëŠ” Hadoop ìƒíƒœê³„ì˜ &lt;strong&gt;HDFS(Hadoop Distributed File System)&lt;/strong&gt;ê°€ ì ˆëŒ€ì ì¸ í‘œì¤€ì´ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Cloud Native í™˜ê²½ê³¼ Modern Data Stackì´ ë°œì „í•˜ë©´ì„œ í˜„ì¬ëŠ” Amazon S3ì™€ ê°™ì€ Object Storageê°€ ëŒ€ì„¸ë¡œ ìë¦¬ ì¡ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì˜¤ëŠ˜ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë‘ ìŠ¤í† ë¦¬ì§€ì˜ ê·¼ë³¸ì ì¸ ì•„í‚¤í…ì²˜ ì°¨ì´ë¶€í„° ë°ì´í„° ìˆ˜ì • ë°©ì‹, Network I/Oì˜ ë”œë ˆë§ˆ, ê·¸ë¦¬ê³  ë°ì´í„°ë¥¼ ì™„ë²½í•˜ê²Œ ë³´í˜¸í•˜ëŠ” Fault Tolerance ë©”ì»¤ë‹ˆì¦˜ê¹Œì§€ ëª¨ë‘ ì¢…í•©í•˜ì—¬ íŒŒí—¤ì³ ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;1-storage-paradigm-hierarchical-vs-flat-namespace&quot;&gt;1. Storage Paradigm: Hierarchical vs. Flat Namespace&lt;/h1&gt;
&lt;p&gt;ë‘ ìŠ¤í† ë¦¬ì§€ì˜ ê°€ì¥ í° ì°¨ì´ëŠ” ë°ì´í„°ë¥¼ êµ¬ì¡°í™”í•˜ê³  ì‹ë³„í•˜ëŠ” ë°©ì‹ì— ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;hdfs-hierarchical-directory-structure&quot;&gt;HDFS: Hierarchical Directory Structure&lt;/h2&gt;
&lt;p&gt;HDFSëŠ” ìš°ë¦¬ê°€ í”íˆ ì“°ëŠ” Linux File Systemê³¼ ë™ì¼í•œ &lt;strong&gt;Hierarchical(ê³„ì¸µí˜•) êµ¬ì¡°&lt;/strong&gt;ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³  ê·¸ ì•ˆì— íŒŒì¼ì„ ë„£ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. í° íŒŒì¼ì€ ë³´í†µ 128MB í¬ê¸°ì˜ Block ë‹¨ìœ„ë¡œ ìª¼ê°œì ¸ ì—¬ëŸ¬ ëŒ€ì˜ ì„œë²„(DataNode)ì— ë¶„ì‚° ì €ì¥ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;s3-flat-namespaceì™€-key&quot;&gt;S3: Flat Namespaceì™€ Key&lt;/h2&gt;
&lt;p&gt;ë°˜ë©´ S3ëŠ” Object Storageì…ë‹ˆë‹¤. S3ì— ì €ì¥ë˜ëŠ” object keyë¥¼ ë³´ë©´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;logs/2026/02/21/app.log&lt;/code&gt; ì²˜ëŸ¼ í´ë” êµ¬ì¡°ê°€ ìˆëŠ” ê²ƒ ê°™ì§€ë§Œ, ì´ëŠ” ì‹œê°ì ì¸ ë Œë”ë§ì— ë¶ˆê³¼í•©ë‹ˆë‹¤. ì‹¤ì œ S3 ë‚´ë¶€ëŠ” &lt;strong&gt;ë””ë ‰í† ë¦¬ ê°œë…ì´ ì—†ëŠ” ì™„ë²½í•œ Flat Namespace&lt;/strong&gt;ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;-ê¸°ìˆ ì -ì°¨ì´-metadata-bottleneckê³¼-namespace-êµ¬ì¡°&quot;&gt;ğŸ’¡ ê¸°ìˆ ì  ì°¨ì´: Metadata Bottleneckê³¼ Namespace êµ¬ì¡°&lt;/h3&gt;

&lt;p&gt;íŒŒì¼ì´ ìˆ˜ì–µ ê°œ ì´ìƒìœ¼ë¡œ ëŠ˜ì–´ë‚˜ëŠ” Big Data í™˜ê²½ì—ì„œ ìŠ¤í† ë¦¬ì§€ë¥¼ í‰ê°€í•  ë•Œ, ê°€ì¥ ëˆˆì—¬ê²¨ë´ì•¼ í•  ê¸°ìˆ ì  ì°¨ì´ëŠ” &lt;strong&gt;Namespace êµ¬ì¡°ì— ë”°ë¥¸ Metadata ì²˜ë¦¬ ë°©ì‹&lt;/strong&gt;ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;HDFS (Hierarchical Treeì˜ í•œê³„):&lt;/strong&gt; HDFSëŠ” ì „í†µì ì¸ íŒŒì¼ ì‹œìŠ¤í…œì²˜ëŸ¼ ë””ë ‰í† ë¦¬ ê¸°ë°˜ì˜ Tree êµ¬ì¡°ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ë”°ë¼ì„œ íŠ¹ì • íŒŒì¼ì— ì ‘ê·¼í•˜ë ¤ë©´ ë§ˆìŠ¤í„° ì„œë²„(NameNode)ê°€ Root ë””ë ‰í† ë¦¬ë¶€í„° í•˜ìœ„ í´ë”ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ íƒ€ê³  ë‚´ë ¤ê°€ë©°(Traversal) ê¶Œí•œê³¼ ìœ„ì¹˜ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. íŒŒì¼ ê°œìˆ˜ê°€ ìˆ˜ì–µ ê°œë¡œ ê¸‰ì¦í•˜ë©´ ì´ Treeë¥¼ ìˆœíšŒí•˜ê³  ê´€ë¦¬í•˜ëŠ” ë©”íƒ€ë°ì´í„° ì—°ì‚° ìì²´ê°€ ì—„ì²­ë‚œ &lt;strong&gt;Bottleneck(ë³‘ëª©)&lt;/strong&gt;ì„ ìœ ë°œí•˜ë©°, NameNodeì˜ ë©”ëª¨ë¦¬ í•œê³„ê°€ ê³§ í´ëŸ¬ìŠ¤í„° ì „ì²´ì˜ ìš©ëŸ‰ í•œê³„ê°€ ë©ë‹ˆë‹¤.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;S3 (Flat Namespaceì™€ $O(1)$ ì ‘ê·¼):&lt;/strong&gt; ë°˜ë©´ S3ëŠ” ë””ë ‰í† ë¦¬ë¼ëŠ” ê°œë… ìì²´ê°€ ì—†ëŠ” í‰ë©´ì ì¸(Flat) êµ¬ì¡°ì˜ Object Storageì…ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;logs/2026/02/21/app.log&lt;/code&gt; ì²˜ëŸ¼ í´ë” ê²½ë¡œì²˜ëŸ¼ ë³´ì´ëŠ” ì „ì²´ ë¬¸ìì—´ì€ ì‚¬ì‹¤ ê²½ë¡œê°€ ì•„ë‹ˆë¼, ê·¸ ìì²´ë¡œ ë‹¨ì¼í•˜ê³  ê³ ìœ í•œ &lt;strong&gt;Key(ì‹ë³„ì)&lt;/strong&gt;ì— ë¶ˆê³¼í•©ë‹ˆë‹¤. S3ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ìˆœíšŒí•  í•„ìš” ì—†ì´ ì´ Key ê°’ì„ í†µí•´ Hash Tableì²˜ëŸ¼ Objectì˜ ë¬¼ë¦¬ì  ìœ„ì¹˜ì— $O(1)$ ì‹œê°„ ë³µì¡ë„ë¡œ ì§ì ‘ ì ‘ê·¼í•©ë‹ˆë‹¤. ì´ ë•ë¶„ì— ë‹¨ì¼ ë§ˆìŠ¤í„° ë…¸ë“œì˜ ë³‘ëª© ì—†ì´, ë¬´í•œì— ê°€ê¹Œìš´ ê·¹ë‹¨ì ì¸ Scale-out í™˜ê²½ì„ ì•ˆì •ì ìœ¼ë¡œ ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;2-data-update-mechanism-append-only-vs-immutable&quot;&gt;2. Data Update Mechanism: Append-only vs Immutable&lt;/h1&gt;
&lt;p&gt;ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ìˆ˜ì •í•˜ê³  ê°±ì‹ í•˜ëŠ”ì§€ë„ ì•„í‚¤í…ì²˜ ì„ íƒì— í° ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;hdfs-append-only&quot;&gt;HDFS (Append-only)&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;í•œ ë²ˆ ì“°ì¸ ë°ì´í„°ì˜ ì¤‘ê°„ì„ ìˆ˜ì •(Update)í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì˜ ëì— ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì´ì–´ ì“°ëŠ” Append-only ì—°ì‚°ë§Œ ì§€ì›í•©ë‹ˆë‹¤.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;êµ¬ì²´ì ì¸ ì˜ˆì‹œ: Debezium ê°™ì€ CDC íˆ´ë¡œ RDBMSì˜ ë³€ê²½ ì‚¬í•­ì„ ìº¡ì²˜í•  ë•Œ, user_id: 1ì˜ ì´ë¦„ì´ â€œAâ€ì—ì„œ â€œBâ€ë¡œ ë°”ë€Œë©´ ê¸°ì¡´ â€œAâ€ë¥¼ ì°¾ì•„ ë®ì–´ì“°ì§€ ì•ŠìŠµë‹ˆë‹¤. íŒŒì¼ ë§¨ ëì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{&quot;user_id&quot;: 1, &quot;name&quot;: &quot;B&quot;, &quot;op&quot;: &quot;update&quot;}&lt;/code&gt; ë¡œê·¸ë¥¼ ì¶”ê°€(Append)í•©ë‹ˆë‹¤. ì´í›„ ì—°ì‚° ì—”ì§„(Spark, Flink ë“±)ì´ ìµœì‹  Timestampë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœì¢… ìƒíƒœë¥¼ ë³‘í•©(Merge)í•©ë‹ˆë‹¤.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;s3-immutable&quot;&gt;S3 (Immutable)&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;ë°ì´í„°ê°€ ì•„ì˜ˆ ë¶ˆë³€(Immutable)í•©ë‹ˆë‹¤. ë°ì´í„°ì˜ ì¼ë¶€ë§Œ ìˆ˜ì •í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ë©°, ìˆ˜ì •ì´ í•„ìš”í•˜ë©´ ì „ì²´ Objectë¥¼ ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ë®ì–´ì”Œì›Œì•¼(Overwrite) í•©ë‹ˆë‹¤.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;3-data-localityì™€-network-ioì˜-ë”œë ˆë§ˆ&quot;&gt;3. Data Localityì™€ Network I/Oì˜ ë”œë ˆë§ˆ&lt;/h1&gt;
&lt;p&gt;ì„±ëŠ¥ì— ê°€ì¥ í° ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ê²ƒì€ ë°ì´í„°ì™€ ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤ì˜ ë¬¼ë¦¬ì  ìœ„ì¹˜ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;hdfsì˜-ë¬´ê¸°-data-locality&quot;&gt;HDFSì˜ ë¬´ê¸°: Data Locality&lt;/h2&gt;
&lt;p&gt;HDFSëŠ” Coupled(ê²°í•©ëœ) ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤. Spark Executorê°€ ì—°ì‚°ì„ ìˆ˜í–‰í•  ë•Œ, ìì‹ ì´ ë–  ìˆëŠ” ë°”ë¡œ ê·¸ ì„œë²„ì˜ ë¡œì»¬ ë””ìŠ¤í¬ì—ì„œ ë°ì´í„°ë¥¼ ì§ì ‘ ì½ìŠµë‹ˆë‹¤. ì´ Data Locality ë•ë¶„ì— Networkë¥¼ íƒ€ì§€ ì•Šê³  ìˆœìˆ˜ Disk I/Oë§Œ ë°œìƒí•˜ì—¬ ì†ë„ê°€ ë§¤ìš° ë¹ ë¦…ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;s3ì˜-ë¬¸ì œì -network-io&quot;&gt;S3ì˜ ë¬¸ì œì : Network I/O&lt;/h2&gt;
&lt;p&gt;S3ëŠ” Separation of Compute and Storage(ì»´í“¨íŒ…ê³¼ ìŠ¤í† ë¦¬ì§€ì˜ ë¶„ë¦¬) ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤. Sparkê°€ S3ì— ìˆëŠ” ë°ì´í„°ë¥¼ ì½ìœ¼ë ¤ë©´ ë°˜ë“œì‹œ REST APIë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ë¥¼ íƒ€ê³  íŒ¨í‚·ì„ ë‹¤ìš´ë¡œë“œí•´ì•¼ í•˜ëŠ” Network I/Oê°€ ë°œìƒí•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;on-premise-s3ë¥¼-êµ¬ì¶•í•œë‹¤ë©´&quot;&gt;On-premise S3ë¥¼ êµ¬ì¶•í•œë‹¤ë©´?&lt;/h2&gt;
&lt;p&gt;ì‚¬ë‚´ ë§ì— MinIO ê°™ì€ ì˜¤í”ˆì†ŒìŠ¤ë¡œ S3ë¥¼ ì§ì ‘ êµ¬ì¶•í•˜ë©´ AWSë¥¼ ì“¸ ë•Œë³´ë‹¤ LatencyëŠ” ëŒ€í­ ì¤„ì–´ë“­ë‹ˆë‹¤. í•˜ì§€ë§Œ Compute ë…¸ë“œì™€ Storage ë…¸ë“œê°€ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì€ ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ˆê³ ì† Local Switch ë§ì„ íƒ€ì•¼ í•˜ë¯€ë¡œ, íƒœìƒì ì¸ Network OverheadëŠ” ì—¬ì „íˆ ì¡´ì¬í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;ê·¸ëŸ¼ì—ë„-s3-êµ¬ì¡°ë¥¼-ì„ íƒí•˜ëŠ”-ì´ìœ &quot;&gt;ê·¸ëŸ¼ì—ë„ S3 êµ¬ì¡°ë¥¼ ì„ íƒí•˜ëŠ” ì´ìœ &lt;/h2&gt;
&lt;p&gt;í˜„ëŒ€ì˜ 100GbE ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ì€ ì¼ë°˜ì ì¸ SSDì˜ Disk I/O ì†ë„ë¥¼ ì¶”ì›”í–ˆìŠµë‹ˆë‹¤. Network Overheadê°€ ì˜ˆì „ë§Œí¼ ì¹˜ëª…ì ì¸ Bottleneckì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì—, Computeì™€ Storageë¥¼ ë¶„ë¦¬í•˜ì—¬ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë§Œ ë…ë¦½ì ìœ¼ë¡œ Scale-out í•˜ëŠ” ìœ ì—°ì„±ê³¼ ë¹„ìš© íš¨ìœ¨ì„±ì„ ì·¨í•˜ëŠ” ê²ƒì´ ì‹¤ë¬´ì ìœ¼ë¡œ ì••ë„ì ì¸ ì´ë“ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;4-fault-tolerance-3-way-replication-vs-erasure-coding&quot;&gt;4. Fault Tolerance: 3-way Replication vs Erasure Coding&lt;/h1&gt;
&lt;p&gt;ì„œë²„ì— ë¶ˆì´ ë‚˜ê±°ë‚˜ ë””ìŠ¤í¬ê°€ íŒŒê´´ë˜ëŠ” â€œì™„ì „ ì†ì‹¤â€ ìƒí™©ì—ì„œ ë‘ ìŠ¤í† ë¦¬ì§€ëŠ” ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ë³µêµ¬í• ê¹Œìš”?&lt;/p&gt;

&lt;h2 id=&quot;hdfs-3-way-replication&quot;&gt;HDFS: 3-way Replication&lt;/h2&gt;

&lt;p&gt;HDFSëŠ” ë°ì´í„° Block í•˜ë‚˜ë¥¼ ì„œë¡œ ë‹¤ë¥¸ 3ëŒ€ì˜ DataNodeì— ë˜‘ê°™ì´ ë³µì‚¬í•´ ë‘¡ë‹ˆë‹¤.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ë³µêµ¬ ë°©ì‹: íŠ¹ì • DataNodeê°€ ì™„ì „íˆ íŒŒê´´ë˜ì–´ ë°ì´í„°ê°€ ì†ì‹¤ë˜ì–´ë„, ë‹¤ë¥¸ ë…¸ë“œì— ë˜‘ê°™ì€ ë°ì´í„°ê°€ ì‚´ì•„ìˆìŠµë‹ˆë‹¤. ì‚´ì•„ìˆëŠ” ë…¸ë“œì—ì„œ ìƒˆë¡œìš´ ë…¸ë“œë¡œ ë°ì´í„°ë¥¼ ë‹¨ìˆœíˆ ë„¤íŠ¸ì›Œí¬ ë³µì‚¬(Copy)í•˜ë©´ ë³µêµ¬ê°€ ëë‚©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ë‹¨ì : Storage Overheadê°€ &lt;strong&gt;300%&lt;/strong&gt;ì…ë‹ˆë‹¤. 1PBì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë ¤ë©´ 3PBì˜ ë¬¼ë¦¬ì  ë””ìŠ¤í¬ê°€ í•„ìš”í•  ì •ë„ë¡œ ê·¹ë„ë¡œ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;s3-erasure-coding&quot;&gt;S3: Erasure Coding&lt;/h2&gt;

&lt;p&gt;Erasure Coding(EC)ì€ ë°ì´í„°ë¥¼ $k$ê°œì˜ Data Chunkë¡œ ìª¼ê°œê³ , ë³µêµ¬ë¥¼ ìœ„í•œ $m$ê°œì˜ Parity Chunkë¥¼ ìˆ˜í•™ì ìœ¼ë¡œ ê³„ì‚°í•´ ëƒ…ë‹ˆë‹¤. ì´ $n$ ($n = k + m$)ê°œì˜ Chunkë¥¼ ì„œë¡œ ë‹¤ë¥¸ ë…¸ë“œì— ë¶„ì‚° ì €ì¥í•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ë³µêµ¬ ë°©ì‹: íŠ¹ì • ë…¸ë“œì— ë²¼ë½ì´ ë–¨ì–´ì ¸ ì›ë³¸ Data Chunkê°€ ì™„ì „íˆ ì†ì‹¤ë˜ë”ë¼ë„ ë³µêµ¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‚´ì•„ë‚¨ì€ Data Chunkì™€ Parity Chunk ì¤‘ ì–´ë–¤ ì¢…ë¥˜ë“  ìƒê´€ì—†ì´ $k$ê°œë§Œ ì˜¨ì „íˆ ì‚´ì•„ìˆë‹¤ë©´, í–‰ë ¬ ì—­ì—°ì‚°ì„ í†µí•´ ì†Œì‹¤ëœ ì›ë³¸ ë°ì´í„°ë¥¼ 100% ì™„ë²½í•˜ê²Œ ì¬êµ¬ì„±(Reconstruct)í•´ ëƒ…ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ì¥ì : Storage Overheadê°€ 4+2 êµ¬ì„± ê¸°ì¤€ 150% ìˆ˜ì¤€ìœ¼ë¡œ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤. ì ì€ ë””ìŠ¤í¬ ìš©ëŸ‰ìœ¼ë¡œë„ HDFS ì´ìƒì˜ ë‚´ê²°í•¨ì„±(Fault Tolerance)ì„ ì œê³µí•©ë‹ˆë‹¤. (ë‹¨, ë³µêµ¬ ì‹œ CPU ì—°ì‚° ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.)&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;5-modern-data-ecosystem-dbtì™€-s3ì˜-ë§Œë‚¨&quot;&gt;5. Modern Data Ecosystem: dbtì™€ S3ì˜ ë§Œë‚¨&lt;/h1&gt;
&lt;p&gt;í˜„ì¬ ì‹¤ë¬´ì—ì„œ S3ê°€ ì‚¬ì‹¤ìƒ í‘œì¤€(De facto standard)ìœ¼ë¡œ ìë¦¬ ì¡ì€ ì´ìœ ëŠ” ìƒíƒœê³„ì˜ ì™„ë²½í•œ ì§€ì› ë•ë¶„ì…ë‹ˆë‹¤. HDFSëŠ” ìœ ì§€ë³´ìˆ˜ ë¦¬ì†ŒìŠ¤ê°€ ì—„ì²­ë‚˜ê²Œ ë“œëŠ” ë°˜ë©´, S3ëŠ” Fully Managed ì„œë¹„ìŠ¤ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;íŠ¹íˆ ìµœê·¼ Modern Data Stackì˜ í•µì‹¬ì¸ &lt;strong&gt;dbt(data build tool)&lt;/strong&gt;ë¥¼ ë³´ë©´ ì´ë¥¼ ëª…í™•íˆ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³¼ê±°ì—ëŠ” S3 ë°ì´í„°ë¥¼ ë¶„ì„í•˜ë ¤ë©´ Data Warehouseë¡œ ë³µì‚¬(Load)í•´ì•¼ í–ˆì§€ë§Œ, ì§€ê¸ˆì€ dbt-spark, dbt-athena ë“±ì„ í†µí•´ S3ë¥¼ &lt;strong&gt;First-class citizen(ì¼ê¸‰ ì‹œë¯¼)&lt;/strong&gt;ìœ¼ë¡œ ëŒ€ìš°í•©ë‹ˆë‹¤. ë°ì´í„° ì´ë™ ì—†ì´ S3 raw ë²„í‚·ì„ ì§ì ‘ ì†ŒìŠ¤ë¡œ ë§¤í•‘í•˜ê³ , SQL ë³€í™˜ ê²°ê³¼ë¥¼ ë‹¤ì‹œ S3 ìœ„ì— Apache Icebergë‚˜ Parquet í¬ë§·ìœ¼ë¡œ ì§ì ‘ Materialize(êµ¬ì²´í™”) í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;6-summary-ì‹¤ë¬´-ì•„í‚¤í…ì²˜ì˜-ìµœì¢…-ì„ íƒ&quot;&gt;6. Summary: ì‹¤ë¬´ ì•„í‚¤í…ì²˜ì˜ ìµœì¢… ì„ íƒ&lt;/h1&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ë¹„êµ í•­ëª© (Category)&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;HDFS (Hadoop Distributed File System)&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;S3 (Object Storage)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Namespace (êµ¬ì¡°)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Hierarchical Tree (ê³„ì¸µí˜• ë””ë ‰í† ë¦¬ êµ¬ì¡°)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Flat Namespace (Key ê¸°ë°˜ $O(1)$ ì§ì ‘ ì ‘ê·¼)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Data Update (ìˆ˜ì •)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Append-only (ë°ì´í„° ì´ì–´ì“°ê¸°ë§Œ ê°€ëŠ¥)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Immutable (ë°ì´í„° ë¶ˆë³€, ì „ì²´ ë®ì–´ì“°ê¸° í•„ìš”)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Architecture (ì„¤ê³„)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Coupled (Computeì™€ Storage ê²°í•©, Data Locality í™œìš©)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Separated (Computeì™€ Storage ë¶„ë¦¬, ë…ë¦½ì  Scale-out)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;I/O Type (ì…ì¶œë ¥)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Disk I/O (ë¡œì»¬ ë””ìŠ¤í¬ ì§ì ‘ ì ‘ê·¼)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Network I/O (HTTP REST APIë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ í†µì‹ )&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Fault Tolerance (ë³µêµ¬)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;3-way Replication (ë‹¨ìˆœ ë³µì‚¬, Storage Overhead 300%)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Erasure Coding (ìˆ˜í•™ì  ë³µì›, Storage Overhead ì•½ 150%)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Best Use Case (ì¶”ì²œ)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ê¸°ì¡´ On-premise í™˜ê²½, ê·¹ë‹¨ì ì¸ Low Latencyê°€ í•„ìš”í•œ Batch&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;í˜„ëŒ€ì ì¸ Data Lake êµ¬ì¶•, Cloud Native ë° dbt ê¸°ë°˜ íŒŒì´í”„ë¼ì¸&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;ê²°ë¡ &quot;&gt;ê²°ë¡ &lt;/h1&gt;
&lt;p&gt;ì´ë¯¸ ê±°ëŒ€í•œ On-premise ì¸í”„ë¼ë¥¼ ìš´ì˜ ì¤‘ì´ê³  ì´ˆê³ ì† ë¡œì»¬ I/Oê°€ í•„ìˆ˜ì ì¸ íŠ¹ìˆ˜ í™˜ê²½ì´ ì•„ë‹ˆë¼ë©´, í™•ì¥ì„±, ë¹„ìš©, ìƒíƒœê³„ í˜¸í™˜ì„±ì„ ëª¨ë‘ ê°–ì¶˜ S3 ê¸°ë°˜ì˜ Separation Architectureë¥¼ ì±„íƒí•˜ëŠ” ê²ƒì´ í˜„ëŒ€ ë°ì´í„° í”Œë«í¼ ì„¤ê³„ì˜ Best Practiceì…ë‹ˆë‹¤.&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">ìŠ¤í† ë¦¬ì§€ì˜ ì–‘ëŒ€ ì‚°ë§¥: HDFSì™€ S3ë¥¼ ë¹„êµí•´ë´…ë‹ˆë‹¤.</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Salting in Spark</title>
      <link href="https://gyuhoonk.github.io/spark-salting" rel="alternate" type="text/html" title="Salting in Spark" />
      <published>2023-12-30T22:30:00+09:00</published>
      <updated>2023-12-30T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/spark-salting</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/spark-salting">&lt;p&gt;Data Skewnessë¥¼ í•´ê²°í•˜ëŠ” Spark Salting Key ê¸°ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;what-is-salting-in-spark&quot;&gt;What is Salting in Spark?&lt;/h3&gt;

&lt;p&gt;ìš”ë¦¬ë¥¼ í•  ë•Œ ì†Œê¸ˆì„ ë¿Œë¦¼ìœ¼ë¡œì¨ ì¬ë£Œì˜ ë§›ê³¼ í–¥ì„ ë”í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. sparkì˜ salting ê¸°ë²•ë„ ìš”ë¦¬ì—ì„œ ì†Œê¸ˆì„ ë¿Œë¦¬ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•©ë‹ˆë‹¤. ë°ì´í„°ê°€ ë” ì˜ ì²˜ë¦¬ë  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;saltingì´ë€ sparkì—ì„œ shuffle joiní•˜ëŠ” ê²½ìš°ì— ë°œìƒí•  ìˆ˜ ìˆëŠ” ë°ì´í„° ë¶ˆê· í˜•(skewness)ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;Sparkì—ì„œ skewnessëŠ” ì„±ëŠ¥ ì €í•˜ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;bottle neck&lt;br /&gt;
skewnessê°€ ìˆëŠ” ê²½ìš° spark job ì™„ë£Œê¹Œì§€ ì†Œìš”ë˜ëŠ” ì‹œê°„(ê°€ë™ ì‹œê°„, Total uptime)ì´ ëŠ˜ì–´ë‚©ë‹ˆë‹¤. spark jobì—ì„œ 10ê°œì˜ taskë¥¼ ì²˜ë¦¬í•  ë•Œ, 9ê°œì˜ taskëŠ” 10ì´ˆë§Œì— ì™„ë£Œí•˜ë”ë¼ë„ 1ê°œ taskì˜ ì²˜ë¦¬ì— 100ì´ˆê°€ ì†Œìš”ëœë‹¤ë©´ ì „ì²´ spark jobì˜ total uptimeì€ 100ì´ˆì…ë‹ˆë‹¤. skewnessê°€ ë°œìƒí•˜ëŠ” ê²½ìš° ì•ì„  ì˜ˆì‹œì²˜ëŸ¼ skewnessê°€ ìˆëŠ” ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” taskì˜ ìˆ˜í–‰ì‹œê°„ì´ ë‹¤ë¥¸ taskì— ë¹„í•´ ëŠ˜ì–´ë‚˜ê²Œ ë˜ê³ , ì „ì²´ spark jobì˜ uptimeì„ ì¦ê°€ì‹œí‚¤ëŠ” bottle neckì„ ìœ ë°œí•©ë‹ˆë‹¤.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;job fail&lt;br /&gt;
skewnessëŠ” spark jobì˜ ì‹¤íŒ¨ë¥¼ ì´ˆë˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. íŠ¹ì • taskê°€ ì²˜ë¦¬í•´ì•¼í•  ë°ì´í„°ê°€ í• ë‹¹ë°›ì€ ë¦¬ì†ŒìŠ¤ì˜ ì²˜ë¦¬ ëŠ¥ë ¥ì„ ë„˜ëŠ”ë‹¤ë©´ task failì´ ë°œìƒí•˜ê²Œ ë˜ê³  ì´ëŠ” spark jobì˜ ì‹¤íŒ¨ë¡œ ì´ì–´ì§ˆ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;salting ê¸°ë²•ì€ ìƒˆë¡œìš´ JOIN KEY(SALTING KEY)ë¥¼ ì¶”ê°€í•˜ì—¬ skewnessë¥¼ í•´ê²°í•©ë‹ˆë‹¤. salting keyë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ê°€ í•œë²ˆ ë” ë¶„ì‚°ë˜ê¸° ë•Œë¬¸ì—, join ì—°ì‚° ê°„ì— íŠ¹ì • íŒŒí‹°ì…˜ì—ë§Œ ë°ì´í„°ê°€ ì ë¦¬ëŠ” í˜„ìƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;example&quot;&gt;Example&lt;/h3&gt;

&lt;p&gt;êµ¬ì²´ì ì¸ ì˜ˆì‹œë¡œ salting key ê¸°ë²•ì´ ì ìš©ë˜ëŠ” ê³¼ì •ì„ ì„¤ëª…í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë¨¼ì € skewnessê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ìƒí™©ì„ ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/salting_example_1.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;log&lt;/code&gt;ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt; ì´ë¼ëŠ” DataFrameì´ ì¡´ì¬í•œë‹¤ê³  ê°€ì •í–ˆìŠµë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;log&lt;/code&gt;ì— ê° ìœ ì €(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt;)ì˜ typeì„ ì¶”ê°€í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'left'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;type ì»¬ëŸ¼ì„ ì¶”ê°€í•˜ê³ ë ¤ëŠ” ëª©ì ì€ ë‹¬ì„±í•  ìˆ˜ ìˆìœ¼ë‚˜ ìœ„ì™€ ê°™ì€ ê²½ìš°ì— data skewnessê°€ ë°œìƒí•©ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt;ê°€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;e&lt;/code&gt;ì¸ ê²½ìš°ì— í•´ë‹¹í•˜ëŠ” rowê°€ 6ê°œì…ë‹ˆë‹¤. ë”°ë¼ì„œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt;ë§Œì„ ê°€ì§€ê³  joiní•˜ëŠ” ê²½ìš° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;e&lt;/code&gt;ë¥¼ ì²˜ë¦¬í•˜ëŠ” íŒŒí‹°ì…˜ ì‚¬ì´ì¦ˆê°€ ë‹¤ë¥¸ íŒŒí‹°ì…˜(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;a~d&lt;/code&gt;ë¥¼ ì²˜ë¦¬í•˜ëŠ” íŒŒí‹°ì…˜)ì— ë¹„í•´ ì»¤ì§€ê²Œ ë©ë‹ˆë‹¤.&lt;br /&gt;
ìƒëŒ€ì ìœ¼ë¡œ ë¹„êµí–ˆì„ ë•Œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;a~d&lt;/code&gt;ë¥¼ ì²˜ë¦¬í•˜ëŠ” íŒŒí‹°ì…˜ ì‚¬ì´ì¦ˆê°€ 1ì¸ ê²ƒì— ë¹„í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;e&lt;/code&gt;ë¥¼ ì²˜ë¦¬í•˜ëŠ” íŒŒí‹°ì…˜ ì‚¬ì´ì¦ˆëŠ” 6ì´ë¯€ë¡œ í•´ë‹¹ íŒŒí‹°ì…˜ ì²˜ë¦¬ëŠ” ë‹¤ë¥¸ íŒŒí‹°ì…˜ì— ë¹„í•´ 6ë°°ì˜ ì‹œê°„ì´ ì†Œìš”ë  ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/salting_example_2.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ìœ„ì™€ ê°™ì€ ìƒí™©ì—ì„œ ë°œìƒí•œ skewnessë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ salting keyë¥¼ ì ìš©í•´ë´…ì‹œë‹¤. ì¼ë‹¨ ëª¨ë“  íŒŒí‹°ì…˜ ì‚¬ì´ì¦ˆê°€ 1ë¡œ ë™ì¼í•˜ê¸¸ í¬ë§í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ salting keyë¥¼ ì¶”ê°€í•˜ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt; DataFrameì˜ rowë¥¼ ë³µì œí•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark.sql.functions&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;explode&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark.sql.types&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IntegerType&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;SALTING_SIZE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# logì— salting key ì¶”ê°€ / 0~9 ì‚¬ì´ì˜ ë¬´ì‘ìœ„ ì •ìˆ˜ê°’ ì¶”ê°€
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;salt_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IntegerType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# user_typeì— salting keyë¥¼ ì¶”ê°€, ëª¨ë“  rowê°€ 0~9ì˜ ê°’ì„ ê°–ê²Œë¨
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                 &lt;span class=&quot;n&quot;&gt;explode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SALTING_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]))&lt;/span&gt;
                                 &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'salting_key'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'left'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt;ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;salting_key&lt;/code&gt;ë¥¼ ê¸°ì¤€ìœ¼ë¡œ joiní•˜ë¯€ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;log&lt;/code&gt;ì˜ ê° rowëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt;ì˜ 1ê°œ rowì™€ë§Œ ë§¤ì¹­ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ê²½ìš°ì— ëŒ€í•´ì„œ íŒŒí‹°ì…˜ ì‚¬ì´ì¦ˆê°€ 1ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/salting_example_3.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;optimization&quot;&gt;Optimization&lt;/h3&gt;

&lt;p&gt;salting keyë¥¼ ì ìš©í•˜ë©´ data skewnessë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìœ„ì˜ ì˜ˆì‹œì—ì„œëŠ” ì•„ì§ ë¬¸ì œì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt;ì€ salting keyë¥¼ ì¶”ê°€í•˜ëŠ” ê³¼ì •ì—ì„œ ê·¸ ë°ì´í„° ì‚¬ì´ì¦ˆê°€ 10ë°° ì»¤ì¡ŒìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ ê¸€ì—ì„œ ì˜ˆì‹œë¡œ ì‘ì„±í•œ ê²½ìš°ëŠ” ë°ì´í„°ì…‹ì´ ë§¤ìš° ì‘ìœ¼ë¯€ë¡œ ë¬¸ì œê°€ ë˜ì§€ ì•Šì§€ë§Œ, ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ëŠ” ê²½ìš°ì—ëŠ” íŠ¹ì • ë°ì´í„°ì…‹ì„ 10ë°°ë¡œ í‚¤ìš°ëŠ” ê²ƒì€ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì•„ë‹ˆ, ëŒ€ë¶€ë¶„ ë¬¸ì œê°€ ë©ë‹ˆë‹¤).&lt;/p&gt;

&lt;p&gt;ì´ë¥¼ ìµœì í™”í•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë–»ê²Œ ì ‘ê·¼í•´ì•¼í• ê¹Œìš”?&lt;/p&gt;

&lt;h4 id=&quot;ì ‘ê·¼1-salting_sizeë¥¼-ì¡°ì •í•œë‹¤&quot;&gt;[ì ‘ê·¼1] &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SALTING_SIZE&lt;/code&gt;ë¥¼ ì¡°ì •í•œë‹¤&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SALTING_SIZE&lt;/code&gt;ë¥¼ 8ë¡œ ì¤„ì´ë©´, ë°ì´í„° ì‚¬ì´ì¦ˆë¥¼ 10ë°° ì¦ê°€í•˜ë˜ ê²ƒì„ 8ë°° ì¦ê°€ë¡œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;log&lt;/code&gt; ë°ì´í„°ì˜ ëª¨ë“  rowsì— ëŒ€í•´ì„œ joinì´ ë˜ëŠ” ê²ƒë„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;SALTING_SIZE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ê·¸ëŸ¬ë‚˜ ì—¬ì „íˆ ë°ì´í„°ê°€ 8ë°°ê°€ ë˜ëŠ” ê²ƒì€ ë¶€ë‹´ì´ ë©ë‹ˆë‹¤. ë˜í•œ ë°ì´í„°ë¥¼ ì§ì ‘ í™•ì¸í•´ë³´ì§€ ì•Šìœ¼ë©´ íŒŒë¼ë¯¸í„°(SALING_SIZE)ë¥¼ ì–´ë–¤ ê°’ìœ¼ë¡œ ì„¤ì •í•´ì•¼í•˜ëŠ”ì§€ íŒë‹¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h4 id=&quot;ì ‘ê·¼2-ë™ì ìœ¼ë¡œ-salting_sizeë¥¼-ê²°ì •í•œë‹¤&quot;&gt;[ì ‘ê·¼2] ë™ì ìœ¼ë¡œ SALTING_SIZEë¥¼ ê²°ì •í•œë‹¤&lt;/h4&gt;

&lt;p&gt;ë¡œì§ì„ ì¶”ê°€í•˜ì—¬ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt;ì„ ë³µì œí•  ì‚¬ì´ì¦ˆë¥¼ ìë™ìœ¼ë¡œ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt; ì „ì²´ë¥¼ ë³µì œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt; ë³„ë¡œ ì–¼ë§ˆë‚˜ ë³µì œí•´ì•¼í• ì§€ ë™ì ìœ¼ë¡œ ê²°ì •í•œë‹¤ë©´ ë©”ëª¨ë¦¬ë¥¼ í›¨ì”¬ ë” ì•„ë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark.sql.functions&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;explode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;udf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark.sql.types&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IntegerType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ArrayType&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;user_id_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# log
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id_cnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'left'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;count&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IntegerType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;udf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;returnType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ArrayType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IntergerType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_salting_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''
    count=3 =&amp;gt; [0, 1, 2]
    '''&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# user_type
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id_cnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'left'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                 &lt;span class=&quot;n&quot;&gt;explode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_salting_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;count&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                 &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'salting_key'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'left'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id_cnt&lt;/code&gt;ì— ë”°ë¼ ê²°ì •ëœ salting_sizeëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt;ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(e, GENERAL)&lt;/code&gt;ì— í•´ë‹¹í•˜ëŠ” rowë§Œ salting_key 0~5ë¥¼ ë¶€ì—¬í•˜ì—¬ 6ê°œë¡œ ë³µì œë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/salting_example_4.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ì—¬ê¸°ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt;ì˜ ë³µì œë¥¼ ë” ìµœì†Œí™”í•  ìˆ˜ ìˆëŠ” ë§ˆì§€ë§‰ ì ‘ê·¼ë²•ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h4 id=&quot;ì ‘ê·¼3-joinì„-11-ë§¤í•‘ì—ì„œ-1nì´-ê°€ëŠ¥í•˜ë„ë¡-ìˆ˜ì •í•œë‹¤&quot;&gt;[ì ‘ê·¼3] joinì„ 1:1 ë§¤í•‘ì—ì„œ 1:Nì´ ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •í•œë‹¤&lt;/h4&gt;
&lt;p&gt;1:N ë§¤í•‘ì´ ê°€ëŠ¥í•˜ë„ë¡ ë¡œì§ì„ ìˆ˜ì •í•˜ë©´, ì ‘ê·¼2ì˜ ê²°ê³¼ë³´ë‹¤ë„ ë³µì œë¥¼ ë” ìµœì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id=e&lt;/code&gt;ì¸ ê²½ìš°ì— ì§‘ì¤‘í•´ë´…ì‹œë‹¤. í˜„ì¬ ìƒíƒœì—ì„œ joinì„ í•˜ê²Œë˜ë©´ 1 taskê°€ 1 rowë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1row/task&lt;/code&gt;). ëŒ€ì‹  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_type&lt;/code&gt;ì—ëŠ” 6 rowsë¥¼ ë³µì œí•´ì•¼í–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ê·¸ë ‡ë‹¤ë©´, 1 taskê°€ 2 rowsì”© ì²˜ë¦¬(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2rows/task&lt;/code&gt;)í•˜ë„ë¡ í•œë‹¤ë©´ ë³µì œí•´ì•¼í•˜ëŠ” ì‚¬ì´ì¦ˆë¥¼ ì¤„ì¼ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œìš”?&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark.sql.functions&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;explode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;udf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark.sql.types&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IntegerType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ArrayType&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;math&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ceil&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;PARTITION_SIZE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 1ê°œ taskê°€ ì²˜ë¦¬í•  rows ê°œìˆ˜
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user_id_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;udf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;returnType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IntegerType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_salting_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''
    count=6 =&amp;gt; ceil(6/2)
    count=1 =&amp;gt; ceil(1/2)
    '''&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ceil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PARTITION_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;udf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;returnType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ArrayType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IntergerType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_salting_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''
    count=3 =&amp;gt; [0, 1, 2]
    '''&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# log
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id_cnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'left'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_size&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_salting_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'count'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_size&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IntegerType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# user_type
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id_cnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'left'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_size&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_salting_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'count'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withColumn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                 &lt;span class=&quot;n&quot;&gt;explode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_salting_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;salting_size&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                 &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'user_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'salting_key'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'left'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;get_salting_size&lt;/code&gt;ì— ì˜í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt;ì˜ count ìˆ˜ë¥¼ ê·¸ëŒ€ë¡œ salting_sizeë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì—°ì‚°ì„ ê±°ì¹©ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PARTITION_SIZE&lt;/code&gt;ë€ í•˜ë‚˜ì˜ taskê°€ ì²˜ë¦¬í•  row ìˆ˜ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ë”°ë¼ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id=e&lt;/code&gt;ì˜ ê²½ìš° 2 rowsì”© ì²˜ë¦¬í•˜ë©´ ë˜ë¯€ë¡œ 3 rowsë§Œ ë³µì œí–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/salting_example_5.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;sparkì—ì„œ data skewnessë¥¼ ì¤„ì´ê¸° ìœ„í•´ salting key ê¸°ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤&lt;/li&gt;
  &lt;li&gt;salting key ì‚¬ìš© ì‹œ ë°ì´í„° ë³µì œê°€ ë°œìƒí•œë‹¤&lt;/li&gt;
  &lt;li&gt;ë™ì ìœ¼ë¡œ salting sizeë¥¼ ê²°ì •í•˜ë„ë¡ ì½”ë“œë¥¼ êµ¬í˜„í•˜ì—¬ ë°ì´í„° ë³µì œë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆë‹¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;br /&gt;
&lt;a href=&quot;https://mesh.dev/20220130-dev-notes-008-salting-method-and-examples/&quot;&gt;[VROONG í…Œí¬ ë¸”ë¡œê·¸]Salting ê¸°ë²• ì˜ˆì œ ì½”ë“œ&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">Data Skewnessë¥¼ í•´ê²°í•˜ëŠ” Spark Salting Key ê¸°ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤.</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">non-deterministic UDF</title>
      <link href="https://gyuhoonk.github.io/non-deterministic-udf" rel="alternate" type="text/html" title="non-deterministic UDF" />
      <published>2023-05-16T22:30:00+09:00</published>
      <updated>2023-05-16T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/non-deterministic-udf</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/non-deterministic-udf">&lt;p&gt;non-determinitic UDF êµ¬í˜„í•˜ê¸°&lt;/p&gt;

&lt;h3 id=&quot;non-deterministic-functionì´ë€&quot;&gt;non-deterministic functionì´ë€?&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;non-deterministic&lt;/code&gt;ì´ë¼ê³  í–ˆìœ¼ë‹ˆ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;deterministic&lt;/code&gt;ê°€ ì•„ë‹Œ UDFì…ë‹ˆë‹¤. ë¨¼ì €, deterministic functionì´ë€ ë¬´ì—‡ì¸ì§€ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. &lt;br /&gt;
&lt;a href=&quot;https://learn.microsoft.com/en-us/sql/relational-databases/user-defined-functions/&quot;&gt;(Deterministic and nondeterministic functions)&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Deterministic functions always return the same result any time theyâ€™re called with a specific set of input values and given the same state of the database.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Nondeterministic functions may return different results each time theyâ€™re called with a specific set of input values even if the database state that they access remains the same.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;deterministic functionì€ ê°™ì€ ì…ë ¥(input)ì— ëŒ€í•´ì„œ í•­ìƒ ê°™ì€ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ
non-deterministicì€ deterministicì´ ì•„ë‹Œ í•¨ìˆ˜ë¡œì„œ, ê°™ì€ ì…ë ¥ì— ëŒ€í•´ì„œ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ” ëŒ€ë¶€ë¶„ì˜ í•¨ìˆ˜ëŠ” deterministic functionì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AVG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;avg_col1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;my_table&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AVG&lt;/code&gt; í•¨ìˆ˜ëŠ” my_tableì— ì €ì¥ëœ ë°ì´í„°ê°€ ë³€í•˜ì§€ ì•ŠëŠ” í•œ, ê°™ì€ ì…ë ¥(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1&lt;/code&gt;)ì— ëŒ€í•´ì„œ í•­ìƒ ê°™ì€ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë°˜ëŒ€ë¡œ ì•„ë˜ì™€ ê°™ì€í•¨ìˆ˜ë“¤ì€ non-deterministic functionì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_timestamp&lt;/code&gt;ì²˜ëŸ¼ í˜„ì¬ ì‹œê°„ì„ ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rank&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;row_number&lt;/code&gt;ì²˜ëŸ¼ ê°™ì€ ì»¬ëŸ¼ ë‚´ì—ì„œë„ ë‹¤ë¥¸ ê°’ì„ ë¶€ì—¬í•˜ëŠ” í•¨ìˆ˜&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rand&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;uuid&lt;/code&gt;ì²˜ëŸ¼ ëœë¤ ê°’ì„ ë¶€ì—¬í•˜ëŠ” í•¨ìˆ˜&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ìœ„ í•¨ìˆ˜ë“¤ì€ ëª¨ë‘ ê°™ì€ ì…ë ¥ì— ëŒ€í•´ ì—¬ëŸ¬ë²ˆ ì‹¤í–‰í–ˆì„ ë•Œ ì‹¤í–‰ ì‹œë§ˆë‹¤ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;stateful-functionì´ë€&quot;&gt;stateful functionì´ë€?&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;If a UDF stores state based on the sequence of records it has processed, it is stateful. A stateful UDF cannot be used in certain expressions such as case statement and certain optimizations such as AND/OR short circuiting donâ€™t apply for such UDFs, as they need to be invoked for each record. row_sequence is an example of stateful UDF. A stateful UDF is considered to be non-deterministic, irrespective of what deterministic() returns.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;UDFê°€ ì‹¤í–‰ë˜ëŠ” ê³¼ì •ì—ì„œ ë ˆì½”ë“œë“¤ì— ëŒ€í•œ ìˆœì„œ ìƒíƒœ(state based on the sequence)ë¥¼ ì €ì¥í•˜ê³  ìˆëŠ” ê²½ìš° ì´ë¥¼ statefulí•˜ë‹¤ê³  ë§í•©ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;row_sequence&lt;/code&gt;ê°€ ì´ì— í•´ë‹¹í•©ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;row_sequence&lt;/code&gt;ëŠ” ë ˆì½”ë“œë¥¼ ì •ë ¬í•˜ê³  í•´ë‹¹ ë ˆì½”ë“œì˜ ìˆœì„œë¥¼ ê¸°ì–µí•˜ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ì‹¤ì œë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;row_seqence&lt;/code&gt;ë¥¼ êµ¬í˜„í•œ ì½”ë“œë¥¼ ë³´ë©´ ë” ì§ê´€ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@UDFType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deterministic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stateful&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UDFRowSequence&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;UDF&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;LongWritable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;LongWritable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

  &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;UDFRowSequence&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;LongWritable&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;evaluate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;result&lt;/code&gt;ì— ì €ì¥ëœ ê°’ì„ ì°¸ê³ í•˜ì—¬ 1ì”© ì¦ê°€í•´ë‚˜ê°‘ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;non-deterministic-udf-ì •ì˜í•˜ê¸°&quot;&gt;non-deterministic UDF ì •ì˜í•˜ê¸°&lt;/h3&gt;

&lt;p&gt;ìœ„ì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;row_sequence&lt;/code&gt;ì—ì„œ ë³´ì•˜ë˜ ì˜ˆì‹œì²˜ëŸ¼ ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤. &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;deterministic = false, stateful = true&lt;/code&gt;ì€ non-deterministic &amp;amp; stateful UDFë¥¼ ì •ì˜í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@UDFType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deterministic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stateful&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UDFNonDetStatfule&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;UDF&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Text&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;evaluate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// í•¨ìˆ˜ ì •ì˜&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ë‹¨ìˆœíˆ non-deterministic UDFë¥¼ ì •ì˜í•˜ë ¤ë©´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stateful = False&lt;/code&gt;ë¡œ ì„ ì–¸í•˜ë©´ ë©ë‹ˆë‹¤(ê¸°ë³¸ê°’ì´ Falseì´ë¯€ë¡œ ì¸ìë¥¼ ì „ë‹¬í•˜ì§€ ì•Šìœ¼ë©´ ë©ë‹ˆë‹¤).&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@UDFType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deterministic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UDFNonDet&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;UDF&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Text&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;evaluate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// í•¨ìˆ˜ ì •ì˜&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;impalaì—ì„œëŠ”-non-deterministic-udfë¥¼-ì‚¬ìš©í• -ìˆ˜-ì—†ë‹¤&quot;&gt;Impalaì—ì„œëŠ” non-deterministic UDFë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤&lt;/h3&gt;

&lt;p&gt;ì´ì²˜ëŸ¼ Hiveì—ì„œëŠ” non-deterministic, stateful UDFë¥¼ ì§€ì›í•˜ì§€ë§Œ impalaì—ì„œëŠ” ì´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;All Impala UDFs must be deterministic, that is, produce the same output each time when passed the same argument values. For example, an Impala UDF must not call functions such as rand() to produce different values for each invocation. It must not retrieve data from external sources, such as from disk or over the network.
An Impala UDF must not spawn other threads or processes.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;cloudera ê³µì‹ ë¬¸ì„œì—ì„œëŠ” impala UDFì˜ êµ¬í˜„ ì‹œ ì œí•œ ì‚¬í•­ì— ëŒ€í•´ ì„¤ëª…í•˜ê³  ìˆìŠµë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rand()&lt;/code&gt;ì™€ ê°™ì€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ê° invacation(í•¨ìˆ˜ì˜ ì‹¤í–‰/í˜¸ì¶œ)ì´ ë‹¤ë¥¸ ê°’ì„ ìƒì„±í•´ì„œëŠ” ì•ˆëœë‹¤ê³  ë§í•©ë‹ˆë‹¤. ì¦‰, non-deterministic UDFëŠ” êµ¬í˜„ì´ ë¶ˆê°€ëŠ¥í•˜ë©° impalaì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  UDFëŠ” ë°˜ë“œì‹œ deterministicí•´ì•¼í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë¬¼ë¡  impalaì˜ built-in function ì¤‘ì—ëŠ” non-deterministic functionì´ ì¡´ì¬í•©ë‹ˆë‹¤(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_timestamp, row_num, rank, uuid&lt;/code&gt; ë“±). íŠ¹íˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;uuid&lt;/code&gt;ëŠ” ë¹„êµì  ë‚˜ì¤‘ì— ì¶”ê°€ëœ í•¨ìˆ˜ì¸ë° ì´ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ëŠ” &lt;a href=&quot;https://github.com/cloudera/Impala/commit/12d605d3c20f431d709a515ab5d34615cba0d9e7#diff-b6f339610307238fc9855de9fd8fde22fd65ed11204a8accb2e6fe11255d6c2f&quot;&gt;ì»¤ë°‹&lt;/a&gt;ì„ í™•ì¸í•´ë³´ë©´ javaê°€ ì•„ë‹ˆë¼ C/C++ì„ ì´ìš©í–ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UtilityFunctions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UuidPrepare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FunctionStateScope&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;THREAD_LOCAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GetFunctionState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;THREAD_LOCAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;boost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random_generator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid_gen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random_generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SetFunctionState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid_gen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;StringVal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UtilityFunctions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Uuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid_gen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GetFunctionState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;THREAD_LOCAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;DCHECK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuid_gen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;boost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuid&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;reinterpret_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random_generator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuid_gen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cxx_string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuid_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StringVal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CopyFrom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;reinterpret_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cxx_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()),&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cxx_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UtilityFunctions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UuidClose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FunctionStateScope&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;THREAD_LOCAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid_gen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GetFunctionState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FunctionContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;THREAD_LOCAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;DCHECK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuid_gen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid_gen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ì •ë¦¬&quot;&gt;ì •ë¦¬&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;non-deterministic functionì€ ê°™ì€ inputì— ëŒ€í•´ ë‹¤ë¥¸ ê°’ì„ ë°˜í™˜í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ì´ë‹¤&lt;/li&gt;
  &lt;li&gt;stateful functionì€ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ê·¸ ìƒíƒœ(state)ë¥¼ ìœ ì§€í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.&lt;/li&gt;
  &lt;li&gt;Impalaì—ì„œ non-deterministic UDFëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;br /&gt;
&lt;a href=&quot;https://learn.microsoft.com/en-us/sql/relational-databases/user-defined-functions/deterministic-and-nondeterministic-functions?view=sql-server-ver16&quot;&gt;Deterministic and nondeterministic functions&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;https://svn.apache.org/repos/infra/websites/production/hive/content/javadocs/r2.1.1/api/org/apache/hadoop/hive/ql/udf/UDFType.html&quot;&gt;UDFType&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;https://issues.cloudera.org/browse/IMPALA-1477?jql=ORDER%20BY%20%22summary%22%20ASC&quot;&gt;Add UUID function&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;https://docs.cloudera.com/runtime/7.2.10/impala-sql-reference/topics/impala-udf-limitations-and-restrictions-for-impala-udfs.html&quot;&gt;Limitations and restrictions for Impala UDFs
&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">non-determinitic UDF êµ¬í˜„í•˜ê¸°</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">WITHì ˆ/VIEW ì‚¬ìš© ì‹œ ì¿¼ë¦¬ í”Œëœì— ëŒ€í•´ì„œ</title>
      <link href="https://gyuhoonk.github.io/impala-with-clause" rel="alternate" type="text/html" title="WITHì ˆ/VIEW ì‚¬ìš© ì‹œ ì¿¼ë¦¬ í”Œëœì— ëŒ€í•´ì„œ" />
      <published>2023-02-16T22:30:00+09:00</published>
      <updated>2023-02-16T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/impala-with-clause</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/impala-with-clause">&lt;p&gt;WITHì ˆ/VIEW ì‚¬ìš©ì€ íš¨ìœ¨ì ì¸ ì¿¼ë¦¬í”Œëœê³¼ ê´€ë ¨ì´ ì—†ë‹¤&lt;/p&gt;

&lt;h3 id=&quot;withì ˆcte&quot;&gt;WITHì ˆ(CTE)&lt;/h3&gt;
&lt;p&gt;WITHì ˆì€ SELECTë¬¸ì„ ì „ì— ì‘ì„±í•˜ì—¬ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ aliasë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤. SELECTë¬¸ ë‚´ì—ì„œ ì—¬ëŸ¬ë²ˆ ë°˜ë³µí•´ì„œ ì‚¬ìš©í•´ì•¼í•˜ëŠ” êµ¬ë¬¸ì„ ë¯¸ë¦¬ WITHì ˆë¡œ ì •ì˜í•´ë†“ìŒìœ¼ë¡œì¨ ì‘ì„±ë˜ëŠ” ì¿¼ë¦¬ì˜ ë³µì¡ì„±ì„ ë‚®ì¶œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CREATE VIEW&lt;/code&gt;ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ, WITHì ˆ ë‚´ì—ì„œ ì •ì˜ëœ ì»¬ëŸ¼ëª…ê³¼ í…Œì´ë¸”ì€ ì¿¼ë¦¬ ì„¸ì…˜ì´ ì¢…ë£Œë˜ë©´ ìœ ì§€ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, WITHì ˆì€ ì¡´ì¬í•˜ëŠ” í…Œì´ë¸”/ë·°ì˜ ì´ë¦„ê³¼ ì¤‘ë³µë˜ë”ë¼ë„ ì¶©ëŒì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;WITHì ˆì„ ì‚¬ìš©í•˜ëŠ” ëª©ì ì€ 3ê°€ì§€ë¡œ ìš”ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ì‘ì„±í•˜ëŠ” ì¿¼ë¦¬ ë‚´ë¶€ì˜ ì¤‘ë³µì„ ì¤„ì„ìœ¼ë¡œì¨ ì¿¼ë¦¬ ì‘ì„±ì´ í¸ë¦¬í•´ì§‘ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ì¿¼ë¦¬ì˜ ë³µì¡í•œ ë¶€ë¶„ì„ ì¶”ì¶œí•˜ì—¬ WITHì ˆë¡œ ì •ì˜í•´ë‘ ìœ¼ë¡œì¨ ì¿¼ë¦¬ë¥¼ ì½ê³  ì´í•´í•˜ê¸° ì‰½ê²Œ í•©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;WITHì ˆì„ ì§€ì›í•¨ìœ¼ë¡œì¨ ë‹¤ë¥¸ DBì™€ì˜ í˜¸í™˜ì„±ì´ ë³´ì¥ë©ë‹ˆë‹¤. íŠ¹íˆ, Oracleê³¼ì˜ í˜¸í™˜ì„±ì´ ì§€ì›ë©ë‹ˆë‹¤.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ë‹¤ë§Œ, Impalaì˜ WITHì ˆì€ recursive queryë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h4 id=&quot;withì ˆ-ì‚¬ìš©-ì˜ˆì‹œ&quot;&gt;WITHì ˆ ì‚¬ìš© ì˜ˆì‹œ&lt;/h4&gt;
&lt;p&gt;WITHì ˆì€ ì•„ë˜ì²˜ëŸ¼ ì°¨ë¡€ëŒ€ë¡œ ì •ì˜ë˜ëŠ” ê²½ìš°ê°€ ì¼ë°˜ì ì…ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;-- Define 2 subqueries that can be referenced from the body of a longer query.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tab&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;union&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;all&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ì„œë¸Œì¿¼ë¦¬ ë‚´ë¶€ì—ì„œ WITHì ˆì„ ì •ì˜í•˜ê³  ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t2&lt;/code&gt;ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UNION ALL&lt;/code&gt;ì˜ ì•ë¶€ë¶„ì—ì„œ ì •ì˜ë˜ê³  ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;-- Define one subquery at the outer level, and another at the inner level as part of the&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- initial stage of the UNION ALL query.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- UNINON ALLì˜ ì•ë¶€ë¶„ ì‚¬ì &lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;-- UNINON ALLì˜ ì•ë¶€ë¶„ ì¢…ë£Œ&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;union&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;all&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;view1&quot;&gt;VIEW1&lt;/h4&gt;
&lt;p&gt;viewëŠ” aliasë¬¸ì²˜ëŸ¼ ë™ì‘í•˜ëŠ” ê²½ëŸ‰ ë…¼ë¦¬êµ¬ì¡°(lightweight logical constructs)ì…ë‹ˆë‹¤. SELECTë¬¸ì—ì„œ í…Œì´ë¸” ì´ë¦„ì„ íŠ¹ì •í•´ì•¼í•˜ëŠ” ë¶€ë¶„ì— view ì´ë¦„ì„ ì ìŒìœ¼ë¡œì¨ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;a view is purely a logical construct (an alias for a query) with no physical data behind it&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ì£¼ì˜í•´ì•¼í•  ì ì€ viewëŠ” ìˆœìˆ˜í•˜ê²Œ &lt;strong&gt;ë…¼ë¦¬êµ¬ì¡°&lt;/strong&gt;ì´ë¯€ë¡œ ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ë”°ë¡œ ì €ì¥í•´ë‘ì§€ ì•ŠìŠµë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ALTER VIEW&lt;/code&gt;ì™€ ê°™ì€ DDLë„ viewë¥¼ ê´€ë¦¬í•˜ëŠ” ë©”íƒ€ë°ì´í„°ë¥¼ ë³€ê²½í•  ë¿, HDFSì— ì €ì¥ëœ ë°ì´í„° íŒŒì¼ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;viewëŠ” ì•„ë˜ì™€ ê°™ì€ íŠ¹ì§•ë“¤ì„ ê°–ìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ì••ì¶•ë˜ê³  ê°„ë‹¨í•œ ë¬¸ë²•ìœ¼ë¡œ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ë³µì¡í•œ ì¿¼ë¦¬ì˜ ì¤‘ë³µ ì‚¬ìš©ì„ ì¤„ì„ìœ¼ë¡œì¨, ìœ ì§€ë³´ìˆ˜ë¥¼ ì‰½ê²Œ í•©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;view ìƒì„± ì‹œì— ìƒˆë¡œìš´ ì ˆ, SELECT-LIST, í•¨ìˆ˜ í˜¸ì¶œ ë“±ì„ ì‚¬ìš©í•˜ì—¬ ì •êµí•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ì¹¼ëŸ¼ê³¼ í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì§ê´€ì ì¸ ì´ë¦„ìœ¼ë¡œ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;viewì— ì—°ê²°ëœ í…Œì´ë¸”ì„ ë³€ê²½í•˜ëŠ” ê³¼ì •ì—ì„œ downtimeì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ì—¬ëŸ¬ ì¿¼ë¦¬ë“¤ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê°™ì€ ì„œë¸Œì¿¼ë¦¬ë¥¼ viewë¡œ ì •ì˜í•´ë‘ ìœ¼ë¡œì¨ ê¸´ ì„œë¸Œì¿¼ë¦¬ ì‘ì„±ì„ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;viewë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì€ ì œí•œì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;impala viewì—ëŠ” ë°ì´í„°ë¥¼ INSERTí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;viewë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©ëœ ì¿¼ë¦¬ì˜ WHEREì ˆê³¼ í˜„ì¬ ì‹¤í–‰í•œ ì¿¼ë¦¬ì˜ WHEREì ˆì´ partition pruningì— ì ìš©ë©ë‹ˆë‹¤. 1.4 ë²„ì „ ì´ì „ì—ëŠ” view ìƒì„± ì‹œ ì‚¬ìš©ëœ ì¿¼ë¦¬ì˜ WHWEREì ˆë§Œ partition pruningì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;view ìƒì„± ì‹œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LIMIT&lt;/code&gt;ì´ ì—†ì´ ì‚¬ìš©ëœ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ORDER BY&lt;/code&gt;ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;withì ˆview-ì‚¬ìš©ê³¼-ì¿¼ë¦¬-í”Œëœì—-ëŒ€í•´ì„œ&quot;&gt;WITHì ˆ/VIEW ì‚¬ìš©ê³¼ ì¿¼ë¦¬ í”Œëœì— ëŒ€í•´ì„œ&lt;/h3&gt;
&lt;p&gt;ì•„ë˜ì™€ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‘ì„±í–ˆì„ ë•Œ, ì–´ë–¤ query planì´ ìƒì„±ë˜ë¦¬ë¼ ê¸°ëŒ€í•˜ì‹œë‚˜ìš”?&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;WITH&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;table1&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;t1_col1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;level1&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;t1_col2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;level1&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1_col1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ALL&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1_col2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì €ëŠ” ìœ„ì™€ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ë©´ì„œ WITHì ˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t1&lt;/code&gt;ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t1_col1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t1_col2&lt;/code&gt;ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë¯€ë¡œ, ì•„ë˜ì™€ ê°™ì´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t1&lt;/code&gt;ìœ¼ë¡œë¶€í„° íŒŒìƒë˜ëŠ” WITHì ˆì„ ìƒì„±í•˜ëŠ” ì¿¼ë¦¬ í”Œëœì„ ê¸°ëŒ€í–ˆì—ˆìŠµë‹ˆë‹¤. ì¦‰ ì „ì²´ ì¿¼ë¦¬ ì‹¤í–‰ ì¤‘ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GROUP BY&lt;/code&gt;ë¡œ ë°œìƒí•˜ëŠ” ê³„ì‚°ì€ 1íšŒë§Œ ë°œìƒí•˜ë¦¬ë¼ ì˜ˆìƒí–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/built/images/hadoop/with-query-plan-1.png&quot; alt=&quot;image1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ê·¸ëŸ¬ë‚˜ impalaì—ì„œ ìœ„ì™€ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ í™•ì¸ë˜ëŠ” ì¿¼ë¦¬ í”Œëœì€ ì‹¤ì œë¡œëŠ” ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/built/images/hadoop/with-query-plan-2.png&quot; alt=&quot;image2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ì‹¤í–‰ ì¤‘ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;table1&lt;/code&gt;ì€ 2ë²ˆ ìŠ¤ìº”í•˜ê³ , &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t1&lt;/code&gt;ì„ ìƒì„±í•˜ëŠ” WITHì ˆë„ 2ë²ˆ ì‹¤í–‰ë©ë‹ˆë‹¤. ì¦‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GROUP BY&lt;/code&gt; ì—°ì‚°ì´ 2íšŒ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì˜ˆìƒí–ˆë˜ ê²ƒë³´ë‹¤ 2ë°°ì˜ ìŠ¤ìº”ëŸ‰ê³¼ 2ë°°ì˜ ì—°ì‚°ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ì‚¬ëŒì€ í•˜ë‚˜ì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t1&lt;/code&gt;ìœ¼ë¡œë¶€í„° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t1_col1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;t1_col2&lt;/code&gt;ë¥¼ ìƒì„±í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ë¥¼ ë‹´ì•„ ì¿¼ë¦¬ë¥¼ ì‘ì„±í–ˆì„ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ ì € ë˜í•œ ê·¸ëŸ¬í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì‹¤ì œë¡œ ì‹¤í–‰ë  ë•Œì—ëŠ” ì¿¼ë¦¬ ì‘ì„±ìì˜ ì˜ë„ì™€ëŠ” ë‹¤ë¥´ê²Œ 2ë²ˆì˜ ìŠ¤ìº”ê³¼ 2ë²ˆì˜ ì—°ì‚°ì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. ì´ëŸ° ì°¨ì´ì ì´ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?&lt;/p&gt;

&lt;p&gt;ê·¸ê²ƒì€ ê¸°ë³¸ì ìœ¼ë¡œ WITHì ˆì´ VIEWì™€ ê°™ì´ &lt;strong&gt;ìˆœìˆ˜í•œ ë…¼ë¦¬êµ¬ì¡°(purely a logical construct)&lt;/strong&gt;ì— ë¶ˆê³¼í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì•ì„œ ì„¤ëª…ë“œë¦° ê²ƒì²˜ëŸ¼ VIEWëŠ” ì‹¤ì œë¡œ HDFSì— ì–´ë–¤ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ë³€ê²½ì‹œí‚¤ì§€ ëª»í•©ë‹ˆë‹¤. ë‹¨ì§€ í•´ë‹¹ VIEWë¥¼ ì¡°íšŒí•  ë•Œ, VIEW ìƒì„± ì‹œ ì‚¬ìš©ëœ ë¡œì§(SELECTë¬¸)ì„ ì‹¤í–‰ì‹œì¼œì£¼ëŠ” ë…¼ë¦¬êµ¬ì¡°ì— ë¶ˆê³¼í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;WITHì ˆë„ VIEWì™€ ë§ˆì°¬ê°€ì§€ë¡œ HDFS ì–´ë”˜ê°€ì— ê·¸ ìƒì„± ê²°ê³¼ë¥¼ ì €ì¥í•´ë‘ê±°ë‚˜ ì‹¤ì œ ë°ì´í„°ë¥¼ ë³€ê²½ì‹œí‚¤ëŠ” ì‘ì—…ì„ í•˜ì§€ ëª»í•©ë‹ˆë‹¤. ë‹¨ì§€ í•´ë‹¹ ì¿¼ë¦¬ ì„¸ì…˜ ë‚´ì—ì„œ ì¼ì¹˜í•˜ëŠ” ë¶€ë¶„ì„ WITHì ˆë¡œ ë³€ê²½ì‹œì¼œì£¼ëŠ” ê²ƒì— ë¶ˆê³¼í•©ë‹ˆë‹¤.&lt;br /&gt;
ì¦‰ ì œê°€ ì˜ˆì‹œë¡œ ë“¤ì—ˆë˜ ì¿¼ë¦¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë˜ì˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•˜ë©°, ì¿¼ë¦¬ í”Œëœ ì—­ì‹œ ì•„ë˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•  ë¿ì…ë‹ˆë‹¤.&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;level1&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;table1&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ALL&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;level1&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col3&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;table1&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ê°™ì€ ì˜ˆì‹œë¥¼ WITHì ˆ ëŒ€ì‹  VIEWë¥¼ ì‚¬ìš©í•˜ì—¬ë„ ê°™ì€ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë”°ë¼ì„œ ì¿¼ë¦¬ ì‘ì„± ì‹œ WITHì ˆ/VIEWë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ íš¨ìœ¨ì ì¸ ì¿¼ë¦¬ í”Œëœì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•´ì„  ì•ˆë©ë‹ˆë‹¤. WITHì ˆê³¼ VIEWì˜ ì‚¬ìš©ì€ ë‹¨ìˆœíˆ 1) ì¿¼ë¦¬ ë‚´ ì¤‘ë³µ ì‚¬ìš©ì„ ì¤„ì´ê³ , 2) ì¿¼ë¦¬ë¥¼ ì½ê³  ì´í•´í•˜ê¸° ì‰½ê²Œ ë§Œë“œëŠ” ê²ƒì„ì„ ê¸°ì–µí•´ì•¼í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;br /&gt;
&lt;a href=&quot;https://impala.apache.org/docs/build/plain-html/topics/impala_with.html&quot;&gt;WITH Clause&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;https://impala.apache.org/docs/build/html/topics/impala_views.html&quot;&gt;Overview of Impala Views&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;https://impala.apache.org/docs/build/html/topics/impala_create_view.html#create_view&quot;&gt;CREATE VIEW Statement&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">WITHì ˆ/VIEW ì‚¬ìš©ì€ íš¨ìœ¨ì ì¸ ì¿¼ë¦¬í”Œëœê³¼ ê´€ë ¨ì´ ì—†ë‹¤</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">enableHiveSupport</title>
      <link href="https://gyuhoonk.github.io/enableHiveSupport" rel="alternate" type="text/html" title="enableHiveSupport" />
      <published>2022-06-16T22:30:00+09:00</published>
      <updated>2022-06-16T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/enableHiveSupport</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/enableHiveSupport">&lt;p&gt;Spark enableHiveSupport(Hive metaStore)&lt;/p&gt;

&lt;h1 id=&quot;hive-table-in-spark&quot;&gt;Hive Table in Spark&lt;/h1&gt;

&lt;p&gt;sparkì—ì„œ Hive tableì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ â€˜enableHiveSupport()â€™ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ”ë°ìš”.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SparkSession&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enableHiveSupport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getOrCreate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;
SELECT *
FROM default.test1
&quot;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;enableHiveSupport()&lt;/code&gt;ì˜ ì˜ë¯¸ê°€ ë¬´ì—‡ì¸ì§€ ìƒê°í•´ë³´ì§€ ì•Šì•˜ë˜ ê²ƒ ê°™ì•„ì„œ í•œë²ˆ ì¡°ì‚¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ì— ëŒ€í•´ ì•Œê¸° ìœ„í•´ì„œëŠ” Hive Table Locationì— ëŒ€í•´ì„œ ë¨¼ì € ì•Œì•„ì•¼í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;hive---table-location&quot;&gt;Hive - Table Location&lt;/h2&gt;

&lt;p&gt;ì˜ˆë¥¼ ë“¤ì–´ defualt.test_1 ì´ë¼ëŠ” í…Œì´ë¸”ì´ ìˆë‹¤ê³  ê°€ì •í•˜ë©´, í•´ë‹¹ í…Œì´ë¸”ì€ HDFS ìƒì—ì„œ â€˜/usre/hive/warehouse/default.db/test_1â€™ ê²½ë¡œì— ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TABLE LOACTION&lt;/code&gt;ì´ë¼ê³  í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë‚˜ì•„ê°€, PARTITIONED TABLEì˜ ê²½ìš°ì—ëŠ” í•´ë‹¹ LOCATION í•˜ìœ„ì— PARTITION DIRì´ ë” ì¡´ì¬í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;êµ¬ë¶„&lt;/th&gt;
      &lt;th&gt;TABLE&lt;/th&gt;
      &lt;th&gt;HDFS LOCATION&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Table&lt;/td&gt;
      &lt;td&gt;default.table1&lt;/td&gt;
      &lt;td&gt;/user/hive/warehouse/default.db/table1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Partitioned Table&lt;/td&gt;
      &lt;td&gt;default.table2 PARTITION (col1=a)&lt;/td&gt;
      &lt;td&gt;/user/hive/warehouse/default.db/table2/col1=a&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ìš°ë¦¬ê°€ Hiveì— ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ì—¬ í…Œì´ë¸”ì„ ì¡°íšŒí•˜ëŠ” ê²ƒì€ ì‚¬ì‹¤ HDFSì—ì„œ LOCATIONì— ì¡´ì¬í•˜ëŠ” íŒŒì¼ì„ ì½ëŠ” ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë”°ë¼ì„œ, ìš°ë¦¬ê°€ ì•„ë˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;HiveëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;default.table1&lt;/code&gt;ì— í•´ë‹¹í•˜ëŠ” LOCATIONì— ì €ì¥ëœ íŒŒì¼ë¡œë¶€í„° ë°ì´í„°ë¥¼ ì½ì–´ ê²°ê³¼ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤. ì¦‰, ì•„ë˜ ì»¤ë§¨ë“œë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ” íŒŒì¼ë“¤ì„ ìŠ¤ìº”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hdfs dfs &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; /user/hive/warehouse/default.db/table1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;hive-metastore&quot;&gt;Hive metaStore&lt;/h2&gt;

&lt;p&gt;ê·¸ë ‡ë‹¤ë©´ TABLEì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LOCATION&lt;/code&gt;ê³¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PARTITION&lt;/code&gt; ì •ë³´ ì¦‰, &lt;strong&gt;hive metastore&lt;/strong&gt;ëŠ” ì–´ë””ì— ì €ì¥í•˜ê³  ìˆì„ê¹Œìš”? &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hive-stie.xml&lt;/code&gt;ì—ì„œ hive metastoreì˜ ì €ì¥ ìœ„ì¹˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;hive metastoreëŠ” 1) ì„ë² ë””ë“œ, 2) ë¡œì»¬, 3) ì›ê²© ì…‹ ì¤‘ì— í•˜ë‚˜ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì•„ë˜ëŠ” hive metastoreë¥¼ 3) ì›ê²©ìœ¼ë¡œ ì €ì¥í–ˆì„ ê²½ìš° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hive-site.xml&lt;/code&gt; ì˜ˆì‹œì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/hive/hive-site.xml
...
&amp;lt;property&amp;gt;
      &amp;lt;name&amp;gt;hive.metastore.uris&amp;lt;/name&amp;gt;
      &amp;lt;value&amp;gt;thrift://host.example:9083&amp;lt;/value&amp;gt;
 &amp;lt;/property&amp;gt; 
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;host.example:9083&lt;/code&gt;ì— hive metastoreê°€ ì €ì¥ë˜ì–´ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, í•´ë‹¹ ê²½ë¡œì— hive tableë“¤ì˜ location, partition ê°™ì€ ë©”íƒ€ ë°ì´í„°ë“¤ì´ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;enablehivesupport&quot;&gt;enableHiveSupport&lt;/h2&gt;

&lt;p&gt;sparkì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;enableHiveSupport()&lt;/code&gt;ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hive.metastore.uris&lt;/code&gt; ì„¤ì • ê°’ì— ì ‘ê·¼í•˜ì—¬ hive metastoreë¥¼ ì‚¬ìš©í•˜ê² ë‹¤ ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;defaultë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hive-site.xml&lt;/code&gt;ì—ì„œ ì •ì˜ëœ ê°’ì„ ì‚¬ìš©í•˜ê³ , ì •ì˜ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql.warehouse.dir&lt;/code&gt; ë¡œ ì „ë‹¬ëœ ê²½ë¡œì—ì„œ metastoreë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;When working with Hive, one must instantiate SparkSession with Hive support, including connectivity to a persistent Hive metastore, support for Hive serdes, and Hive user-defined functions. Users who do not have an existing Hive deployment can still enable Hive support. When not configured by the hive-site.xml, the context automatically creates metastore_db in the current directory and creates a directory configured by &lt;strong&gt;spark.sql.warehouse.dir&lt;/strong&gt;, which defaults to the directory spark-warehouse in the current directory that the Spark application is started. Note that the hive.metastore.warehouse.dir property in hive-site.xml is deprecated since Spark 2.0.0. Instead, use spark.sql.warehouse.dir to specify the default location of database in warehouse. You may need to grant write privilege to the user who starts the Spark application.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ìœ„ì˜ ì •ë³´ë¥¼ ì¢…í•©í•´ë³´ë©´ sparkê°€ hive tableì„ ì½ì–´ì˜¤ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;enableHiveSupport()&lt;/code&gt;ë¥¼ ì„ ì–¸í•œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sparkSession&lt;/code&gt;ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql&lt;/code&gt;ì„ ì´ìš©í•˜ì—¬ í…Œì´ë¸”(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;default.test1&lt;/code&gt;)ì„ ì¡°íšŒí•©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;sparkëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hive-site.xml&lt;/code&gt;Â  í˜¹ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql.warehouse.dir&lt;/code&gt; ì—ì„œ hive metastoreê°€ ì €ì¥ëœ ê²½ë¡œë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;hive metastoreë¡œë¶€í„° í•´ë‹¹ í…Œì´ë¸”ì˜ ê²½ë¡œ(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/user/hive/warehouse/default.db/test1&lt;/code&gt;)ë¥¼ ì•Œì•„ëƒ…ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ì´í›„ í•´ë‹¹ í…Œì´ë¸” ìœ„ì¹˜(location)ì—ì„œ íŒŒì¼(ë°ì´í„°)ë¥¼ ì½ì–´ì˜µë‹ˆë‹¤.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ë”°ë¼ì„œ ì•„ë˜ ë‘ ë°©ë²•ì€ ê¸°ë³¸ì ìœ¼ë¡œ ê°™ì€ ë™ì‘ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# query
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;
SELECT *
FROM default.test1
&quot;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# file scan
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parquet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/user/hive/warehouse/default.db/test1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Partitioned Tableë„ ìœ„ì™€ í¬ê²Œ ë‹¤ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¨ì§€ table locationì— partition columnì´ ì¶”ê°€ë  ë¿ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# query
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;
SELECT *
FROM default.test1
WHERE col1 = 'a'
&quot;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# file scan
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parquet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/user/hive/warehouse/default.db/test1/col1=a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wikidocs.net/28353&quot;&gt;5-ë©”íƒ€ìŠ¤í† ì–´&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://spark.apache.org/docs/latest/sql-data-sources-hive-tables.html&quot;&gt;sql-data-sources-hive-tables&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">Spark enableHiveSupport(Hive metaStore)</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Parquet and Predicate PushDown</title>
      <link href="https://gyuhoonk.github.io/parquet-ppd" rel="alternate" type="text/html" title="Parquet and Predicate PushDown" />
      <published>2022-04-21T22:30:00+09:00</published>
      <updated>2022-04-21T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/parquet-ppd</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/parquet-ppd">&lt;p&gt;parquet í¬ë§·ê³¼ predicate pushdownì— ëŒ€í•´ì„œ&lt;/p&gt;

&lt;h1 id=&quot;apache-parquet&quot;&gt;Apache Parquet&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;https://parquet.apache.org/&quot;&gt;Apache Parquet&lt;/a&gt;ì€ ì¤‘ì²© ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆëŠ” ì»¬ëŸ¼ ê¸°ì¤€ ì €ì¥ í¬ë§·ì…ë‹ˆë‹¤. ì»¬ëŸ¼ ê¸°ì¤€ ì €ì¥ í¬ë§·ì€ íŒŒì¼ í¬ê¸°ì™€ ì¿¼ë¦¬ ì„±ëŠ¥ ì¸¡ë©´ì—ì„œ ëª¨ë‘ íš¨ìœ¨ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ë™ì¼í•œ ì»¬ëŸ¼ì˜ ê°’ì„ ë‚˜ë€íˆ ëª¨ì•„ì„œ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ì¸ì½”ë”© íš¨ìœ¨ì´ ë†’ê¸° ë•Œë¬¸ì— row ê¸°ë°˜ í¬ë§·(ex. csv)ì— ë¹„í•´ íŒŒì¼ í¬ê¸°ê°€ ì‘ìŠµë‹ˆë‹¤. ë˜í•œ ì¿¼ë¦¬ ì‹¤í–‰ì— í•„ìš”í•˜ì§€ ì•Šì€ ì»¬ëŸ¼ì€ ì²˜ë¦¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ ì„±ëŠ¥ì´ ë†’ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;datatype&quot;&gt;DataType&lt;/h2&gt;

&lt;p&gt;parquet í¬ë§·ì˜ ê°€ì¥ í° ì¥ì ì€ ì¤‘ì²© êµ¬ì¡°ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” Dremelì˜ &lt;a href=&quot;https://storage.googleapis.com/pub-tools-public-publication-data/pdf/36632.pdf&quot;&gt;ë…¼ë¬¸&lt;/a&gt;ì—ì„œ ì†Œê°œí•œ ê¸°ìˆ ì„ ì ìš©í•œ ê²°ê³¼ì…ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ parquetì€ ì¤‘ì²©ëœ í•„ë“œë¥¼ ë‹¤ë¥¸ í•„ë“œì™€ ìƒê´€ì—†ì´ ë…ë¦½ì ìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆìœ¼ë©° ì´ë¥¼ í†µí•´ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;parquetì€ ë‹¤ìŒì™€ ê°™ì€ ê¸°ë³¸ìë£Œí˜•ì„ ê°–ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;type&lt;/th&gt;
      &lt;th&gt;description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;boolea&lt;/td&gt;
      &lt;td&gt;ë°”ì´ë„ˆë¦¬ ê°’&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;int32&lt;/td&gt;
      &lt;td&gt;ë¶€í˜¸ ìˆëŠ” 32ë¹„íŠ¸ ì •ìˆ˜&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;int64&lt;/td&gt;
      &lt;td&gt;ë¶€í˜¸ ìˆëŠ” 64ë¹„íŠ¸ ì •ìˆ˜&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;int96&lt;/td&gt;
      &lt;td&gt;ë¶€í˜¸ ìˆëŠ” 96ë¹„íŠ¸ ì •ìˆ˜&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;float&lt;/td&gt;
      &lt;td&gt;single precision(32ë¹„íŠ¸) IEEE 754 ë¶€ë™ì†Œìˆ˜ì  ìˆ«ì&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;double&lt;/td&gt;
      &lt;td&gt;double precision(64ë¹„íŠ¸) IEEE 754 ë¶€ë™ì†Œìˆ˜ì  ìˆ«ì&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;binary&lt;/td&gt;
      &lt;td&gt;ìˆœì°¨ 8ë¹„íŠ¸ ë¶€í˜¸ ì—†ëŠ” ë°”ì´íŠ¸&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;fixed_len_byte_array&lt;/td&gt;
      &lt;td&gt;ê³ ì •ê¸¸ì´ 8ë¹„íŠ¸ ë¶€í˜¸ ì—†ëŠ” ë°”ì´íŠ¸&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ê° í•„ë“œëŠ” ë°˜ë³µì(required, optional, repeated), type, nameìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ê°„ë‹¨í•œ parquet schema ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;message WeatherRecord{
	required int32 year;
	required int32 temperature;
	required binary stationID(UTF8);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;íŠ¹ì´í•˜ê²Œ, ë¬¸ìì—´ ìë£Œí˜•ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìœ„ì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stationID&lt;/code&gt; ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;binary&lt;/code&gt;ì— ëŒ€í•œ í•´ì„ ë°©ë²•ìœ¼ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UTF8&lt;/code&gt; ì„ ì‚¬ìš©í•  ê²ƒì„ ì§€ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ì²˜ëŸ¼ parquetì€ ê¸°ë³¸ìë£Œí˜•ì— ëŒ€í•´ í•´ì„ ë°©ì‹ì„ ì •ì˜í•˜ëŠ” ë…¼ë¦¬ ìë£Œí˜•ì„ ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë…¼ë¦¬ ìë£Œí˜• ì¤‘ì— íŠ¹íˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LIST&lt;/code&gt;ì™€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MAP&lt;/code&gt; ì€ ì¤‘ì²© ìŠ¤í‚¤ë§ˆë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;message m{
	required group a (LIST){
		repeated group list {
			required int32 element;
		}
	}
}

message m{
	required group a (MAP) {
		repeated group key_value {
			required binary key (UTF8);
			optional int32 value;
		}
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì´ëŸ¬í•œ ì¤‘ì²© êµ¬ì¡°ë¥¼ ì €ì¥í•  ë•Œ Dremelì´ ì œì•ˆí•œ ì¸ì½”ë”© ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ìŠ¤í‚¤ë§ˆì˜ ëª¨ë“  ê¸°ë³¸ìë£Œí˜• í•„ë“œì˜ ê°’ì„ ë³„ë„ì˜ ì»¬ëŸ¼ì— ì €ì¥í•˜ê³  ê·¸ êµ¬ì¡°ëŠ” ëª…ì„¸ ìˆ˜ì¤€ê³¼ ë°˜ë³µ ìˆ˜ì¤€ì˜ ë‘ ì •ìˆ˜ë¡œ ì¸ì½”ë”©í•©ë‹ˆë‹¤. ë‹¨ì¸µ ë ˆì½”ë“œëŠ” nullì„ ì‚¬ìš©í•˜ê³  ì¤‘ì²©ì´ë‚˜ ë°˜ë³µ ìˆ˜ì¤€ì´ ì˜¬ë¼ê°€ë©´ nullì´ ì•„ë‹Œ ê°’ì„ ì‚¬ìš©í•´ì„œ ë¹„íŠ¸ í•„ë“œë¥¼ ì¸ì½”ë”©í•˜ëŠ” ì¼ë°˜ì ì¸ ê¸°ë²•ìœ¼ë¡œ ëª…ì„¸ ìˆ˜ì¤€ê³¼ ë°˜ë³µ ìˆ˜ì¤€ì„ ì –ì•„í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ë²•ìœ¼ë¡œ ì¤‘ì²© ì»¬ëŸ¼ì„ í¬í•¨í•œ ì–´ë–¤ ì»¬ëŸ¼ë„ ë‹¤ë¥¸ ì»¬ëŸ¼ê³¼ ìƒê´€ì—†ì´ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ parquetì€ ë§µì˜ ì–´ë–¤ valueë„ ì½ì§€ ì•Šê³  keyë§Œ ì½ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;structure&quot;&gt;Structure&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/parquet-structure.gif&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;parquetì€ í¬ê²Œ header, block, footerë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;header&quot;&gt;header&lt;/h3&gt;

&lt;p&gt;headerëŠ” parquet íŒŒì¼ í¬ë§·ì„ì„ ì•Œë ¤ì£¼ëŠ” 4 byte ê¸¸ì´ì˜ Magic Numberì¸ PAR1ë§Œì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;block&quot;&gt;block&lt;/h3&gt;

&lt;p&gt;ê° ë¸”ë¡ì€ Row groupì„ ì €ì¥í•©ë‹ˆë‹¤. Row groupì€ column chunkë¡œ êµ¬ì„±ë˜ì–´ ìˆê³  ê° column chunkëŠ” pageì— ë°ì´í„°ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;parquetì€ ì €ì¥ ì‹œì— Row Group ë‚´ì—ì„œ ê° columnì˜ min, max, null countë¥¼ ê³„ì‚°í•˜ì—¬ ì €ì¥í•´ë‘¡ë‹ˆë‹¤. ì´ëŠ” Row group skipì— ì‚¬ìš©ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ê° pageëŠ” í•˜ë‚˜ì˜ columnì— ëŒ€í•œ ê°’ë§Œ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ page ë‚´ì— ê¸°ë¡ë˜ëŠ” ê°’ì€ ë¹„ìŠ·í•œ ê°’ì„ ê°–ëŠ” ê²½í–¥ì´ ìˆìœ¼ë¯€ë¡œ ì••ì¶•ì— ìœ ë¦¬í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì••ì¶•ì€ ë‘ ê°€ì§€ ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤. ë¨¼ì € ê°’ì„ ì¸ì½”ë”©í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤. ê°’ì˜ ì°¨ì´ë¥¼ ì €ì¥í•˜ëŠ” delta encoding, ê°’ì˜ ì—°ì†ë˜ëŠ” ë°˜ë³µíšŸìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” run-length encoding, dictionaryë¥¼ ë§Œë“¤ì–´ indexë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì •ìˆ˜ë¡œ í•´ë‹¹ ê°’ì„ ì €ì¥í•˜ëŠ” dictionary encodingì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ì™¸ì—ë„ ì‘ì€ ëª‡ ê°œì˜ ê°’ì„ í•œ ë°”ì´íŠ¸ì— ì €ì¥í•˜ì—¬ ê³µê°„ì„ ì ˆì•½í•˜ëŠ” bit packingê³¼ ê°™ì€ ë°©ë²•ì´ ì ìš©ë˜ê¸°ë„ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì¸ì½”ë”© ì„ ì •ì€ columnì˜ ìë£Œí˜•ì„ ê¸°ì¤€ìœ¼ë¡œ ìë™ìœ¼ë¡œ ì„ íƒë©ë‹ˆë‹¤. Booleanì€ RLE, Bit Packingì´ ì£¼ë¡œ ì‚¬ìš©ë˜ê³  ì´ì™¸ì— ëŒ€ë¶€ë¶„ì˜ ìë£Œí˜•ì€ dictionaryê°€ ì‚¬ìš©ë©ë‹ˆë‹¤. ë‹¨, ì¸ì½”ë”©í•  ë•Œ dictionaryì˜ ì‚¬ì´ì¦ˆê°€ ë„ˆë¬´ ì»¤ì§€ë©´ ì¼ë°˜ ì¸ì½”ë”©ìœ¼ë¡œ ëŒ€ì²´ë˜ì–´ ì••ì¶• íš¨ìœ¨ì„ í™•ë³´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. dictionary sizeëŠ” page sizeê¹Œì§€ í—ˆìš©ë  ìˆ˜ ìˆìœ¼ë©° ì´ë¥¼ ë„˜ì–´ì„¤ ê²½ìš° ì¼ë°˜ ì¸ì½”ë”©ìœ¼ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë‹¤ìŒìœ¼ë¡œ, page byteì— í‘œì¤€ ì••ì¶• ì•Œê³ ë¦¬ì¦˜ì„ ì¶”ê°€ë¡œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. snappy, gzip, LZOì™€ ê°™ì€ ì••ì¶• ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;parquet ì„¤ì •ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•­ëª©ë“¤ì´ ê³ ë ¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;option&lt;/th&gt;
      &lt;th&gt;type&lt;/th&gt;
      &lt;th&gt;default&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;parquet.block.size&lt;/td&gt;
      &lt;td&gt;int&lt;/td&gt;
      &lt;td&gt;134217728(128MB)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;parquet.page.size&lt;/td&gt;
      &lt;td&gt;int&lt;/td&gt;
      &lt;td&gt;1048576(1MB)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;parquet.dictionary.page.size&lt;/td&gt;
      &lt;td&gt;int&lt;/td&gt;
      &lt;td&gt;1048576(1MB)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;parquet.enable.dictionary&lt;/td&gt;
      &lt;td&gt;boolean&lt;/td&gt;
      &lt;td&gt;true&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;parquet.compression&lt;/td&gt;
      &lt;td&gt;string&lt;/td&gt;
      &lt;td&gt;UNCOMPRESSED&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;block sizeê°€ ì»¤ì§€ë©´, Row groupì´ ë” ë§ì€ row(record)ë¥¼ ì €ì¥í•˜ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ìŠ¤ìº” íš¨ìœ¨ì„±ì´ ë†’ì•„ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë©”ëª¨ë¦¬ì— ì €ì¥í•´ì•¼í•˜ëŠ” ì‚¬ì´ì¦ˆê°€ ì»¤ì§€ë¯€ë¡œ(block ë‹¨ìœ„ë¡œ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ë¯€ë¡œ) block sizeë¥¼ ê³„ì†í•´ì„œ ì˜¬ë¦´ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. ì°¸ê³ ë¡œ parquet blockì€ HDFS block/DataNode 1ê°œì—ì„œ ì½ì„ ìˆ˜ ìˆì–´ì•¼ë¯€ë¡œ Parquet block sizeê°€ HDFS block(128MB)ë³´ë‹¤ ì»¤ì§€ëŠ” ê²½ìš°ì—ëŠ” parquet ìì²´ë¥¼ ì½ì„ ìˆ˜ ì—†ì„ ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;page sizeëŠ” ë‹¨ì¼ row ê²€ìƒ‰ íš¨ìœ¨ê³¼ ê´€ë ¨ìˆìŠµë‹ˆë‹¤. pageëŠ” parquetì˜ ìµœì†Œ ì €ì¥ ë‹¨ìœ„ì´ê³ , ì›í•˜ëŠ” row(record) í•˜ë‚˜ë¥¼ ì°¾ê³ ì í•œë‹¤ë©´ pageì˜ ì••ì¶•ì„ í’€ê³  ë””ì½”ë”©í•´ì•¼í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¨ì¼ rowë¥¼ ì°¾ê³ ìí•œë‹¤ë©´ page.sizeê°€ ì‘ì„ìˆ˜ë¡ íš¨ìœ¨ì ì…ë‹ˆë‹¤. ì••ì¶• í•´ì œì™€ ë””ì½”ë”© ê³¼ì •ì´ ì¤„ì–´ë“¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜, page sizeê°€ ì¤„ì–´ë“¤ê²Œ ë˜ë©´ page ê°œìˆ˜ê°€ ëŠ˜ì–´ë‚˜ê²Œ ë˜ê³  ì´ëŠ” ë©”íƒ€ë°ì´í„°(offset, dictionary)ì˜ ì¦ê°€ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;footer&quot;&gt;footer&lt;/h3&gt;

&lt;p&gt;version, schema, extra key-value pair, block(row group ë° column)ì— ëŒ€í•œ ë©”íƒ€ë°ì´í„°(FileMetaData)ê°€ footerì— ì €ì¥ë©ë‹ˆë‹¤. footerì˜ ë§ˆì§€ë§‰ ë‘ í•„ë“œëŠ” FileMetaDataì˜ ê¸¸ì´ë¥¼ ì¸ì½”ë”©í•œ Footer lengthì™€ PAR1ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;predicate-pushdown&quot;&gt;Predicate PushDown&lt;/h1&gt;

&lt;p&gt;Spark, Hiveì—ì„œëŠ” Parquet íŒŒì¼ì„ ì½ì–´ë“¤ì¼ ë•Œ, Predicate PushDownì„ ì ìš©í•©ë‹ˆë‹¤. Predicate PushDownì˜ ëª©ì ì€ í•„ìš”í•œ rowë§Œ ë¹ ë¥´ê²Œ ì½ì–´ë“¤ì´ëŠ” ê²ƒì…ë‹ˆë‹¤. ì•ì„œ parquetì€ íŒŒì¼ ì €ì¥ ì‹œ Row group ë‹¨ìœ„ë¡œ min, max, null countë¥¼ ì €ì¥í•œë‹¤ê³  ë§ì”€ë“œë ¸ìŠµë‹ˆë‹¤. ppdëŠ” row groupì— ì €ì¥ëœ min/max ì €ì¥ê°’ì„ ë°”íƒ•ìœ¼ë¡œ í•„ìš”í•œ row groupë§Œì„ ìŠ¤ìº”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì˜ˆë¥¼ ë“¤ì–´, parquet íŒŒì¼ì˜ ë©”íƒ€ ë°ì´í„°ê°€ ì•„ë˜ì™€ ê°™ë‹¤ê³  ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;parquet-tools meta sample.parquet
...
row group 1 : RC:100
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------&lt;/span&gt;
A: INT32 ... &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;min: 1, max : 5, num_nulls: 0]
B: ...
row group 2 : RC:150
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------&lt;/span&gt;
A: INT32 ... &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;min: 3, max : 6, num_nulls: 0]
B: ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ìœ„ ë©”íƒ€ ë°ì´í„°ë¥¼ í•´ì„í•˜ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;row group 1ì—ëŠ” 100ê°œ rowì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ìˆìœ¼ë©°, í•´ë‹¹ rowë“¤ì˜ ì»¬ëŸ¼ Aì— ëŒ€í•œ ìµœì†Œê°’ì€ 1, ìµœëŒ€ê°’ì€ 5ì´ë‹¤.&lt;/p&gt;

  &lt;p&gt;row group 2ì—ëŠ” 150ê°œ rowê°€ ì¡´ì¬í•˜ê³ , ì»¬ëŸ¼ Aì— ëŒ€í•´ì„œ ìµœì†Œê°’ì€ 3, ìµœëŒ€ê°’ì€ 6ì´ë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;í•´ë‹¹ parquet íŒŒì¼ì— ëŒ€í•´ì„œ ì•„ë˜ì™€ ê°™ì€ spark ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤ë©´ ì–´ë–¤ ì¼ì´ ë°œìƒí• ê¹Œìš”?&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parquet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sample.parquet&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì»¬ëŸ¼ Aê°€ 5ë³´ë‹¤ í° rowë¥¼ ì°¾ëŠ”ë‹¤ë©´, row group 1ì—ì„œëŠ” ì°¾ì„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ìµœëŒ€ê°’ì´ 5ì´ë¯€ë¡œ row group 1 ë‚´ë¶€ì—ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;A&amp;gt;5&lt;/code&gt; ë¥¼ ë§Œì¡±í•˜ëŠ” rowê°€ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ì²˜ëŸ¼ row group ë‹¨ìœ„ë¡œ ê³„ì‚°ëœ í†µê³„ê°’ì„ ë°”íƒ•ìœ¼ë¡œ í™•ì¸í•  í•„ìš”ê°€ ì—†ëŠ” row groupì€ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ì§€ ì•Šê³  ë„˜ì–´ê°€ëŠ” ê²ƒ(skip)ì´ parquetì—ì„œ ë°œìƒí•˜ëŠ” predicate pushdownì´ë©° row group skipì´ë¼ê³ ë„ ë¶ˆë¦½ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;Sparkì˜ ì‹¤í–‰ ê³„íš ì¤‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Physical Plan&lt;/code&gt;ì—ì„œ ì´ëŸ¬í•œ predicate pushdown(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PushedFilters&lt;/code&gt;)ì„ í™•ì¸í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;== Parsed Logical Plan ==
...
== Analyzed Logical Plan ==
...
== Optimized Logical Plan ==
...
== Physical Plan ==
...
...PushedFilters: [IsNotNull(A), GreaterThan(A, 5)]
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì´ëŸ¬í•œ ì˜µì…˜ì€ ëŒ€ì²´ë¡œ ê¸°ë³¸ê°’ì´ trueë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©° ì•„ë˜ì™€ ê°™ì€ ì˜µì…˜ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;engine&lt;/th&gt;
      &lt;th&gt;option&lt;/th&gt;
      &lt;th&gt;description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;hive&lt;/td&gt;
      &lt;td&gt;hive.optimize.ppd&lt;/td&gt;
      &lt;td&gt;setting controls whether predicate pushdown optimizations are enabled at all&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;hive&lt;/td&gt;
      &lt;td&gt;hive.optimize.ppd.storage&lt;/td&gt;
      &lt;td&gt;setting controls whether predicates are pushed to the storage layer (the parquet-mr library)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;spark&lt;/td&gt;
      &lt;td&gt;spark.sql.parquet.filterPushdown&lt;/td&gt;
      &lt;td&gt;setting controls pushing down predicates to Parquet for discarding individual records&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;spark&lt;/td&gt;
      &lt;td&gt;spark.hadoop.parquet.filter.stats.enabled&lt;/td&gt;
      &lt;td&gt;discarding whole row groups&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;sorting&quot;&gt;sorting&lt;/h2&gt;

&lt;p&gt;predicate pushdownì˜ íš¨ìœ¨ì„ ë†’ì´ê¸° ìœ„í•´ì„œëŠ” filterì— ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì˜ˆì‹œë¡œ ë³´ì—¬ë“œë ¸ë˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;test.parqeut&lt;/code&gt; ì„ ì»¬ëŸ¼ Aë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì €ì¥í•œ ë’¤ ë©”íƒ€ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;parquet-tools meta sample_sorted.parquet
...
row group 1 : RC:125
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------&lt;/span&gt;
A: INT32 ... &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;min: 1, max : 3, num_nulls: 0]
B: ...
row group 2 : RC:125
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------&lt;/span&gt;
A: INT32 ... &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;min: 4, max : 6, num_nulls: 0]
B: ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ë§Œì•½ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;df.filter(df.A &amp;gt; 4).show()&lt;/code&gt;ë¼ëŠ” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í–ˆë‹¤ë©´, ì •ë ¬ë˜ì§€ ì•Šì•˜ë˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;test.parquet&lt;/code&gt; ì—ì„œëŠ” row group 1, row group 2ë¥¼ ëª¨ë‘ ìŠ¤ìº”í•´ì•¼í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sorted_test.parquet&lt;/code&gt; ì—ì„œëŠ” ì˜¤ì§ row group 2ë§Œ ìŠ¤ìº”í•˜ë©´ ë©ë‹ˆë‹¤. ì´ì²˜ëŸ¼ row group ë‹¨ìœ„ì˜ min/max ê°’ì´ ë²”ìœ„ê°€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ í•´ë‹¹ ì»¬ëŸ¼ì— ëŒ€í•´ ì •ë ¬í•˜ì—¬ ì €ì¥í•˜ë©´ predicate pushdownì˜ íš¨ìœ¨ì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;/p&gt;

&lt;p&gt;í•˜ë‘¡ ì™„ë²½ ê°€ì´ë“œ, í•œë¹›ë¯¸ë””ì–´&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://engineering.vcnc.co.kr/2018/05/parquet-and-spark/&quot;&gt;Apache Sparkì—ì„œ ì»¬ëŸ¼ ê¸°ë°˜ ì €ì¥ í¬ë§· Parquet(íŒŒì¼€ì´) ì œëŒ€ë¡œ í™œìš©í•˜ê¸°&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/cdh_ig_predicate_pushdown_parquet.html&quot;&gt;Predicate Pushdown in Parquet&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">parquet í¬ë§·ê³¼ predicate pushdownì— ëŒ€í•´ì„œ</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">repartition in Spark</title>
      <link href="https://gyuhoonk.github.io/spark-repartition" rel="alternate" type="text/html" title="repartition in Spark" />
      <published>2022-03-12T22:30:00+09:00</published>
      <updated>2022-03-12T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/spark-repartition</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/spark-repartition">&lt;p&gt;repartition íŒŒí—¤ì¹˜ê¸°&lt;/p&gt;

&lt;h1 id=&quot;repartition-&quot;&gt;Repartition ?&lt;/h1&gt;

&lt;p&gt;Sparkì—ì„œ RDD, Dataset, DataFrameì˜ ì‘ì—… ìµœì†Œë‹¨ìœ„ëŠ” partitionì…ë‹ˆë‹¤. ë°ì´í„°ì— Jobì„ ì ìš©í•  ë•Œ SparkëŠ” ìµœì†Œ ë‹¨ìœ„ì¸ partitionìœ¼ë¡œ ìª¼ê°œì„œ taskì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.í•˜ë‚˜ì˜ executorê°€ í•˜ë‚˜ì˜ task, ì¦‰ í•˜ë‚˜ì˜ partitionì— ëŒ€í•´ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ë•Œ, í•´ë‹¹ ë°ì´í„°ì…‹(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dataset&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt;) ë‚´ë¶€ì˜ partitionì˜ ê°œìˆ˜, ì‚¬ì´ì¦ˆ, ì •ë ¬ìƒíƒœëŠ” task ìˆ˜í–‰ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì´ë¼ë©´ partition Aë¥¼ ì „ë‹¬ë°›ì€ executorëŠ” OOMì„ í”¼í•  ìˆ˜ ì—†ì„ ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/partition_example.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ì´ëŸ¬í•œ ìƒí™©ì„ í”¼í•˜ê¸° ìœ„í•´, partitionë“¤ì´ ë™ì¼í•œ í¬ê¸°ë¥¼ ê°–ë„ë¡ ì¡°ì ˆ(rebalancing)í•  ìˆ˜ ìˆëŠ”ë° ì´ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartition&lt;/code&gt;ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartition&lt;/code&gt;ì€ í•„ìˆ˜ì ìœ¼ë¡œ shuffleì„ ë™ë°˜í•˜ëŠ” ë¬´ê±°ìš´ ì‘ì—…ì…ë‹ˆë‹¤. ë”°ë¼ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartition&lt;/code&gt;ì´ í•„ìš”í•œì§€ ì‹¬ì‚¬ìˆ™ê³ í•˜ì—¬ ì ì ˆí•œ ìˆ˜ì¹˜ë¡œ ì ìš©í•´ì•¼í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_repartitioned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_rdd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_repartitioned&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rdd&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partitions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;glom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; has &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; rows&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;partition0 has 1362 rows

partition1 has 1362 rows

partition2 has 1361 rows

partition3 has 1362 rows
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartition&lt;/code&gt; ì„ ì ìš©í•œ ê²°ê³¼ ê° partitionì´ ê°™ì€ row ìˆ˜ë¥¼ ê°–ë„ë¡ shuffleí•˜ì—¬ ê° partitionì— ì¬ë¶„ë°°í–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/repartition.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;repartition-by-specific-column&quot;&gt;Repartition by Specific Column&lt;/h1&gt;

&lt;p&gt;ìœ„ì—ì„œ ë³´ì•˜ë˜ ì˜ˆì‹œì²˜ëŸ¼ ë‹¨ìˆœíˆ ë°ì´í„° ì‚¬ì´ì¦ˆë§Œ ë¶„ë°°í•˜ëŠ” ê²ƒì´ ëª©ì ì€ ì•„ë‹™ë‹ˆë‹¤. partition ì „ëµì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹ì • column(Key)ì„ ê¸°ì¤€ìœ¼ë¡œ ì „ëµì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤. ì „ëµì„ ì ìš©í•œë‹¤ëŠ” ê²ƒì€ ìœ„ ì˜ˆì‹œì²˜ëŸ¼ partitionì— ë°ì´í„°ë¥¼ ë¬´ì‘ìœ„ë¡œ shuffleí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê·œì¹™ì— ë”°ë¼ partitionì— ë°ì´í„°ë¥¼ shuffleí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ì „ëµìœ¼ë¡œ hash partitoin, range partitionì€ Sparkì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ê³ ìˆê³ , í•„ìš”í•˜ë‹¤ë©´ ìì‹ ì´ ì§ì ‘ ì „ëµì„ ë§Œë“¤ì–´ ì ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤(custom partitioner).&lt;/p&gt;

&lt;p&gt;ì´ëŸ¬í•œ ì „ëµì„ ì ìš©í•˜ê²Œ ë˜ë©´, ì´í›„ partition ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©ëœ columnì„ ì‚¬ìš©í•œ ì§‘ê³„/ì¡°ê±´ ì ìš© ì‹œ ì¿¼ë¦¬ ì„±ëŠ¥ì´ í–¥ìƒë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;hash-partition&quot;&gt;Hash Partition&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/hash_repartition.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;hash partitionì€ Keyì— hash functionì„ ì ìš©í•˜ì—¬ ê³„ì‚°ëœ hash valueê°€ ê°™ì€ ê°’ë“¤ì„ ê°™ì€ partitionì— ë¶„ë°°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_hash_repartitioned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Day&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_rdd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_hash_repartitioned&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rdd&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partitions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;glom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; has &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; rows&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition key is &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;toSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;partition0 has 716 rows
partition key is Set(12, 13, 14, 18)

partition1 has 895 rows
partition key is Set(6, 9, 17, 16, 23)

partition2 has 462 rows
partition key is Set(5, 10, 31)

partition3 has 1074 rows
partition key is Set(1, 27, 7, 3, 11, 26)

partition4 has 179 rows
partition key is Set(25)

partition5 has 867 rows
partition key is Set(20, 29, 30, 19, 15)

partition6 has 717 rows
partition key is Set(2, 4, 22, 28)

partition7 has 537 rows
partition key is Set(8, 21, 24)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data&lt;/code&gt; ë¥¼ 8ê°œ partitionìœ¼ë¡œ repartitioní•˜ì˜€ìŠµë‹ˆë‹¤. ê°ê°ì˜ partitionì— rowê°€ ëª‡ ê°œë‚˜ ì¡´ì¬í•˜ê³ , repartition ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©í•œ columnì¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Day&lt;/code&gt; ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;partition0&lt;/code&gt;ì—ëŠ” 716 rowsê°€ í¬í•¨ë˜ì—ˆê³ , partition keyë¡œ ì‚¬ìš©ëœ ê°’ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12, 13, 14, 18&lt;/code&gt;ì…ë‹ˆë‹¤. ì¦‰,  Day ê°’ì´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12, 13, 14, 18&lt;/code&gt;ì¸ rowëŠ” ë°˜ë“œì‹œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;partition0&lt;/code&gt; ì— ì†í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;range-partition&quot;&gt;Range Partition&lt;/h2&gt;

&lt;p&gt;range partitionì€ Keyë¥¼ ì§€ì •ëœ ê°œìˆ˜ë§Œí¼ì˜ ë²”ìœ„ë¡œ ë‚˜ëˆ„ê³ , ê°ê°ì˜ ë²”ìœ„ì— ì†í•˜ëŠ” ê°’ì„ ê°™ì€ partitionì— ë¶„ë°°í•©ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pairRDD&lt;/code&gt;ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RangePartitioner&lt;/code&gt;ë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•ê³¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dataset&lt;/code&gt;ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartitionByRange&lt;/code&gt;ë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://spark.apache.org/docs/latest/api/scala/org/apache/spark/Partitioner.html&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Partitioner&lt;/code&gt;&lt;/a&gt;ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pairRDD&lt;/code&gt;ì´ì–´ì•¼ë§Œ í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;scala.collection.SortedSet&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sortSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unsortedSet&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;implicit&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ordering&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Ordering&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;SortedSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; 
    &lt;span class=&quot;nv&quot;&gt;SortedSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsortedSet&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// RDD&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dataRDD&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;getInt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;getDouble&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)))&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// key-value RDD(pair RDD)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rangePartitioner&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RangePartitioner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataRDD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rangedData&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dataRDD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;partitionBy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rangePartitioner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partitions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rangedData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;glom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; has &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; rows&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition key is &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sortSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;_1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;toSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Dataset&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rangedDataset&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartitionByRange&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Hour&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rangedRDD&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rangedDataset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rdd&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partitions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rangedRDD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;glom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; has &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; rows&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition key is &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sortSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;getInt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;toSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;partition0 has 954 rows
partition key is TreeSet(0, 2, 3)

partition1 has 1460 rows
partition key is TreeSet(5, 6, 8, 9)

partition2 has 730 rows
partition key is TreeSet(11, 12)

partition3 has 1460 rows
partition key is TreeSet(14, 15, 17, 18)

partition4 has 843 rows
partition key is TreeSet(20, 21, 23)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RangePartitioner&lt;/code&gt;ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RDD&lt;/code&gt;ì— ì ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìœ„ì²˜ëŸ¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt;ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RDD&lt;/code&gt;ë¡œ ë³€í™˜í•˜ì—¬ ì ìš©í•´ì•¼í•©ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dataset&lt;/code&gt;ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartitionByRange&lt;/code&gt;ë¥¼ ì´ìš©í•˜ì—¬ ì ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hour&lt;/code&gt; columnì— í•´ë‹¹í•˜ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x.getInt(3)&lt;/code&gt; ì„ ê¸°ì¤€ìœ¼ë¡œ  Range partitionì„ ì ìš©í–ˆìŠµë‹ˆë‹¤. ê° partitionì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0~3, 5~9, 11~12, 14~18, 20~23&lt;/code&gt;ì˜ 5ê°œ êµ¬ê°„ìœ¼ë¡œ ë‚˜ë‰˜ì–´ êµ¬ê°„ì— í•´ë‹¹í•˜ëŠ” ê°’ë“¤ì´ partitionì— í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;custom-partitioner&quot;&gt;Custom Partitioner&lt;/h2&gt;

&lt;p&gt;Hash, Rangeê°€ ì•„ë‹Œ ìì‹ ì´ ì§ì ‘ ê·œì¹™ì„ ì •ì˜í•˜ì—¬ reaprtitionì— ì ìš©ì‹œí‚¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” keyë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Day&lt;/code&gt; ë¡œ ë‘ê³ , 10ìœ¼ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€ë¥¼ partition ê¸°ì¤€ìœ¼ë¡œ ê²°ì •í•˜ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CustomPartitioner&lt;/code&gt;ë¥¼ ì •ì˜í•˜ê³  ì ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤. í•´ë‹¹ ë°ì´í„°ëŠ” ë§¤ì¼ ê°™ì€ ì–‘ì´ ìˆ˜ì§‘ëœ ë°ì´í„°ì´ë¯€ë¡œ,  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Day&lt;/code&gt;ì— ì´ì™€ ê°™ì€ ê·œì¹™ì„ ì ìš©í•˜ë©´  rebalancing íš¨ê³¼ë„ ë‚˜íƒ€ë‚  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CustomPartitioner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Partitioner&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;numPartitions&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getPartition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;hashCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numPartitions&lt;/span&gt;
          &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numPartitions&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  			&lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;scala.Any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Boolean&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;other&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CustomPartitioner&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;numPartitions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numPartitions&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// https://m.blog.naver.com/syung1104/221103154997&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dataRDD&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;getInt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;getDouble&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)))&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// pairRDD&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;customedData&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dataRDD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;partitionBy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CustomPartitioner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partitions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;customedData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;glom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; has &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; rows&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;partition key is &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sortSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;_1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;toSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;partition0 has 523 rows
partition key is TreeSet(10, 20, 30)

partition1 has 641 rows
partition key is TreeSet(1, 11, 21, 31)

partition2 has 537 rows
partition key is TreeSet(2, 12, 22)

partition3 has 537 rows
partition key is TreeSet(3, 13, 23)

partition4 has 537 rows
partition key is TreeSet(4, 14, 24)

partition5 has 537 rows
partition key is TreeSet(5, 15, 25)

partition6 has 537 rows
partition key is TreeSet(6, 16, 26)

partition7 has 537 rows
partition key is TreeSet(7, 17, 27)

partition8 has 538 rows
partition key is TreeSet(8, 18, 28)

partition9 has 523 rows
partition key is TreeSet(9, 19, 29)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Day&lt;/code&gt; ëŠ” 1~ 31ê¹Œì§€ ì¡´ì¬í•˜ê³ , ì´ë“¤ì„ 10ìœ¼ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€(ì¼ì˜ ìë¦¬)ëŠ” 0~9ê¹Œì§€ ì¡´ì¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ 10ê°œ partitionì„ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì‚´í´ë³´ì•˜ë˜ Hash, Rangeì— ë¹„í•´ reblancingì´ ê½¤ë‚˜ ì˜ ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;rebalancing-is-not-guaranteed&quot;&gt;Rebalancing is not guaranteed&lt;/h2&gt;

&lt;p&gt;ìœ„ ë°©ë²•ë“¤ì„ ì ìš©í–ˆì„ ë•Œ rebalancingì´ í•­ìƒ ë³´ì¥ë˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartition&lt;/code&gt;ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ê° partitionì˜ ë°ì´í„° ì‚¬ì´ì¦ˆê°€ ë™ì¼í•˜ë„ë¡ ë°ì´í„°ë¥¼ ì…”í”Œí•˜ì§€ë§Œ,  hash, range, custom repartitionì€ ê·œì¹™ì„ ì ìš©í•  ë¿ rebalancingì„ ê³ ë ¤í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìœ„ë¥¼ ë¹„êµí•´ë³´ë©´  hash, rangeë¥¼ ì ìš©í–ˆì„ ë•ŒëŠ” partitonì˜ ë°ì´í„° ë¶„í¬ê°€ ë¶ˆê· í˜•í•©ë‹ˆë‹¤. ì´ì— ë¹„í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Day&lt;/code&gt;ì˜ íŠ¹ì„±ì„ ì´ìš©í•˜ì—¬ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartition&lt;/code&gt;ì„ ì ìš©í–ˆê¸°ì— ê° partitionì˜ ë°ì´í„° ë¶„í¬ê°€ hash, rangeì— ë¹„í•´ ê· ë“±í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;sort-in-partition&quot;&gt;Sort in Partition&lt;/h1&gt;

&lt;p&gt;partition ë‚´ë¶€ë¥¼ ì •ë ¬ì‹œí‚¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìœ„ì˜  Hash Partitionì„ ì ìš©í•œ ê²°ê³¼ ì¤‘ í•˜ë‚˜ì˜ partition ë‚´ë¶€ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_repartitioned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_rdd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_repartitioned&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rdd&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partitions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;glom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Year, Month, Day, Hour, Pressure, WetTemp, DryTemp, Humidity, Direction, Speed, City]
[89,1,12,2,944.4,8.2,6.6,5,0,0,Canberra]
[89,1,12,5,945.8,7.9,6.3,4,0,0,Canberra]
[89,1,12,8,948.5,13.2,8.3,2,7,4,Canberra]
[89,1,12,11,948.3,18.1,11.5,5,16,4,Canberra]
[89,1,12,14,947.9,21.4,12.2,2,9,6,Canberra]
...
[89,1,13,2,953.2,14.1,12.4,11,0,0,Canberra]
[89,1,13,5,953.5,13.1,11.1,9,0,0,Canberra]
[89,1,13,8,954.9,15.6,11.8,8,6,5,Canberra]
[89,1,13,11,954.8,18.6,12.7,7,0,0,Canberra]
...
[89,12,18,5,1014.0,16.2,15.3,15,2,18,Gabo Island]
[89,12,18,8,1014.4,18.8,17.4,16,2,22,Gabo Island]
[89,12,18,11,1013.5,20.7,17.9,16,2,24,Gabo Island]
[89,12,18,14,1011.6,20.2,18.0,16,2,24,Gabo Island]
[89,12,18,17,1010.1,20.5,18.1,16,2,24,Gabo Island]
[89,12,18,20,1010.5,18.5,17.2,16,2,20,Gabo Island]

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Day&lt;/code&gt;ê°€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12, 13, 14, 18&lt;/code&gt;ì¸ Rowë“¤ì´ partition ë‚´ë¶€ì— ì¡´ì¬í•˜ì§€ë§Œ, ì •ë ¬ë˜ì–´ìˆì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. ì´ë“¤ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Day&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hour&lt;/code&gt;ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•´ë†“ëŠ”ë‹¤ë©´ ì¶”í›„ì— ì‹¤í–‰ë˜ëŠ” ì‘ì—…ë“¤ì—ì„œ ì‹¤í–‰ ì‹œê°„ì„ ì•„ë‚„ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sortWithinPartitions&lt;/code&gt;ë¥¼ í†µí•´ ê°€ëŠ¥í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_repartitioned_sorted&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_repartitioned&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;sortWithinPartitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Day&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Hour&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_rdd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_repartitioned_sorted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rdd&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partitions&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data_rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;glom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;partitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Year, Month, Day, Hour, Pressure, WetTemp, DryTemp, Humidity, Direction, Speed, City]
[89,4,12,0,945.5,11.1,10.0,9,0,0,Canberra]
[89,5,12,0,952.7,8.2,7.4,6,0,0,Canberra]
[89,6,12,0,948.8,7.4,6.0,4,9,6,Canberra]
[89,7,12,0,944.8,3.8,3.1,2,0,0,Canberra]
[89,8,12,0,957.7,2.0,0.5,-2,8,12,Canberra]
...
[89,1,18,23,942.6,16.0,14.5,13,0,0,Canberra]
[89,3,18,23,955.8,15.8,13.9,13,0,0,Canberra]
[89,11,18,23,945.9,12.3,11.5,11,4,2,Canberra]
[89,12,18,23,947.8,17.8,12.0,6,0,0,Canberra]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Day&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hour&lt;/code&gt;ë¥¼ ê¸°ì¤€ìœ¼ë¡œ partition ë‚´ë¶€ê°€ ì •ë ¬ë˜ì–´ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;repartitionAndSortWithinPartitions&lt;/code&gt;(&lt;a href=&quot;https://spark.apache.org/docs/1.6.1/api/scala/index.html#org.apache.spark.rdd.OrderedRDDFunctions&quot;&gt;link&lt;/a&gt;)ëŠ” repartitionê³¼ sortë¥¼ ë™ì‹œì— ì ìš©í•´ì¤ë‹ˆë‹¤. piarRDDì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dataRDD&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;rdd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;getInt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;getDouble&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dataRepartitionedSorted&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dataRDD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;py&quot;&gt;repartitionAndSortWithinPartitions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HashPartitioner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://m.blog.naver.com/syung1104/221103154997&quot;&gt;[Spark] Apache Spark ì‚¬ìš©í•´ë³´ê¸° - 7. Partitioning&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://techvidvan.com/tutorials/spark-partition/&quot;&gt;Apache Spark Partitioning and Spark Partition&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">repartition íŒŒí—¤ì¹˜ê¸°</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Partition, Spill in Spark</title>
      <link href="https://gyuhoonk.github.io/spark-shuffle-partition" rel="alternate" type="text/html" title="Partition, Spill in Spark" />
      <published>2022-02-09T22:30:00+09:00</published>
      <updated>2022-02-09T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/spark-shuffle-partition</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/spark-shuffle-partition">&lt;p&gt;Partition, Spill in Spark&lt;/p&gt;

&lt;h2 id=&quot;spark-needs-performance-tuning&quot;&gt;Spark Needs Performance Tuning&lt;/h2&gt;

&lt;p&gt;Sparkë¡œ ì‘ì„±ëœ Applicationì€ ì‹¤í–‰ì„ ë„˜ì–´, ìµœì í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” Partition ë‹¨ìœ„ë¡œ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” Spark íŠ¹ì„± ë•Œë¬¸ì…ë‹ˆë‹¤. íŠ¹íˆ, Partition ê°„ shuffleì´ ë°œìƒí•˜ëŠ” ê²½ìš°ì— ë§ì€ ìì›ê³¼ ì‹œê°„ì„ ì†Œëª¨í•˜ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, Spark Tuning(Optimization)ì´ë€ Shuffle ì‘ì—… ì†ë„ë¥¼ ë¹ ë¥´ê²Œ ë§Œë“œëŠ” ê²ƒê³¼ ë‹¤ë¦„ ì—†ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;Shuffle ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” partition ê°œìˆ˜ë¥¼ ì ì ˆí•˜ê²Œ ì¡°ì ˆí•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h4 id=&quot;input-shuffle-read-shuffle-write-output&quot;&gt;Input, Shuffle Read, Shuffle Write, Output&lt;/h4&gt;

&lt;p&gt;Spark Jobì€ ì—¬ëŸ¬ Stageë¡œ ë‚˜ë‰˜ê²Œ ë˜ê³ , ê° StageëŠ” Input, Shuffle Read, Shuffle Write, Ouputë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ëª¨ë“  StageëŠ” partitionì„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì´ë©°, ì•„ë˜ì™€ ê°™ì´ ì„¤ëª…ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Shuffling means the reallocation of data between multiple Spark stages. â€œShuffle Writeâ€ is the sum of all written serialized data on all executors before transmitting (normally at the end of a stage) and â€œShuffle Readâ€ means the sum of read serialized data on all executors at the beginning of a stage. (&lt;a href=&quot;https://stackoverflow.com/questions/27276884/what-is-shuffle-read-shuffle-write-in-apache-spark&quot;&gt;What is shuffle read &amp;amp; shuffle write in Apache Spark&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Stage&lt;/th&gt;
      &lt;th&gt;ì„¤ëª…&lt;/th&gt;
      &lt;th&gt;êµ¬ë¶„&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Input&lt;/td&gt;
      &lt;td&gt;Task ìˆ˜í–‰ì„ ìœ„í•´ ì™¸ë¶€ ë°ì´í„°ë¥¼ SparkSession, SparkContextë¡œ ë¡œë“œí•¨&lt;/td&gt;
      &lt;td&gt;Partition Read&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Shuffle Read&lt;/td&gt;
      &lt;td&gt;Task ìˆ˜í–‰ì„ ìœ„í•´ SparkSession, SparkContext ë‚´ë¶€(executors)ì˜ Serialized Dataë¥¼ ì½ì–´ë“¤ì„&lt;/td&gt;
      &lt;td&gt;Partition Read&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Shuffle Write&lt;/td&gt;
      &lt;td&gt;Task ìˆ˜í–‰ ê²°ê³¼ë¥¼ SparkSession, SparkContext ë‚´ë¶€(executors)ì˜ Serialzied Dataë¡œ ë‚´ë³´ëƒ„&lt;/td&gt;
      &lt;td&gt;Partition Write&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Output&lt;/td&gt;
      &lt;td&gt;Task ìˆ˜í–‰ ê²°ê³¼ë¥¼ SparkSession, SparkContext ì™¸ë¶€ì— ì‘ì„±í•¨&lt;/td&gt;
      &lt;td&gt;Partition Write&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;í•˜ë‚˜ì˜ StageëŠ” Partiton Readì™€ Partition Writeë¡œ ì´ë£¨ì–´ì ¸ìˆìŠµë‹ˆë‹¤. Partitionì„ ì½ê³ , ì½ì–´ë“¤ì—¬ì˜¨ Partitionì— ëŒ€í•´ Taskë¥¼ ìˆ˜í–‰í•˜ê³ (Shuffle) ê·¸ ê²°ê³¼ë¥¼ ë‹¤ì‹œ Partitionìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM default.table_1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM default.table_2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;df1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;df1.col1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;df1.col2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;df1.col3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;joined_agg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;col2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;agg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cnt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;default.joined&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;joined_agg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'overwrite'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/user/hive/warehouse/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.db/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;saveAsTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì˜ˆë¥¼ ë“¤ì–´ ìœ„ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ì€ stagesë¥¼ êµ¬ì„±í•˜ê³ , ì‹¤í–‰ë©ë‹ˆë‹¤. Inputì´ 2ë²ˆ ìˆì—ˆê³ , Inputí•˜ì—¬ shuffle writeëœ DataFrame(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;df1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;df2&lt;/code&gt;)ì— ëŒ€í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;join&lt;/code&gt;ê³¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;saveAsTable&lt;/code&gt;ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/stages1.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ì™¼ìª½ì˜ &lt;strong&gt;Task: Succeeded/Total&lt;/strong&gt;ì€ Stage ë‚´ì—ì„œ Task ìˆ˜í–‰ ì‹œ ëª‡ ê°œì˜ Taskê°€ ìˆ˜í–‰ë˜ì—ˆëŠ”ì§€ í‘œì‹œí•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql&lt;/code&gt;ì„ ì‚¬ìš©í•˜ì—¬ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt; ê°ì²´ë¥¼ ë§Œë“œëŠ” ê²½ìš°ì—ëŠ” í•´ë‹¹ í…Œì´ë¸”ì˜ íŒŒì¼ ê°œìˆ˜ë§Œí¼(61228, 29684) Taskë¥¼ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;df1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;df2&lt;/code&gt;ì˜ íŒŒí‹°ì…˜ ê°œìˆ˜ë„ ê°ê° 61228, 29684ê°œ ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë§¨ ìœ„ì— &lt;strong&gt;1000/1000 (112 failed)&lt;/strong&gt;ëŠ” 1000ê°œ ì‘ì—… ì¤‘ì— ì¤‘ê°„ì— 112ê°œ taskë¥¼ ì‹¤íŒ¨í–ˆì—ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. 1000ê°œ taskê°€ ì‹¤í–‰ëœ ì´ìœ ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql.shuffle.partitions&lt;/code&gt;ë¥¼ 1000ìœ¼ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;í•´ë‹¹ ê°’ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql.shuffle.partitions&lt;/code&gt;ë¥¼ í†µí•´ ë³€ê²½í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h4 id=&quot;spark-partitionsparkdefaultparallelism-sparksqlshufflepartitions&quot;&gt;Spark Partition(spark.default.parallelism, spark.sql.shuffle.partitions)&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt; â€“ Default number of partitions in resilient distributed datasets (RDDs) returned by transformations like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;join&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;reduceByKey&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parallelize&lt;/code&gt; when no partition number is set by the user.&lt;/p&gt;

  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql.shuffle.partitions&lt;/code&gt; â€“ Sets the number of partitions for joins and aggregations.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Sparkì—ì„œ ì‚¬ìš©í•˜ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RDD&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dataset&lt;/code&gt;ì€ ëª¨ë‘ Partitionì„ ê°€ì¥ ì‘ì€ ë‹¨ìœ„(ê°ì²´)ë¡œ ê°–ìŠµë‹ˆë‹¤. ì´ Partitionì„ ë‹¨ìœ„ë¡œ ê° Executorì˜ CoreëŠ” ì‘ì—…(Task)ë¥¼ ì ìš©í•©ë‹ˆë‹¤. ì´ì¤‘ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RDD&lt;/code&gt;ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt;ì— ì˜í•´ì„œ partition ê°’ì´ ê²°ì •ë©ë‹ˆë‹¤. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dataset&lt;/code&gt;ì˜ ê²½ìš°ì—ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql.shuffle.partitions&lt;/code&gt;ì— ì˜í•´ partition ê°œìˆ˜ê°€ ê²°ì •ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark.sql&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SparkSession&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pyspark&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SparkConf&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SparkConf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setAppName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'spark_partition_test'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setMaster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;yarn&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;## 5 cores per executor
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.executor.cores&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;5&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.driver.cores&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;5&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;## 30 executors
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.executor.instances&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;30&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;## 10 GB per executor -&amp;gt; 2GB per core
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.driver.memory&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;10G&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.executor.memory&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;10G&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;## SparkSession has 30 * 5 cores, which each core has 2GB mem.
## So, spark.default.parallelism is 150(# of cores), and spark.sql.shuffle.partitions is 200(default)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SparkSession&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enableHiveSupport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getOrCreate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM default.table_1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM default.table_2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;df1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;df1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;df1.col1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;df1.col2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;df1.col3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;joined_agg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;joined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;col2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;agg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cnt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;default.joined&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;joined_agg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'overwrite'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/user/hive/warehouse/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.db/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;saveAsTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ë”°ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt;ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ core ê°œìˆ˜ë§Œí¼ìœ¼ë¡œ partition ê°œìˆ˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ë”°ë¼ì„œ, ê¸°ë³¸ì ìœ¼ë¡œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RDD&lt;/code&gt;ëŠ” 150(5 cores * 30 executors)ê°œì˜ partitionìœ¼ë¡œ ë¶„í• ì²˜ë¦¬ë  ê²ƒì…ë‹ˆë‹¤. core ê°œìˆ˜ì™€ partiton ê°œìˆ˜ê°€ ê°™ìœ¼ë¯€ë¡œ 1 task per 1 coreë¡œ ë¶„ì‚° ì²˜ë¦¬í•˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤. í•œí¸, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql.shuffle.partitions&lt;/code&gt;ëŠ” ê¸°ë³¸ê°’ì´ 200ì´ê¸° ë•Œë¬¸ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dataset&lt;/code&gt;ì€ 200ê°œì˜ partitionìœ¼ë¡œ ë¶„í• ì²˜ë¦¬ ë  ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/stages2.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ê·¸ëŸ¬ë‚˜, 200 partitionsë¡œ ì„¤ì •í•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ê²½ìš° ê³„ì†í•´ì„œ fail taskê°€ ë°œìƒí•˜ê³  ê²°ê³¼ì ìœ¼ë¡œ Appì´ ì¤‘ê°„ì— ì¢…ë£Œë˜ì–´ë²„ë ¸ìŠµë‹ˆë‹¤. Fail ë°œìƒì„ ì¤„ì´ê³  appì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ì„ ì™„ë£Œí•˜ê¸° ìœ„í•´ì„œëŠ” íŠœë‹ì´ í•„ìš”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì¼ë°˜ì ìœ¼ë¡œ ì „ì²´ core ê°œìˆ˜ì˜ 2ë°°~3ë°° ì •ë„ê¹Œì§€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.default.parallelism&lt;/code&gt;ì„ ì„¤ì •í•´ì¤„ ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ìœ„ì˜ conf settingì€ ì•„ë˜ í•­ëª©ì„ ì¶”ê°€í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;## SparkSession has 30 * 5 cores, So proper number of partitions is 150 * 2 or 150 * 3.
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.sql.shuffle.partitions&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;450&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SparkSession&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enableHiveSupport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getOrCreate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/stages3.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;450 tasksê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì–´ì ¼íˆ Shuffle Spillì´ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/shuffle-spill1.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;what-makes-spark-slower&quot;&gt;What makes Spark Slower?&lt;/h2&gt;

&lt;p&gt;ê°€ì¥ í° ì´ìœ ëŠ” &lt;strong&gt;Shuffle Spill&lt;/strong&gt; ë•Œë¬¸ì…ë‹ˆë‹¤. partitionì´ ë„ˆë¬´ ì»¤ì„œ í•˜ë‚˜ì˜ core(RAM)ì— ëª¨ë‘ ë‹´ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°ì— Spillì´ ë°œìƒí•©ë‹ˆë‹¤. ì´ ë•Œ ë°œìƒí•œ Spillì€ Diskì— ì €ì¥ë˜ì—ˆë‹¤ê°€, ì—°ì‚° í•„ìš” ì‹œ ë‹¤ì‹œ RAMìœ¼ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê³¼ì •ì—ì„œ ì§ë ¬í™”(serialize)ì™€ ì—­ì§ë ¬í™”(deserialize) ê³¼ì •ì„ ê±°ì¹˜ê¸° ë•Œë¬¸ì— Spillì´ ë°œìƒí•œ Task(ì¦‰ partition)ì€ ìˆ˜í–‰ ì‹œê°„ì´ ëŠ˜ì–´ë‚˜ê³  Failì´ ë°œìƒí•  í™•ë¥ ì´ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;Spill is the term used to refer to the act of moving an RDD from RAM to disk, and later back into RAM again.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Shuffle Spill(Disk) ì™€  Shuffle Spill(Memory)ê°€ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;â€œShuffle spill (memory) is the size of the deserialized form of the data in memory at the time when we spill it, whereas shuffle spill (disk) is the size of the serialized form of the data on disk after we spill it. This is why the latter tends to be much smaller than the former. Note that both metrics are aggregated over the entire duration of the task (i.e. within each task you can spill multiple times).â€&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;RAM(=memory)ì—ì„œ Spillì´ ë°œìƒí•˜ê²Œ ë˜ë©´ ì´ë¥¼ ì§ë ¬í™”(serialize)í•˜ì—¬ diskì— ì„ì‹œë¡œ ì €ì¥í•´ë‘¡ë‹ˆë‹¤. ì§ë ¬í™”í•˜ëŠ” ê³¼ì •ì—ì„œ ë°ì´í„° ì‚¬ì´ì¦ˆëŠ” ì¤„ì–´ë“¤ê²Œ ë˜ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ Shuffle Spill(Disk)ê°€ Shuffle Spill(Memory)ë³´ë‹¤ ì‘ì€ ê°’ì„ ê°–ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´í›„ì—, Taskì—ì„œ Diskë¡œ Spillí•œ ë°ì´í„°ë¥¼ ì—°ì‚°ì— ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì—­ì§ë ¬í™”(deserialize)í•˜ì—¬ RAMìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤. ë”°ë¼ì„œ I/Oì˜ ì¦ê°€, ì§ë ¬í™”/ì—­ì§ë ¬í™” ê³¼ì •ì´ ì¶”ê°€ë˜ë©´ì„œ Task ìˆ˜í–‰ ì‹œê°„ì€ ëŠ˜ì–´ë‚˜ê²Œ ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/spill-water.jpg&quot; alt=&quot;image&quot; style=&quot;zoom:33%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€‹							       ì»µì´ ë¬¼ì„ ëª¨ë‘ ë‹´ì•„ë‚´ì§€ ëª»í•˜ëŠ” ê²ƒì²˜ëŸ¼ memoryê°€ partitionì„ ë‹´ì•„ë‚´ì§€ ëª»í•˜ê³  í˜ë ¤ë²„ë¦¬ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤&lt;/p&gt;

&lt;h4 id=&quot;how-to-remove-spill&quot;&gt;How to remove Spill?&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Memory Sizeë¥¼ ëŠ˜ë¦°ë‹¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Task ìˆ˜í–‰ì— ì‚¬ìš©ë˜ëŠ” Coreì—ê²Œ ë” í° RAMì„ í• ë‹¹í•´ì£¼ë©´, Shuffle Spillì´ ë°œìƒí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë¬¼ê³¼ ì»µì— ë¹„ìœ í•˜ìë©´ ì»µì˜ í¬ê¸°ë¥¼ ëŠ˜ë¦¬ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;## 5 cores per executor
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.executor.cores&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;5&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.driver.cores&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;5&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;## 30 executors
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.executor.instances&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;30&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;## 15 GB per executor -&amp;gt; 3GB per core
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.driver.memory&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;15G&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.executor.memory&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;15G&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;## SparkSession has 30 * 5 cores, which each core has 2GB mem.
## So, spark.default.parallelism is 150(# of cores), and spark.sql.shuffle.partitions is 200(default)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SparkSession&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enableHiveSupport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getOrCreate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ê¸°ì¡´ì— Coreì— 2GBë¥¼ í• ë‹¹í–ˆì—ˆì§€ë§Œ, 3GBë¡œ ì¦ê°€ì‹œì¼°ìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ Shuffle Readê°€ 600GB ì´ìƒì¸ ê²½ìš°ì—ëŠ” core sizeê°€ 4GB ì´ìƒìœ¼ë¡œ ì„¤ì •í•  ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;Shuffle Readê°€ 600GBê°€ ë„˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” core sizeë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒë³´ë‹¤ ì•„ë˜ì˜ ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;partition sizeë¥¼ ì¤„ì¸ë‹¤ ( # partitionì„ ëŠ˜ë¦°ë‹¤ )&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Coreì—ê²Œ ì „ë‹¬ë˜ëŠ” partition sizeë¥¼ ì¤„ì—¬ì„œ Shuffle Spillì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¼ì„ ì¡°ê¸ˆì”©(smaller partition size) ìì£¼ ì»µì— ë‹´ëŠ”ë‹¤ë©´ ë¬¼ì´ ë„˜ì¹˜ì§€ì•Šê² ì£ . Shuffle ReadëŠ” ë°ì´í„°ê°€ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ê³ ì •ë˜ì–´ìˆìœ¼ë¯€ë¡œ partition sizeë¥¼ ì¤„ì¸ë‹¤ëŠ” ê²ƒì€ partition ê°œìˆ˜ë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒê³¼ ë™ì¼í•©ë‹ˆë‹¤. Shuffle Partitionì˜ í¬ê¸°ë¥¼ 100MB~200MBë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ìµœì ìœ¼ë¡œ ì•Œë ¤ì ¸ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.default.paralleism&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spark.sql.shuffle.partitions&lt;/code&gt;ì™€ ê°™ì€ conf optionì´ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜¹ì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;df.repartition()&lt;/code&gt;ì²˜ëŸ¼ ëª…ì‹œì ìœ¼ë¡œ partition ê°œìˆ˜ë¥¼ ëŠ˜ë ¤ì£¼ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spark.sql.shuffle.partitions&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1000&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SparkSession&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enableHiveSupport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getOrCreate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Shuffle Spillì´ ë°œìƒí•˜ì§€ ì•Šê³  ìˆ˜í–‰ ì‹œê°„ë„ ì¤„ì–´ë“¤ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../../assets/built/images/hadoop/shuffle-spill2.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ë§ˆì¹˜ë©°&quot;&gt;ë§ˆì¹˜ë©°&lt;/h2&gt;

&lt;p&gt;ì• ë§¤í•˜ê²Œ ì•Œê³  ìˆì—ˆë˜ partition, shuffle, spillì˜ ê°œë…ì„ ì •ë¦¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ìœ„ì—ì„œ ê°€ì •í•œ ìƒí™©ì€ ëª¨ë“  partitionì— ë°ì´í„°ê°€ ê³ ë£¨ ë¶„ë°°ë˜ëŠ” ì´ìƒì ì¸ ìƒí™©ì…ë‹ˆë‹¤. ì‹¤ì œ ìƒí™©ì—ì„œëŠ” skewed dataset ë•Œë¬¸ì— straggler taskê°€ ë°œìƒí•˜ê¸°ë„ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” ë¨¼ì € í•„í„°ë§í•˜ê±°ë‚˜, partition ê°œìˆ˜ë¥¼ ë”ìš± ëŠ˜ë¦¬ëŠ” ë°©ë²•(partition sizeê°€ 100MBë³´ë‹¤ ì‘ë„ë¡)ìœ¼ë¡œ ëŒ€ì²˜í•´ì•¼í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://people.csail.mit.edu/matei/papers/2012/nsdi_spark.pdf&quot;&gt;Resilient Distributed Datasets: A Fault-Tolerant Abstraction for In-Memory Cluster Computing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://tech.kakao.com/2021/10/08/spark-shuffle-partition/&quot;&gt;Spark Shuffle Partitionê³¼ ìµœì í™”&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://luminousmen.com/post/spark-partitions&quot;&gt;Spark Partitions&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jaemunbro.medium.com/apache-spark-partition-%EA%B0%9C%EC%88%98%EC%99%80-%ED%81%AC%EA%B8%B0-%EC%A0%95%ED%95%98%EA%B8%B0-3a790bd4675d&quot;&gt;[Apache Spark] Partition ê°œìˆ˜ì™€ í¬ê¸° ì •í•˜ê¸°&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://aws.amazon.com/ko/blogs/big-data/best-practices-for-successfully-managing-memory-for-apache-spark-applications-on-amazon-emr/&quot;&gt;Best practices for successfully managing memory for Apache Spark applications on Amazon EMR&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://community.cloudera.com/t5/Support-Questions/Spark-shuffle-spill-Memory/td-p/186859&quot;&gt;Spark shuffle spill (Memory)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://medium.com/road-to-data-engineering/spark-performance-optimization-series-2-spill-685126e9d21f&quot;&gt;Spark Performance Optimization Series: #2. Spill&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">Partition, Spill in Spark</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">hadoop distcp</title>
      <link href="https://gyuhoonk.github.io/hadoop-distcp" rel="alternate" type="text/html" title="hadoop distcp" />
      <published>2022-01-20T22:30:00+09:00</published>
      <updated>2022-01-20T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/hadoop-distcp</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/hadoop-distcp">&lt;p&gt;hadoop distcp ëª…ë ¹ì–´&lt;/p&gt;

&lt;h1 id=&quot;distcp&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;distcp&lt;/code&gt;&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;distcp&lt;/code&gt; ëª…ë ¹ì–´ëŠ” íš¨ìœ¨ì ì¸ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ í†µí•´ íŒŒì¼ì„ ë³µì‚¬í•©ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì€ ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# íŒŒì¼ ë³µì‚¬&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp file1 file2
&lt;span class=&quot;c&quot;&gt;# hadoop fs -cp file1 file2 ì™€ ê°™ì€ ê²°ê³¼ì´ì§€ë§Œ&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# distcpë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” 'ë³‘ë ¬ ì²˜ë¦¬'í•˜ì—¬ ë³µì‚¬í•¨&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ë””ë ‰í† ë¦¬ ë³µì‚¬&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp dir1 dir2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;discp&lt;/code&gt;ëŠ” ë‚´ë¶€ì ìœ¼ë¡œëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hadoop fs -cp&lt;/code&gt;ëª…ë ¹ì„ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ ìˆ˜í–‰í•˜ëŠ” ë°©ì‹ì´ê¸° ë•Œë¬¸ì— í° íŒŒì¼ì˜ ë³µì‚¬ì— ë” ì í•©í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;options&quot;&gt;options&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://hadoop.apache.org/docs/stable/hadoop-distcp/DistCp.html&quot;&gt;DistCp Guide&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# overwrite&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hdfs dfs &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; dir1 dir2


&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp dir1 dir2
&lt;span class=&quot;c&quot;&gt;# ì´ë¯¸ dir2ê°€ ì¡´ì¬í•˜ê³  ìˆìœ¼ë¯€ë¡œ, dir2ì˜ í•˜ìœ„ì— dir1ì„ ë³µì‚¬í•¨&lt;/span&gt;


&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp &lt;span class=&quot;nt&quot;&gt;-overwrite&lt;/span&gt; dir1 dir2
&lt;span class=&quot;c&quot;&gt;# overwrite ì˜µì…˜ì´ ìˆìœ¼ë¯€ë¡œ dir2ì— dir1ì„ ë®ì–´ì”Œì›€&lt;/span&gt;



&lt;span class=&quot;c&quot;&gt;# update&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ë””ë ‰í† ë¦¬ ë‚´ì— ë³€ê²½ì´ ìˆëŠ” íŒŒì¼ë“¤ë§Œ ë³µì‚¬í•˜ì—¬ ë™ê¸°í™”ì‹œí‚µë‹ˆë‹¤.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp &lt;span class=&quot;nt&quot;&gt;-update&lt;/span&gt; dir1 dir2
&lt;span class=&quot;c&quot;&gt;# dir1 ë‚´ íŒŒì¼ê³¼ dir2 ë‚´ íŒŒì¼ì„ ë¹„êµí•˜ì—¬ ë³€ê²½ëœ ë¶€ë¶„ë§Œ dir2ì— ë™ê¸°í™”ì‹œí‚´&lt;/span&gt;



&lt;span class=&quot;c&quot;&gt;# delete&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ì›ë³¸ ê²½ë¡œì—ëŠ” ì¡´ì¬í•˜ì§€ ì•Šê³ , íƒ€ê²Ÿ ê²½ë¡œì—ë§Œ ì¡´ì¬í•˜ëŠ” íŒŒì¼ë“¤ì„ ì§€ìš°ë„ë¡ í•˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp &lt;span class=&quot;nt&quot;&gt;-delete&lt;/span&gt; dir1 dir2
&lt;span class=&quot;c&quot;&gt;# dir1, dir2ë¥¼ ë¹„êµí•˜ì—¬ dir2ì—ë§Œ ì¡´ì¬í•˜ëŠ” íŒŒì¼ë“¤ì€ ì‚­ì œí•œ ë’¤ distcpë¥¼ ìˆ˜í–‰&lt;/span&gt;



&lt;span class=&quot;c&quot;&gt;# m&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ëª‡ ê°œì˜ mapperë¥¼ ì‚¬ìš©í• ì§€ ê²°ì •í•©ë‹ˆë‹¤. &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ê¸°ë³¸ì ìœ¼ë¡œ distcpëŠ” Map-Reduce Jobìœ¼ë¡œ êµ¬í˜„ë˜ì–´ìˆìœ¼ë©° &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# í´ëŸ¬ìŠ¤í„° ì „ë°˜ì— ê±¸ì³ ë³‘ë ¬ë¡œ ìˆ˜í–‰ë˜ëŠ” Map Taskë¥¼ ì´ìš©í•˜ì—¬ ë³µì‚¬ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ë‹¨, Reducerë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©° ê° íŒŒì¼ì€ Mapperì—ì„œ ë³µì‚¬í•©ë‹ˆë‹¤. &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ì´ ë•Œ bucketingì„ í†µí•´ ê° Mapperì— ê±°ì˜ ê°™ì€ ì–‘ì˜ ë°ì´í„°ë¥¼ ì œê³µí•˜ê³ ì í•©ë‹ˆë‹¤. &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ê¸°ë³¸ê°’ìœ¼ë¡œ ìµœëŒ€ 20ê°œì˜ Mapperê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; 100 file1 file2
&lt;span class=&quot;c&quot;&gt;# 100ê°œ Mapperë¥¼ ì‚¬ìš©í•˜ì—¬ distcp ìˆ˜í–‰&lt;/span&gt;



&lt;span class=&quot;c&quot;&gt;# p&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#ë³µì œ ì‹œ íŒŒì¼ì˜ ê¶Œí•œ, ë¸”ë¡ ì‚¬ì´ì¦ˆ ë“± íŒŒì¼ ì†ì„± ì •ë³´ë¥¼ ë³´ì „í•˜ë ¤ëŠ” ê²½ìš°ì— ì‚¬ìš©ë©ë‹ˆë‹¤. &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; file1 file2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;ë‹¤ë¥¸-í´ëŸ¬ìŠ¤í„°namenodeê°„-ë³µì‚¬&quot;&gt;ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°(namenode)ê°„ ë³µì‚¬&lt;/h1&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp webhdfs://namenode1:14000/foo webhdfs://namenode2:14000/foo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ìœ„ì²˜ëŸ¼ namenode1ì—ì„œ namenode2ë¡œ íŒŒì¼ì„ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°ì— webHDFS í”„ë¡œí† ì½œì„ ì´ìš©í•©ë‹ˆë‹¤. webHDFS í”„ë¡œí† ì½œ ëŒ€ì‹ ì— HttpFs í”„ë¡ì‹œ ë°©ì‹ìœ¼ë¡œ distcpì˜ ì†ŒìŠ¤ í˜¹ì€ íƒ€ê¹ƒì„ ë³€ê²½í•  ìˆ˜ë„ ìˆë‹¤. HttpFs í”„ë¡ì‹œ ë°©ì‹ì€ ë°©í™”ë²½, ëŒ€ì—­í­ ì„¤ì •ì„ í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì°¸ê³ ë¡œ HDFSì— ì ‘ê·¼ ê°€ëŠ¥í•œ ì¸í„°í˜ì´ìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;webHDFS&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;HDFSëŠ” REST APIë¥¼ ì´ìš©í•˜ì—¬ íŒŒì¼ì„ ì¡°íšŒ, ìƒì„±, ìˆ˜ì •, ì‚­ì œ(CRUD)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” APIê°€ webHDFSì´ë©°  FileSystem APIì…ë‹ˆë‹¤. í•´ë‹¹ í”„ë¡œí† ì½œì€ Java FileSystem Classì— ì‘ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹¤ë¥¸ FileSystemì„ ì´ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Http&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;JAVAë¡œ ì‘ì„±ë˜ì§€ ì•Šì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ HDFSì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ WebHDFS í”„ë¡œí† ì½œì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬ HTTP REST APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;C - libhdfs library&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;JAVA FileSystem Classë¥¼ ëª¨ë°©í•˜ì—¬ ì‘ì„±ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ëª¨ë“  HDFS(Local, S3 ë“±)ì— ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤. JNI(Java Native Interface)ë¥¼ ì‚¬ìš©í•˜ì—¬ JAVA FileSystem Classë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;NFS&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;NFSv3 ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì´ìš©í•˜ì—¬ ë¡œì»¬ í´ë¼ì´ì–¸íŠ¸ íŒŒì¼ì‹œìŠ¤í…œì— HDFSë¥¼ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ls, catê³¼ ê°™ì€ unix ëª…ë ¹ì–´ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì°¸ê³ ë¡œ, HDFSëŠ” íŒŒì¼ì˜ ëì—ë§Œ ì“°ê¸°ë¥¼ í—ˆìš©í•˜ë¯€ë¡œ íŒŒì¼ì— ì¶”ê°€í•˜ëŠ” ì‘ì—…ì€ ê°€ëŠ¥í•˜ì§€ë§Œ, íŒŒì¼ì˜ ì„ì˜ ìœ„ì¹˜ì— ìˆëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì€ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;FUSE(Filesystem in Userspace)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ì‚¬ìš©ì ê³µê°„ê³¼ ìœ ë‹‰ìŠ¤ íŒŒì¼ ì‹œìŠ¤í…œì„ í†µí•©í•œ íŒŒì¼ ì‹œìŠ¤í…œì„ ì§€ì›í•©ë‹ˆë‹¤. í•˜ë‘¡ì˜ Fuse-DFS contrib ëª¨ë“ˆì€ í‘œì¤€ ë¡œì»¬ íŒŒì¼ì‹œìŠ¤í…œì— HDFSë¥¼ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. Fuse-DFSëŠ” Cë¡œ ì‘ì„±ëœ libhdfsë¡œ HDFS ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì°¸ê³ ë¡œ NFSê°€ Fuse-DFSë³´ë‹¤ ì•ˆì „í•˜ë©° ì„ í˜¸ë˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;í´ëŸ¬ìŠ¤í„°ê°„-í…Œì´ë¸”-ì´ë™&quot;&gt;í´ëŸ¬ìŠ¤í„°ê°„ í…Œì´ë¸” ì´ë™&lt;/h1&gt;

&lt;p&gt;ì˜ˆë¥¼ ë“¤ì–´, namenode1ì— ì•„ë˜ì™€ ê°™ì€ í…Œì´ë¸”ì´ ìˆë‹¤ê³  ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hive &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'SELECT * FROM default.table_1'&lt;/span&gt;
+-------+---------+
| col1  |  col2   |
+-------+---------+
| a     | apple   |
| b     | banana  |
| c     | car     |
+-------+---------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;namenode2ë¡œ default.table_1ì„ ì´ë™í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/user/hive/warehouse/default.db/table_1&lt;/code&gt; ë””ë ‰í† ë¦¬ ì´ë™&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# namenode1ì—ì„œ ì‹¤í–‰&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hadoop distcp &lt;span class=&quot;nt&quot;&gt;-overwrite&lt;/span&gt; webhdfs://namenode1:14000/user/hive/warehouse/default.db/table_1 webhdfs://namenode2:14000/user/hive/warehouse/default.db/table_1

&lt;span class=&quot;c&quot;&gt;#namenode2ì—ì„œ distcp ê²°ê³¼ í™•ì¸&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode2~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hdfs dfs &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; /user/hive/warehouse/default.db/table_1
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;+  3 gyuhoonK hive          0 2022-01-20 10:04 /user/hive/warehouse/defulat.db/table_1/_SUCCESS
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;+  3 gyuhoonK hive        340 2022-01-20 10:04 /user/hive/warehouse/defulat.db/table_1/part-00000-7628a86e-50d7-4e64-a35d-435ba6943156-c000.snappy.parquet
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;+  3 gyuhoonK hive        544 2022-01-20 10:04 /user/hive/warehouse/defulat.db/table_1/part-00166-7628a86e-50d7-4e64-a35d-435ba6943156-c000.snappy.parquet
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;+  3 gyuhoonK hive        549 2022-01-20 10:04 /user/hive/warehouse/defulat.db/table_1/part-00333-7628a86e-50d7-4e64-a35d-435ba6943156-c000.snappy.parquet
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;+  3 gyuhoonK hive        534 2022-01-20 10:04 /user/hive/warehouse/defulat.db/table_1/part-00499-7628a86e-50d7-4e64-a35d-435ba6943156-c000.snappy.parquet
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;create statement í™•ì¸&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hive &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'SHOW CREATE TABLE default.table_1'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----------------------------------------------------+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;                   &lt;span class=&quot;n&quot;&gt;createtab_stmt&lt;/span&gt;                   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----------------------------------------------------+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXTERNAL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`default.table_1`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;           &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`col1`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                                   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;nv&quot;&gt;`col2`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;                                   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ROW&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FORMAT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SERDE&lt;/span&gt;                                   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SERDEPROPERTIES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;                             &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'path'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'hdfs://nameservice1/user/hive/warehouse/default.db/table_1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;                                          &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;STORED&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INPUTFORMAT&lt;/span&gt;                              &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat'&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OUTPUTFORMAT&lt;/span&gt;                                       &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;LOCATION&lt;/span&gt;                                           &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'hdfs://nameservice1/user/hive/warehouse/default.db/table_1'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TBLPROPERTIES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;                                    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'bucketing_version'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                         &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'spark.sql.create.version'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'2.3.1.3.0.1.0-187'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'spark.sql.sources.provider'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'parquet'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'spark.sql.sources.schema.numParts'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'spark.sql.sources.schema.part.0'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;col1&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}},{&quot;name&quot;:&quot;col2&quot;,&quot;type&quot;:&quot;string&quot;,&quot;nullable&quot;:true,&quot;metadata&quot;:{}}]}'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'transient_lastDdlTime'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'1642640799'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;            &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;----------------------------------------------------+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì•„ë˜ì™€ ê°™ì´ ëª…ë ¹ì–´ë¥¼ ì¡°í•©í•˜ë©´ ì¿¼ë¦¬ë¬¸ë§Œ íŒŒì¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hive &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'show create table default.table_1'&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/|//g'&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/+//g'&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/createtab_stmt//g'&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/WARN/d'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; create.sql 2&amp;gt;/dev/null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;';'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; create.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;create.sql&lt;/code&gt; íŒŒì¼ì„ namenode2ë¡œ ì˜®ê¸´ ë’¤ namenode2ì—ì„œ create statement ì‹¤í–‰&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# namenode1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode1~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;scp create.sql gyuhoonk@namenode2:/home/gyuhoonk/
&lt;span class=&quot;c&quot;&gt;# namenode2&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode2~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hive &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; create.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;Partitioned tableì¸ ê²½ìš°ì—ëŠ” TABLE REPAIR ì‹¤í–‰&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;gyuhoonk@namenode2~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hive &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'MSCK REPAIR TABLE defulat.table_1'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;/p&gt;

&lt;p&gt;í•˜ë‘¡ ì™„ë²½ ê°€ì´ë“œ, í•œë¹›ë¯¸ë””ì–´&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://hadoop.apache.org/docs/r1.2.1/distcp.html&quot;&gt;DistCp Guide&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">hadoop distcp ëª…ë ¹ì–´</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Overwrite Partition in Spark</title>
      <link href="https://gyuhoonk.github.io/spark-overwrite-partition" rel="alternate" type="text/html" title="Overwrite Partition in Spark" />
      <published>2021-12-21T22:30:00+09:00</published>
      <updated>2021-12-21T22:30:00+09:00</updated>
      <id>https://gyuhoonk.github.io/spark-overwrite-partition</id>
      <content type="html" xml:base="https://gyuhoonk.github.io/spark-overwrite-partition">&lt;p&gt;Sparkë¥¼ ì´ìš©í•˜ì—¬ íŠ¹ì • íŒŒí‹°ì…˜ë§Œ overwriteí•˜ê¸°&lt;/p&gt;

&lt;h1 id=&quot;partitioned-table-in-hive&quot;&gt;Partitioned Table in Hive&lt;/h1&gt;

&lt;p&gt;Hiveì—ì„œ  íŒŒí‹°ì…”ë‹ì„ ì´ìš©í•˜ëŠ” ê°€ì¥ í° ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ” ì¿¼ë¦¬ ì„±ëŠ¥ í–¥ìƒì…ë‹ˆë‹¤. HDFS ìƒì—ì„œ partition columnì„ ê¸°ì¤€ìœ¼ë¡œ ê°ê° ë‹¤ë¥¸ ë””ë ‰í† ë¦¬ì— ì €ì¥ë˜ë¯€ë¡œ ì¿¼ë¦¬ ì¡°íšŒ ì‹œ ì¡°íšŒê°€ í•„ìš” ì—†ëŠ” íŒŒì¼ì€ ì¡°íšŒë¥¼ ìˆ˜í–‰í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì¿¼ë¦¬ ì„±ëŠ¥ì´ í–¥ìƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì˜ˆë¥¼ ë“¤ì–´ ì„¤ëª…í•´ë³´ê² ìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì€ ê°„ë‹¨í•œ í…Œì´ë¸”ì„ hiveì— ì €ì¥í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'col1'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'b'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'c'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'col2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'apple'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'banana'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'car'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]})&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|---&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-------|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-------|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apple&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;banana&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;car&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;sdf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createDataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sdf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+------+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+------+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apple&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;banana&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;car&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+------+&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'default.t_test'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sdf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'append'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;partitionBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/user/hive/warehouse/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.db/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;saveAsTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    
&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;banana&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apple&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;car&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;default.t_test&lt;/code&gt;  í…Œì´ë¸”ì€ ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ë¡œ ì €ì¥ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hdfs &lt;span class=&quot;nt&quot;&gt;-dfs&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /user/hive/warehouse/default.db/t_test &lt;span class=&quot;c&quot;&gt;# hdfs ë””ë ‰í† ë¦¬ ì¡°íšŒ &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /user/hive/warehouse/default.db/t_test/col1&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;a
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /user/hive/warehouse/default.db/t_test/col1&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;b
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /user/hive/warehouse/default.db/t_test/col1&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;c
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ë”°ë¼ì„œ, ë§Œì•½ ì•„ë˜ì™€ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤ë©´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=a&lt;/code&gt; ë””ë ‰í† ë¦¬ ë‚´ë¶€ì˜ íŒŒì¼ë§Œ ì¡°íšŒí•˜ì—¬ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ íŒŒí‹°ì…˜ì´ ì ìš©ë˜ì§€ ì•Šì€ í…Œì´ë¸”ë³´ë‹¤ ì¿¼ë¦¬ ì„±ëŠ¥ì´ í–¥ìƒë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t_test&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- col1=a ë””ë ‰í† ë¦¬ë§Œ ì¡°íšŒ&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì´ì™¸ì—ë„ íŒŒí‹°ì…˜ í…Œì´ë¸”ì´ ê°–ëŠ” ì¥ì ì´ í•˜ë‚˜ ë” ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;overwrite-only-a-singleor-specific-partition&quot;&gt;Overwrite Only a Single(or Specific) Partition&lt;/h1&gt;

&lt;p&gt;ê° íŒŒí‹°ì…˜ì— í•´ë‹¹í•˜ëŠ” ë””ë ‰í† ë¦¬ ë‚´ì— íŒŒì¼ì´ ë”°ë¡œ ì €ì¥ë˜ì–´ ìˆìœ¼ë¯€ë¡œ í…Œì´ë¸”ì˜ ìˆ˜ì •ì´ í•„ìš”í•œ ê²½ìš° ìˆ˜ì •ì´ í•„ìš”í•œ íŒŒí‹°ì…˜ì— ëŒ€í•´ì„œë§Œ overwriteí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì˜ˆë¥¼ ë“¤ì–´, ì•„ë˜ ì¿¼ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ ìœ„ í…Œì´ë¸”ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col=1&lt;/code&gt; íŒŒí‹°ì…˜ì„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tmp&lt;/code&gt; í…Œì´ë¸”(í˜¹ì€ ë·°) ë‚´ìš©ìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OVERWRITE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t_test&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARTITION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;HiveQLì€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;INSERT OVERWRITE&lt;/code&gt;ì™€ STATIC PARTITION ë¬¸ë²•ì„ í†µí•´ ì´ëŸ¬í•œ Partition Overwriteê°€ ë¹„êµì  ê°„ë‹¨í•œ í¸ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;Sparkì—ì„œëŠ” Partition Overwriteë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì„ê¹Œìš”?&lt;/p&gt;

&lt;h2 id=&quot;test1--saveastable&quot;&gt;Test1 : saveAsTable&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=a&lt;/code&gt; íŒŒí‹°ì…˜ì˜ ë‚´ìš©ì„ ë³€ê²½í•˜ê¸° ìœ„í•œ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ ì‹¤í—˜í•´ë³´ê² ìŠµë‹ˆë‹¤. ëª©í‘œëŠ” ë‹¤ë¥¸ íŒŒí‹°ì…˜ì€ ê±´ë“œë¦¬ì§€ ì•Šê³ , &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{a:apple}&lt;/code&gt;ì¸ í˜„ì¬ ìƒíƒœë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{a:art}&lt;/code&gt;ë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;a_art_df&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'col1'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'col2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'art'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]})&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;a_art_df&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|---&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-------|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-------|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createDataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a_art_df&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì´ì œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;a_art_sdf&lt;/code&gt;ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;default.t_test&lt;/code&gt;ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;saveAsTable&lt;/code&gt;ì„ ì´ìš©í•˜ì—¬ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;overwrite&lt;/code&gt;í•´ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'overwrite'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;partitionBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/user/hive/warehouse/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.db/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;saveAsTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    
&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì‹¤í–‰ ê²°ê³¼ ë‹¤ë¥¸ íŒŒí‹°ì…˜(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=b&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=c&lt;/code&gt;)ì´ ëª¨ë‘ ì‚­ì œë˜ê³  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=a&lt;/code&gt; íŒŒí‹°ì…˜ë§Œ ë‚¨ì•˜ìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ëŠ” saveAsTableì´ íŒŒí‹°ì…˜ì— ê´€ë ¨ëœ ë©”ì†Œë“œê°€ ì•„ë‹ˆë¼, í…Œì´ë¸” ë‹¨ìœ„ì˜ ë©”ì†Œë“œì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrameWriter.saveAsTable&lt;/code&gt;(&lt;em&gt;name&lt;/em&gt;, &lt;em&gt;format=None&lt;/em&gt;, &lt;em&gt;mode=None&lt;/em&gt;, &lt;em&gt;partitionBy=None&lt;/em&gt;, &lt;em&gt;**options&lt;/em&gt;)[&lt;a href=&quot;https://spark.apache.org/docs/latest/api/python/_modules/pyspark/sql/readwriter.html#DataFrameWriter.saveAsTable&quot;&gt;source]&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;Saves the content of the &lt;a href=&quot;https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt;&lt;/a&gt; as the specified table.&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;ë”°ë¼ì„œ, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;defaut.t_test&lt;/code&gt; ë‚´ì˜ ëª¨ë“  ë‚´ìš©ì— ëŒ€í•´ì„œ overwriteê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;test2--insertinto&quot;&gt;Test2 : insertInto&lt;/h2&gt;

&lt;p&gt;Sparkì˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrame&lt;/code&gt;ì„ í…Œì´ë¸”ë¡œ ì €ì¥í•˜ëŠ” ë‹¤ë¥¸ ë©”ì†Œë“œì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;insertInto&lt;/code&gt;ê°€ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'overwrite'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'parquet'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insertInto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    
&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;banana&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apple&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;car&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col2&lt;/code&gt;ì˜ ìœ„ì¹˜ë¥¼ ë’¤ë°”ê¿” ì €ì¥í•˜ëŠ” ëª¨ìŠµì„ ë³´ì˜€ìŠµë‹ˆë‹¤. ì´ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;insertInto&lt;/code&gt; ë©”ì†Œë“œê°€ ì¹¼ëŸ¼ ìˆœì„œì— ê¸°ë°˜í•˜ì—¬ í…Œì´ë¸”ì— ì €ì¥í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Unlike &lt;a href=&quot;https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrameWriter.saveAsTable.html#pyspark.sql.DataFrameWriter.saveAsTable&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrameWriter.saveAsTable()&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrameWriter.insertInto.html?highlight=insertinto#pyspark.sql.DataFrameWriter.insertInto&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DataFrameWriter.insertInto()&lt;/code&gt;&lt;/a&gt; &lt;strong&gt;ignores the column names&lt;/strong&gt; and &lt;strong&gt;just uses position-based resolution&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ì»¬ëŸ¼ ìˆœì„œë¥¼ ë°”ê¿”ì„œ ë‹¤ì‹œ overwriteí•´ë³´ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;a_art_df&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'col2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'art'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'col1'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]})&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;a_art_df&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|---&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-------|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-------|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createDataFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a_art_df&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+----+----+&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'overwrite'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'parquet'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insertInto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    
&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;banana&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apple&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;car&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ë¶„ëª… overwriteí–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=a&lt;/code&gt;ì— appendëœ ê²°ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì¶”ì¸¡ì»¨ë°, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;insertInto&lt;/code&gt; ë©”ì†Œë“œì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;overwrite=True&lt;/code&gt; ì˜µì…˜ì„ ë”°ë¡œ ì¤„ ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;write.mode&lt;/code&gt;ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ë˜í•œ ì´ ë©”ì†Œë“œ ì—­ì‹œ í…Œì´ë¸” ìì²´ì— ì €ì¥í•˜ëŠ” ë°©ì‹ì´ê¸° ë•Œë¬¸ì— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;overwrite=True&lt;/code&gt; ì˜µì…˜ì„ ë¶€ì—¬í•˜ê²Œ ë˜ë©´ í…Œì´ë¸” ì „ì²´ë¥¼ overwriteí•˜ì—¬ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=b&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=c&lt;/code&gt; íŒŒí‹°ì…˜ì´ ì‚¬ë¼ì§€ê²Œ ë©ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'overwrite'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'parquet'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insertInto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;overwrite&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;test3--save-directly&quot;&gt;Test3 : save (directly)&lt;/h2&gt;

&lt;p&gt;ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤í—˜í•´ë³¸ ë°©ë²•ì€ íŒŒí‹°ì…˜ ê²½ë¡œì— ì§ì ‘ í•´ë‹¹ íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ ê²½ìš° ì£¼ì˜í•´ì•¼í•  ì ì€ partition column(ì´ ê²½ìš°ì—ëŠ” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1&lt;/code&gt;)ì€ ì œì™¸í•˜ê³  ì €ì¥í•´ì•¼í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤. partition columnì— í•´ë‹¹í•˜ëŠ” valueëŠ” ë””ë ‰í† ë¦¬ ì´ë¦„(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=a&lt;/code&gt;)ë¥¼ í†µí•´ ì¶”ë¡ ë˜ëŠ” ê°’ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;a_art_sdf&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;drop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'col1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'overwrite'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'parquet'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;\
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/user/hive/warehouse/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.db/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/col1=a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    
&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;REFRESH TABLE &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# íŒŒì¼ì„ ì§ì ‘ ìˆ˜ì •í–ˆìœ¼ë¯€ë¡œ, ìºì‹±ëœ ë©”íƒ€ë°ì´í„° update ì‹¤í–‰
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;schema&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;col2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;banana&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;art&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;car&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;+------+----+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ì„±ê³µí–ˆìŠµë‹ˆë‹¤! &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;col1=a&lt;/code&gt;ì— í•´ë‹¹í•˜ëŠ” ê°’ì´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apple&lt;/code&gt;ì—ì„œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;art&lt;/code&gt;ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hive &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;SELECT * FROM default.t_test&quot;&lt;/span&gt;
+---------+-------+
|  col2   | col1  |
+---------+-------+
| art     | a     |
| banana  | b     |
| car     | c     |
+---------+-------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;HiveQLë¡œ ì¡°íšŒí•˜ëŠ” ê²½ìš°ì—ë„ ì •ìƒì ìœ¼ë¡œ ê°’ì´ ì¡°íšŒë©ë‹ˆë‹¤!&lt;/p&gt;

&lt;h1 id=&quot;ëë‚´ë©°&quot;&gt;ëë‚´ë©°&lt;/h1&gt;

&lt;p&gt;ê°„ë‹¨í•œ ê¸€ì´ì§€ë§Œ, ì •ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ í•­ìƒ í—·ê°ˆë¦¬ê³  í˜¼ë€ìŠ¤ëŸ¬ìš´ ë‚´ìš©ì´ ë  ê²ƒ ê°™ì•„ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•œ ë²„ì „ì€ Spark 2.3.0ì´ë©° Spark 3.0 ì´ìƒì˜ ë²„ì „ì—ì„œëŠ” ì¢€ ë” ë©‹ì§€ê³  ê¹”ë”í•œ ë©”ì†Œë“œê°€ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ê°ì‚¬í•©ë‹ˆë‹¤.&lt;/p&gt;

&lt;p&gt;[ì°¸ê³ ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/38487667/overwrite-specific-partitions-in-spark-dataframe-write-method&quot;&gt;Overwrite specific partitions in spark dataframe write method&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      <author>
          <name>GyuhoonK</name>
        
        
      </author>

      

      
        <category term="hadoop" />
      

      
        <summary type="html">Sparkë¥¼ ì´ìš©í•˜ì—¬ íŠ¹ì • íŒŒí‹°ì…˜ë§Œ overwriteí•˜ê¸°</summary>
      

      
      
    </entry>
  
</feed>
